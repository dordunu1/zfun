const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BJEdcoLu.js","assets/index-DTJWJfQd.js","assets/recharts-j7T_IppE.js","assets/index-DI4pssSO.css"])))=>i.map(i=>d[i]);
import{o as X,p as c0,w as Vl,r as Fl,q as Tc,t as Ea,u as u0,v as wi,V as h0,M as l0,N as B,x as f0,y as mc,z as p0,K as d0,A as g0,C as Kh,D as y0,E as v0,F as m0,G as Vh,$ as w0,J as _0,L as b0,O as Gs,P as Fh,X as E0,Q as I0,R as Bl,S as qr,T as x0,U as Bh,W as fs,Y as St,Z as kt,a0 as mi,a1 as ar,a2 as P0,a3 as ps,a4 as Gl,a5 as S0,a6 as O0,a7 as R0,a8 as Wl,a9 as A0,aa as Jl,ab as Ql,ac as gs,ad as wc,ae as ga,af as ys,ag as C0,ah as ya,ai as T0,aj as $0,ak as N0,al as D0,am as oa,an as q0,ao as L0,ap as rc,aq as Gh,ar as j0,as as z0,at as M0,au as Wh,av as U0,aw as H0,ax as k0,ay as K0,az as V0,aA as F0,aB as B0,aC as Vs,aD as Yl,aE as ic,aF as G0,aG as W0,_ as J0}from"./index-DTJWJfQd.js";import{e as Sr,E as $c}from"./events-CT80Hs67.js";import{s as Ys,a as Ia,r as Zl,f as Ui,g as Nc,i as Lr,b as Zs,c as Jh,d as Q0,e as Y0,h as Dc,p as Z0,j as qc,k as xa,l as vi,m as X0,n as Ei}from"./index.es-DlbJqgfe.js";import{a as Lc,g as jc,c as ca}from"./recharts-j7T_IppE.js";const ew=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,tw=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,rw=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function iw(o,t){if(o==="__proto__"||o==="constructor"&&t&&typeof t=="object"&&"prototype"in t){sw(o);return}return t}function sw(o){console.warn(`[destr] Dropping "${o}" key to prevent prototype pollution.`)}function ua(o,t={}){if(typeof o!="string")return o;const r=o.trim();if(o[0]==='"'&&o.endsWith('"')&&!o.includes("\\"))return r.slice(1,-1);if(r.length<=9){const s=r.toLowerCase();if(s==="true")return!0;if(s==="false")return!1;if(s==="undefined")return;if(s==="null")return null;if(s==="nan")return Number.NaN;if(s==="infinity")return Number.POSITIVE_INFINITY;if(s==="-infinity")return Number.NEGATIVE_INFINITY}if(!rw.test(o)){if(t.strict)throw new SyntaxError("[destr] Invalid JSON");return o}try{if(ew.test(o)||tw.test(o)){if(t.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(o,iw)}return JSON.parse(o)}catch(s){if(t.strict)throw s;return o}}function nw(o){return!o||typeof o.then!="function"?Promise.resolve(o):o}function qt(o,...t){try{return nw(o(...t))}catch(r){return Promise.reject(r)}}function aw(o){const t=typeof o;return o===null||t!=="object"&&t!=="function"}function ow(o){const t=Object.getPrototypeOf(o);return!t||t.isPrototypeOf(Object)}function va(o){if(aw(o))return String(o);if(ow(o)||Array.isArray(o))return JSON.stringify(o);if(typeof o.toJSON=="function")return va(o.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const _c="base64:";function cw(o){return typeof o=="string"?o:_c+lw(o)}function uw(o){return typeof o!="string"||!o.startsWith(_c)?o:hw(o.slice(_c.length))}function hw(o){return globalThis.Buffer?Buffer.from(o,"base64"):Uint8Array.from(globalThis.atob(o),t=>t.codePointAt(0))}function lw(o){return globalThis.Buffer?Buffer.from(o).toString("base64"):globalThis.btoa(String.fromCodePoint(...o))}function nr(o){var t;return o&&((t=o.split("?")[0])==null?void 0:t.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function fw(...o){return nr(o.join(":"))}function ha(o){return o=nr(o),o?o+":":""}const pw="memory",dw=()=>{const o=new Map;return{name:pw,getInstance:()=>o,hasItem(t){return o.has(t)},getItem(t){return o.get(t)??null},getItemRaw(t){return o.get(t)??null},setItem(t,r){o.set(t,r)},setItemRaw(t,r){o.set(t,r)},removeItem(t){o.delete(t)},getKeys(){return[...o.keys()]},clear(){o.clear()},dispose(){o.clear()}}};function gw(o={}){const t={mounts:{"":o.driver||dw()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=d=>{for(const _ of t.mountpoints)if(d.startsWith(_))return{base:_,relativeKey:d.slice(_.length),driver:t.mounts[_]};return{base:"",relativeKey:d,driver:t.mounts[""]}},s=(d,_)=>t.mountpoints.filter(S=>S.startsWith(d)||_&&d.startsWith(S)).map(S=>({relativeBase:d.length>S.length?d.slice(S.length):void 0,mountpoint:S,driver:t.mounts[S]})),a=(d,_)=>{if(t.watching){_=nr(_);for(const S of t.watchListeners)S(d,_)}},u=async()=>{if(!t.watching){t.watching=!0;for(const d in t.mounts)t.unwatch[d]=await Qh(t.mounts[d],a,d)}},f=async()=>{if(t.watching){for(const d in t.unwatch)await t.unwatch[d]();t.unwatch={},t.watching=!1}},y=(d,_,S)=>{const R=new Map,N=A=>{let Q=R.get(A.base);return Q||(Q={driver:A.driver,base:A.base,items:[]},R.set(A.base,Q)),Q};for(const A of d){const Q=typeof A=="string",te=nr(Q?A:A.key),ce=Q?void 0:A.value,oe=Q||!A.options?_:{..._,...A.options},ne=r(te);N(ne).items.push({key:te,value:ce,relativeKey:ne.relativeKey,options:oe})}return Promise.all([...R.values()].map(A=>S(A))).then(A=>A.flat())},m={hasItem(d,_={}){d=nr(d);const{relativeKey:S,driver:R}=r(d);return qt(R.hasItem,S,_)},getItem(d,_={}){d=nr(d);const{relativeKey:S,driver:R}=r(d);return qt(R.getItem,S,_).then(N=>ua(N))},getItems(d,_={}){return y(d,_,S=>S.driver.getItems?qt(S.driver.getItems,S.items.map(R=>({key:R.relativeKey,options:R.options})),_).then(R=>R.map(N=>({key:fw(S.base,N.key),value:ua(N.value)}))):Promise.all(S.items.map(R=>qt(S.driver.getItem,R.relativeKey,R.options).then(N=>({key:R.key,value:ua(N)})))))},getItemRaw(d,_={}){d=nr(d);const{relativeKey:S,driver:R}=r(d);return R.getItemRaw?qt(R.getItemRaw,S,_):qt(R.getItem,S,_).then(N=>uw(N))},async setItem(d,_,S={}){if(_===void 0)return m.removeItem(d);d=nr(d);const{relativeKey:R,driver:N}=r(d);N.setItem&&(await qt(N.setItem,R,va(_),S),N.watch||a("update",d))},async setItems(d,_){await y(d,_,async S=>{if(S.driver.setItems)return qt(S.driver.setItems,S.items.map(R=>({key:R.relativeKey,value:va(R.value),options:R.options})),_);S.driver.setItem&&await Promise.all(S.items.map(R=>qt(S.driver.setItem,R.relativeKey,va(R.value),R.options)))})},async setItemRaw(d,_,S={}){if(_===void 0)return m.removeItem(d,S);d=nr(d);const{relativeKey:R,driver:N}=r(d);if(N.setItemRaw)await qt(N.setItemRaw,R,_,S);else if(N.setItem)await qt(N.setItem,R,cw(_),S);else return;N.watch||a("update",d)},async removeItem(d,_={}){typeof _=="boolean"&&(_={removeMeta:_}),d=nr(d);const{relativeKey:S,driver:R}=r(d);R.removeItem&&(await qt(R.removeItem,S,_),(_.removeMeta||_.removeMata)&&await qt(R.removeItem,S+"$",_),R.watch||a("remove",d))},async getMeta(d,_={}){typeof _=="boolean"&&(_={nativeOnly:_}),d=nr(d);const{relativeKey:S,driver:R}=r(d),N=Object.create(null);if(R.getMeta&&Object.assign(N,await qt(R.getMeta,S,_)),!_.nativeOnly){const A=await qt(R.getItem,S+"$",_).then(Q=>ua(Q));A&&typeof A=="object"&&(typeof A.atime=="string"&&(A.atime=new Date(A.atime)),typeof A.mtime=="string"&&(A.mtime=new Date(A.mtime)),Object.assign(N,A))}return N},setMeta(d,_,S={}){return this.setItem(d+"$",_,S)},removeMeta(d,_={}){return this.removeItem(d+"$",_)},async getKeys(d,_={}){d=ha(d);const S=s(d,!0);let R=[];const N=[];for(const A of S){const Q=await qt(A.driver.getKeys,A.relativeBase,_);for(const te of Q){const ce=A.mountpoint+nr(te);R.some(oe=>ce.startsWith(oe))||N.push(ce)}R=[A.mountpoint,...R.filter(te=>!te.startsWith(A.mountpoint))]}return d?N.filter(A=>A.startsWith(d)&&A[A.length-1]!=="$"):N.filter(A=>A[A.length-1]!=="$")},async clear(d,_={}){d=ha(d),await Promise.all(s(d,!1).map(async S=>{if(S.driver.clear)return qt(S.driver.clear,S.relativeBase,_);if(S.driver.removeItem){const R=await S.driver.getKeys(S.relativeBase||"",_);return Promise.all(R.map(N=>S.driver.removeItem(N,_)))}}))},async dispose(){await Promise.all(Object.values(t.mounts).map(d=>Yh(d)))},async watch(d){return await u(),t.watchListeners.push(d),async()=>{t.watchListeners=t.watchListeners.filter(_=>_!==d),t.watchListeners.length===0&&await f()}},async unwatch(){t.watchListeners=[],await f()},mount(d,_){if(d=ha(d),d&&t.mounts[d])throw new Error(`already mounted at ${d}`);return d&&(t.mountpoints.push(d),t.mountpoints.sort((S,R)=>R.length-S.length)),t.mounts[d]=_,t.watching&&Promise.resolve(Qh(_,a,d)).then(S=>{t.unwatch[d]=S}).catch(console.error),m},async unmount(d,_=!0){var S,R;d=ha(d),!(!d||!t.mounts[d])&&(t.watching&&d in t.unwatch&&((R=(S=t.unwatch)[d])==null||R.call(S),delete t.unwatch[d]),_&&await Yh(t.mounts[d]),t.mountpoints=t.mountpoints.filter(N=>N!==d),delete t.mounts[d])},getMount(d=""){d=nr(d)+":";const _=r(d);return{driver:_.driver,base:_.base}},getMounts(d="",_={}){return d=nr(d),s(d,_.parents).map(R=>({driver:R.driver,base:R.mountpoint}))},keys:(d,_={})=>m.getKeys(d,_),get:(d,_={})=>m.getItem(d,_),set:(d,_,S={})=>m.setItem(d,_,S),has:(d,_={})=>m.hasItem(d,_),del:(d,_={})=>m.removeItem(d,_),remove:(d,_={})=>m.removeItem(d,_)};return m}function Qh(o,t,r){return o.watch?o.watch((s,a)=>t(s,r+a)):()=>{}}async function Yh(o){typeof o.dispose=="function"&&await qt(o.dispose)}function Hi(o){return new Promise((t,r)=>{o.oncomplete=o.onsuccess=()=>t(o.result),o.onabort=o.onerror=()=>r(o.error)})}function Xl(o,t){const r=indexedDB.open(o);r.onupgradeneeded=()=>r.result.createObjectStore(t);const s=Hi(r);return(a,u)=>s.then(f=>u(f.transaction(t,a).objectStore(t)))}let sc;function Xs(){return sc||(sc=Xl("keyval-store","keyval")),sc}function Zh(o,t=Xs()){return t("readonly",r=>Hi(r.get(o)))}function yw(o,t,r=Xs()){return r("readwrite",s=>(s.put(t,o),Hi(s.transaction)))}function vw(o,t=Xs()){return t("readwrite",r=>(r.delete(o),Hi(r.transaction)))}function mw(o=Xs()){return o("readwrite",t=>(t.clear(),Hi(t.transaction)))}function ww(o,t){return o.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},Hi(o.transaction)}function _w(o=Xs()){return o("readonly",t=>{if(t.getAllKeys)return Hi(t.getAllKeys());const r=[];return ww(t,s=>r.push(s.key)).then(()=>r)})}const bw="idb-keyval";var Ew=(o={})=>{const t=o.base&&o.base.length>0?`${o.base}:`:"",r=a=>t+a;let s;return o.dbName&&o.storeName&&(s=Xl(o.dbName,o.storeName)),{name:bw,options:o,async hasItem(a){return!(typeof await Zh(r(a),s)>"u")},async getItem(a){return await Zh(r(a),s)??null},setItem(a,u){return yw(r(a),u,s)},removeItem(a){return vw(r(a),s)},getKeys(){return _w(s)},clear(){return mw(s)}}};const Iw="WALLET_CONNECT_V2_INDEXED_DB",xw="keyvaluestorage";let Pw=class{constructor(){this.indexedDb=gw({driver:Ew({dbName:Iw,storeName:xw})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(t=>[t.key,t.value])}async getItem(t){const r=await this.indexedDb.getItem(t);if(r!==null)return r}async setItem(t,r){await this.indexedDb.setItem(t,Ys(r))}async removeItem(t){await this.indexedDb.removeItem(t)}};var nc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ma={exports:{}};(function(){let o;function t(){}o=t,o.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},o.prototype.setItem=function(r,s){this[r]=String(s)},o.prototype.removeItem=function(r){delete this[r]},o.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(s){r[s]=void 0,delete r[s]})},o.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},o.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof nc<"u"&&nc.localStorage?ma.exports=nc.localStorage:typeof window<"u"&&window.localStorage?ma.exports=window.localStorage:ma.exports=new t})();function Sw(o){var t;return[o[0],Ia((t=o[1])!=null?t:"")]}class Ow{constructor(){this.localStorage=ma.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Sw)}async getItem(t){const r=this.localStorage.getItem(t);if(r!==null)return Ia(r)}async setItem(t,r){this.localStorage.setItem(t,Ys(r))}async removeItem(t){this.localStorage.removeItem(t)}}const Rw="wc_storage_version",Xh=1,Aw=async(o,t,r)=>{const s=Rw,a=await t.getItem(s);if(a&&a>=Xh){r(t);return}const u=await o.getKeys();if(!u.length){r(t);return}const f=[];for(;u.length;){const y=u.shift();if(!y)continue;const m=y.toLowerCase();if(m.includes("wc@")||m.includes("walletconnect")||m.includes("wc_")||m.includes("wallet_connect")){const d=await o.getItem(y);await t.setItem(y,d),f.push(y)}}await t.setItem(s,Xh),r(t),Cw(o,f)},Cw=async(o,t)=>{t.length&&t.forEach(async r=>{await o.removeItem(r)})};let Tw=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const t=new Ow;this.storage=t;try{const r=new Pw;Aw(t,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(t){return await this.initialize(),this.storage.getItem(t)}async setItem(t,r){return await this.initialize(),this.storage.setItem(t,r)}async removeItem(t){return await this.initialize(),this.storage.removeItem(t)}async initialize(){this.initialized||await new Promise(t=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),t())},20)})}};var vs={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var bc=function(o,t){return bc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var a in s)s.hasOwnProperty(a)&&(r[a]=s[a])},bc(o,t)};function $w(o,t){bc(o,t);function r(){this.constructor=o}o.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Ec=function(){return Ec=Object.assign||function(t){for(var r,s=1,a=arguments.length;s<a;s++){r=arguments[s];for(var u in r)Object.prototype.hasOwnProperty.call(r,u)&&(t[u]=r[u])}return t},Ec.apply(this,arguments)};function Nw(o,t){var r={};for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&t.indexOf(s)<0&&(r[s]=o[s]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(o);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(o,s[a])&&(r[s[a]]=o[s[a]]);return r}function Dw(o,t,r,s){var a=arguments.length,u=a<3?t:s===null?s=Object.getOwnPropertyDescriptor(t,r):s,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(o,t,r,s);else for(var y=o.length-1;y>=0;y--)(f=o[y])&&(u=(a<3?f(u):a>3?f(t,r,u):f(t,r))||u);return a>3&&u&&Object.defineProperty(t,r,u),u}function qw(o,t){return function(r,s){t(r,s,o)}}function Lw(o,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,t)}function jw(o,t,r,s){function a(u){return u instanceof r?u:new r(function(f){f(u)})}return new(r||(r=Promise))(function(u,f){function y(_){try{d(s.next(_))}catch(S){f(S)}}function m(_){try{d(s.throw(_))}catch(S){f(S)}}function d(_){_.done?u(_.value):a(_.value).then(y,m)}d((s=s.apply(o,t||[])).next())})}function zw(o,t){var r={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},s,a,u,f;return f={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function y(d){return function(_){return m([d,_])}}function m(d){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,a&&(u=d[0]&2?a.return:d[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,d[1])).done)return u;switch(a=0,u&&(d=[d[0]&2,u.value]),d[0]){case 0:case 1:u=d;break;case 4:return r.label++,{value:d[1],done:!1};case 5:r.label++,a=d[1],d=[0];continue;case 7:d=r.ops.pop(),r.trys.pop();continue;default:if(u=r.trys,!(u=u.length>0&&u[u.length-1])&&(d[0]===6||d[0]===2)){r=0;continue}if(d[0]===3&&(!u||d[1]>u[0]&&d[1]<u[3])){r.label=d[1];break}if(d[0]===6&&r.label<u[1]){r.label=u[1],u=d;break}if(u&&r.label<u[2]){r.label=u[2],r.ops.push(d);break}u[2]&&r.ops.pop(),r.trys.pop();continue}d=t.call(o,r)}catch(_){d=[6,_],a=0}finally{s=u=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function Mw(o,t,r,s){s===void 0&&(s=r),o[s]=t[r]}function Uw(o,t){for(var r in o)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=o[r])}function Ic(o){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&o[t],s=0;if(r)return r.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&s>=o.length&&(o=void 0),{value:o&&o[s++],done:!o}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ef(o,t){var r=typeof Symbol=="function"&&o[Symbol.iterator];if(!r)return o;var s=r.call(o),a,u=[],f;try{for(;(t===void 0||t-- >0)&&!(a=s.next()).done;)u.push(a.value)}catch(y){f={error:y}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(f)throw f.error}}return u}function Hw(){for(var o=[],t=0;t<arguments.length;t++)o=o.concat(ef(arguments[t]));return o}function kw(){for(var o=0,t=0,r=arguments.length;t<r;t++)o+=arguments[t].length;for(var s=Array(o),a=0,t=0;t<r;t++)for(var u=arguments[t],f=0,y=u.length;f<y;f++,a++)s[a]=u[f];return s}function Ws(o){return this instanceof Ws?(this.v=o,this):new Ws(o)}function Kw(o,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=r.apply(o,t||[]),a,u=[];return a={},f("next"),f("throw"),f("return"),a[Symbol.asyncIterator]=function(){return this},a;function f(R){s[R]&&(a[R]=function(N){return new Promise(function(A,Q){u.push([R,N,A,Q])>1||y(R,N)})})}function y(R,N){try{m(s[R](N))}catch(A){S(u[0][3],A)}}function m(R){R.value instanceof Ws?Promise.resolve(R.value.v).then(d,_):S(u[0][2],R)}function d(R){y("next",R)}function _(R){y("throw",R)}function S(R,N){R(N),u.shift(),u.length&&y(u[0][0],u[0][1])}}function Vw(o){var t,r;return t={},s("next"),s("throw",function(a){throw a}),s("return"),t[Symbol.iterator]=function(){return this},t;function s(a,u){t[a]=o[a]?function(f){return(r=!r)?{value:Ws(o[a](f)),done:a==="return"}:u?u(f):f}:u}}function Fw(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=o[Symbol.asyncIterator],r;return t?t.call(o):(o=typeof Ic=="function"?Ic(o):o[Symbol.iterator](),r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r);function s(u){r[u]=o[u]&&function(f){return new Promise(function(y,m){f=o[u](f),a(y,m,f.done,f.value)})}}function a(u,f,y,m){Promise.resolve(m).then(function(d){u({value:d,done:y})},f)}}function Bw(o,t){return Object.defineProperty?Object.defineProperty(o,"raw",{value:t}):o.raw=t,o}function Gw(o){if(o&&o.__esModule)return o;var t={};if(o!=null)for(var r in o)Object.hasOwnProperty.call(o,r)&&(t[r]=o[r]);return t.default=o,t}function Ww(o){return o&&o.__esModule?o:{default:o}}function Jw(o,t){if(!t.has(o))throw new TypeError("attempted to get private field on non-instance");return t.get(o)}function Qw(o,t,r){if(!t.has(o))throw new TypeError("attempted to set private field on non-instance");return t.set(o,r),r}const Yw=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Ec},__asyncDelegator:Vw,__asyncGenerator:Kw,__asyncValues:Fw,__await:Ws,__awaiter:jw,__classPrivateFieldGet:Jw,__classPrivateFieldSet:Qw,__createBinding:Mw,__decorate:Dw,__exportStar:Uw,__extends:$w,__generator:zw,__importDefault:Ww,__importStar:Gw,__makeTemplateObject:Bw,__metadata:Lw,__param:qw,__read:ef,__rest:Nw,__spread:Hw,__spreadArrays:kw,__values:Ic},Symbol.toStringTag,{value:"Module"})),Pa=Lc(Yw);var js={},ac={},zs={};class ki{}const Zw=Object.freeze(Object.defineProperty({__proto__:null,IEvents:ki},Symbol.toStringTag,{value:"Module"})),Xw=Lc(Zw);var el;function e_(){if(el)return zs;el=1,Object.defineProperty(zs,"__esModule",{value:!0}),zs.IHeartBeat=void 0;const o=Xw;class t extends o.IEvents{constructor(s){super()}}return zs.IHeartBeat=t,zs}var tl;function tf(){return tl||(tl=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),Pa.__exportStar(e_(),o)}(ac)),ac}var oc={},Mi={},rl;function t_(){if(rl)return Mi;rl=1,Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.HEARTBEAT_EVENTS=Mi.HEARTBEAT_INTERVAL=void 0;const o=X;return Mi.HEARTBEAT_INTERVAL=o.FIVE_SECONDS,Mi.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Mi}var il;function rf(){return il||(il=1,function(o){Object.defineProperty(o,"__esModule",{value:!0}),Pa.__exportStar(t_(),o)}(oc)),oc}var sl;function r_(){if(sl)return js;sl=1,Object.defineProperty(js,"__esModule",{value:!0}),js.HeartBeat=void 0;const o=Pa,t=Sr,r=X,s=tf(),a=rf();class u extends s.IHeartBeat{constructor(y){super(y),this.events=new t.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(y==null?void 0:y.interval)||a.HEARTBEAT_INTERVAL}static init(y){return o.__awaiter(this,void 0,void 0,function*(){const m=new u(y);return yield m.init(),m})}init(){return o.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(y,m){this.events.on(y,m)}once(y,m){this.events.once(y,m)}off(y,m){this.events.off(y,m)}removeListener(y,m){this.events.removeListener(y,m)}initialize(){return o.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return js.HeartBeat=u,js}(function(o){Object.defineProperty(o,"__esModule",{value:!0});const t=Pa;t.__exportStar(r_(),o),t.__exportStar(tf(),o),t.__exportStar(rf(),o)})(vs);function i_(o){try{return JSON.stringify(o)}catch{return'"[Circular]"'}}var s_=n_;function n_(o,t,r){var s=r&&r.stringify||i_,a=1;if(typeof o=="object"&&o!==null){var u=t.length+a;if(u===1)return o;var f=new Array(u);f[0]=s(o);for(var y=1;y<u;y++)f[y]=s(t[y]);return f.join(" ")}if(typeof o!="string")return o;var m=t.length;if(m===0)return o;for(var d="",_=1-a,S=-1,R=o&&o.length||0,N=0;N<R;){if(o.charCodeAt(N)===37&&N+1<R){switch(S=S>-1?S:0,o.charCodeAt(N+1)){case 100:case 102:if(_>=m||t[_]==null)break;S<N&&(d+=o.slice(S,N)),d+=Number(t[_]),S=N+2,N++;break;case 105:if(_>=m||t[_]==null)break;S<N&&(d+=o.slice(S,N)),d+=Math.floor(Number(t[_])),S=N+2,N++;break;case 79:case 111:case 106:if(_>=m||t[_]===void 0)break;S<N&&(d+=o.slice(S,N));var A=typeof t[_];if(A==="string"){d+="'"+t[_]+"'",S=N+2,N++;break}if(A==="function"){d+=t[_].name||"<anonymous>",S=N+2,N++;break}d+=s(t[_]),S=N+2,N++;break;case 115:if(_>=m)break;S<N&&(d+=o.slice(S,N)),d+=String(t[_]),S=N+2,N++;break;case 37:S<N&&(d+=o.slice(S,N)),d+="%",S=N+2,N++,_--;break}++_}++N}return S===-1?o:(S<R&&(d+=o.slice(S)),d)}const nl=s_;var a_=Vr;const Js=y_().console||{},o_={mapHttpRequest:la,mapHttpResponse:la,wrapRequestSerializer:cc,wrapResponseSerializer:cc,wrapErrorSerializer:cc,req:la,res:la,err:f_};function c_(o,t){return Array.isArray(o)?o.filter(function(s){return s!=="!stdSerializers.err"}):o===!0?Object.keys(t):!1}function Vr(o){o=o||{},o.browser=o.browser||{};const t=o.browser.transmit;if(t&&typeof t.send!="function")throw Error("pino: transmit option must have a send function");const r=o.browser.write||Js;o.browser.write&&(o.browser.asObject=!0);const s=o.serializers||{},a=c_(o.browser.serialize,s);let u=o.browser.serialize;Array.isArray(o.browser.serialize)&&o.browser.serialize.indexOf("!stdSerializers.err")>-1&&(u=!1);const f=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),o.enabled===!1&&(o.level="silent");const y=o.level||"info",m=Object.create(r);m.log||(m.log=Qs),Object.defineProperty(m,"levelVal",{get:_}),Object.defineProperty(m,"level",{get:S,set:R});const d={transmit:t,serialize:a,asObject:o.browser.asObject,levels:f,timestamp:p_(o)};m.levels=Vr.levels,m.level=y,m.setMaxListeners=m.getMaxListeners=m.emit=m.addListener=m.on=m.prependListener=m.once=m.prependOnceListener=m.removeListener=m.removeAllListeners=m.listeners=m.listenerCount=m.eventNames=m.write=m.flush=Qs,m.serializers=s,m._serialize=a,m._stdErrSerialize=u,m.child=N,t&&(m._logEvent=xc());function _(){return this.level==="silent"?1/0:this.levels.values[this.level]}function S(){return this._level}function R(A){if(A!=="silent"&&!this.levels.values[A])throw Error("unknown level "+A);this._level=A,hs(d,m,"error","log"),hs(d,m,"fatal","error"),hs(d,m,"warn","error"),hs(d,m,"info","log"),hs(d,m,"debug","log"),hs(d,m,"trace","log")}function N(A,Q){if(!A)throw new Error("missing bindings for child Pino");Q=Q||{},a&&A.serializers&&(Q.serializers=A.serializers);const te=Q.serializers;if(a&&te){var ce=Object.assign({},s,te),oe=o.browser.serialize===!0?Object.keys(ce):a;delete A.serializers,Sa([A],oe,ce,this._stdErrSerialize)}function ne(re){this._childLevel=(re._childLevel|0)+1,this.error=ls(re,A,"error"),this.fatal=ls(re,A,"fatal"),this.warn=ls(re,A,"warn"),this.info=ls(re,A,"info"),this.debug=ls(re,A,"debug"),this.trace=ls(re,A,"trace"),ce&&(this.serializers=ce,this._serialize=oe),t&&(this._logEvent=xc([].concat(re._logEvent.bindings,A)))}return ne.prototype=this,new ne(this)}return m}Vr.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};Vr.stdSerializers=o_;Vr.stdTimeFunctions=Object.assign({},{nullTime:sf,epochTime:nf,unixTime:d_,isoTime:g_});function hs(o,t,r,s){const a=Object.getPrototypeOf(t);t[r]=t.levelVal>t.levels.values[r]?Qs:a[r]?a[r]:Js[r]||Js[s]||Qs,u_(o,t,r)}function u_(o,t,r){!o.transmit&&t[r]===Qs||(t[r]=function(s){return function(){const u=o.timestamp(),f=new Array(arguments.length),y=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Js?Js:this;for(var m=0;m<f.length;m++)f[m]=arguments[m];if(o.serialize&&!o.asObject&&Sa(f,this._serialize,this.serializers,this._stdErrSerialize),o.asObject?s.call(y,h_(this,r,f,u)):s.apply(y,f),o.transmit){const d=o.transmit.level||t.level,_=Vr.levels.values[d],S=Vr.levels.values[r];if(S<_)return;l_(this,{ts:u,methodLevel:r,methodValue:S,transmitLevel:d,transmitValue:Vr.levels.values[o.transmit.level||t.level],send:o.transmit.send,val:t.levelVal},f)}}}(t[r]))}function h_(o,t,r,s){o._serialize&&Sa(r,o._serialize,o.serializers,o._stdErrSerialize);const a=r.slice();let u=a[0];const f={};s&&(f.time=s),f.level=Vr.levels.values[t];let y=(o._childLevel|0)+1;if(y<1&&(y=1),u!==null&&typeof u=="object"){for(;y--&&typeof a[0]=="object";)Object.assign(f,a.shift());u=a.length?nl(a.shift(),a):void 0}else typeof u=="string"&&(u=nl(a.shift(),a));return u!==void 0&&(f.msg=u),f}function Sa(o,t,r,s){for(const a in o)if(s&&o[a]instanceof Error)o[a]=Vr.stdSerializers.err(o[a]);else if(typeof o[a]=="object"&&!Array.isArray(o[a]))for(const u in o[a])t&&t.indexOf(u)>-1&&u in r&&(o[a][u]=r[u](o[a][u]))}function ls(o,t,r){return function(){const s=new Array(1+arguments.length);s[0]=t;for(var a=1;a<s.length;a++)s[a]=arguments[a-1];return o[r].apply(this,s)}}function l_(o,t,r){const s=t.send,a=t.ts,u=t.methodLevel,f=t.methodValue,y=t.val,m=o._logEvent.bindings;Sa(r,o._serialize||Object.keys(o.serializers),o.serializers,o._stdErrSerialize===void 0?!0:o._stdErrSerialize),o._logEvent.ts=a,o._logEvent.messages=r.filter(function(d){return m.indexOf(d)===-1}),o._logEvent.level.label=u,o._logEvent.level.value=f,s(u,o._logEvent,y),o._logEvent=xc(m)}function xc(o){return{ts:0,messages:[],bindings:o||[],level:{label:"",value:0}}}function f_(o){const t={type:o.constructor.name,msg:o.message,stack:o.stack};for(const r in o)t[r]===void 0&&(t[r]=o[r]);return t}function p_(o){return typeof o.timestamp=="function"?o.timestamp:o.timestamp===!1?sf:nf}function la(){return{}}function cc(o){return o}function Qs(){}function sf(){return!1}function nf(){return Date.now()}function d_(){return Math.round(Date.now()/1e3)}function g_(){return new Date(Date.now()).toISOString()}function y_(){function o(t){return typeof t<"u"&&t}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return o(self)||o(window)||o(this)||{}}}const Oa=jc(a_),v_={level:"info"},en="custom_context";var m_=Object.defineProperty,w_=Object.defineProperties,__=Object.getOwnPropertyDescriptors,al=Object.getOwnPropertySymbols,b_=Object.prototype.hasOwnProperty,E_=Object.prototype.propertyIsEnumerable,ol=(o,t,r)=>t in o?m_(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,I_=(o,t)=>{for(var r in t||(t={}))b_.call(t,r)&&ol(o,r,t[r]);if(al)for(var r of al(t))E_.call(t,r)&&ol(o,r,t[r]);return o},x_=(o,t)=>w_(o,__(t));function Ra(o){return x_(I_({},o),{level:(o==null?void 0:o.level)||v_.level})}function P_(o,t=en){return o[t]||""}function S_(o,t,r=en){return o[r]=t,o}function or(o,t=en){let r="";return typeof o.bindings>"u"?r=P_(o,t):r=o.bindings().context||"",r}function O_(o,t,r=en){const s=or(o,r);return s.trim()?`${s}/${t}`:t}function cr(o,t,r=en){const s=O_(o,t,r),a=o.child({context:s});return S_(a,s,r)}class R_ extends ki{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}let A_=class extends ki{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}},C_=class{constructor(t,r){this.logger=t,this.core=r}},T_=class extends ki{constructor(t,r){super(),this.relayer=t,this.logger=r}},$_=class extends ki{constructor(t){super()}},N_=class{constructor(t,r,s,a){this.core=t,this.logger=r,this.name=s}};class D_ extends ki{constructor(t,r){super(),this.relayer=t,this.logger=r}}let q_=class extends ki{constructor(t,r){super(),this.core=t,this.logger=r}},L_=class{constructor(t,r){this.projectId=t,this.logger=r}},j_=class{constructor(t,r){this.projectId=t,this.logger=r}},z_=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},M_=class{constructor(t){this.client=t}};var zc={},af={};(function(o){Object.defineProperty(o,"__esModule",{value:!0});var t=c0,r=Vl;o.DIGEST_LENGTH=64,o.BLOCK_SIZE=128;var s=function(){function y(){this.digestLength=o.DIGEST_LENGTH,this.blockSize=o.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return y.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},y.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},y.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},y.prototype.update=function(m,d){if(d===void 0&&(d=m.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var _=0;if(this._bytesHashed+=d,this._bufferLength>0){for(;this._bufferLength<o.BLOCK_SIZE&&d>0;)this._buffer[this._bufferLength++]=m[_++],d--;this._bufferLength===this.blockSize&&(u(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(d>=this.blockSize&&(_=u(this._tempHi,this._tempLo,this._stateHi,this._stateLo,m,_,d),d%=this.blockSize);d>0;)this._buffer[this._bufferLength++]=m[_++],d--;return this},y.prototype.finish=function(m){if(!this._finished){var d=this._bytesHashed,_=this._bufferLength,S=d/536870912|0,R=d<<3,N=d%128<112?128:256;this._buffer[_]=128;for(var A=_+1;A<N-8;A++)this._buffer[A]=0;t.writeUint32BE(S,this._buffer,N-8),t.writeUint32BE(R,this._buffer,N-4),u(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,N),this._finished=!0}for(var A=0;A<this.digestLength/8;A++)t.writeUint32BE(this._stateHi[A],m,A*8),t.writeUint32BE(this._stateLo[A],m,A*8+4);return this},y.prototype.digest=function(){var m=new Uint8Array(this.digestLength);return this.finish(m),m},y.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},y.prototype.restoreState=function(m){return this._stateHi.set(m.stateHi),this._stateLo.set(m.stateLo),this._bufferLength=m.bufferLength,m.buffer&&this._buffer.set(m.buffer),this._bytesHashed=m.bytesHashed,this._finished=!1,this},y.prototype.cleanSavedState=function(m){r.wipe(m.stateHi),r.wipe(m.stateLo),m.buffer&&r.wipe(m.buffer),m.bufferLength=0,m.bytesHashed=0},y}();o.SHA512=s;var a=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function u(y,m,d,_,S,R,N){for(var A=d[0],Q=d[1],te=d[2],ce=d[3],oe=d[4],ne=d[5],re=d[6],fe=d[7],pe=_[0],Y=_[1],xe=_[2],Tt=_[3],yt=_[4],Yt=_[5],Vt=_[6],ur=_[7],M,U,Ge,qe,G,K,H,V;N>=128;){for(var Ot=0;Ot<16;Ot++){var rt=8*Ot+R;y[Ot]=t.readUint32BE(S,rt),m[Ot]=t.readUint32BE(S,rt+4)}for(var Ot=0;Ot<80;Ot++){var xi=A,we=Q,Or=te,$=ce,T=oe,O=ne,h=re,E=fe,J=pe,ae=Y,ge=xe,Pe=Tt,Oe=yt,_e=Yt,vt=Vt,lt=ur;if(M=fe,U=ur,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=(oe>>>14|yt<<18)^(oe>>>18|yt<<14)^(yt>>>9|oe<<23),U=(yt>>>14|oe<<18)^(yt>>>18|oe<<14)^(oe>>>9|yt<<23),G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,M=oe&ne^~oe&re,U=yt&Yt^~yt&Vt,G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,M=a[Ot*2],U=a[Ot*2+1],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,M=y[Ot%16],U=m[Ot%16],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,Ge=H&65535|V<<16,qe=G&65535|K<<16,M=Ge,U=qe,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=(A>>>28|pe<<4)^(pe>>>2|A<<30)^(pe>>>7|A<<25),U=(pe>>>28|A<<4)^(A>>>2|pe<<30)^(A>>>7|pe<<25),G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,M=A&Q^A&te^Q&te,U=pe&Y^pe&xe^Y&xe,G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,E=H&65535|V<<16,lt=G&65535|K<<16,M=$,U=Pe,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=Ge,U=qe,G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,$=H&65535|V<<16,Pe=G&65535|K<<16,Q=xi,te=we,ce=Or,oe=$,ne=T,re=O,fe=h,A=E,Y=J,xe=ae,Tt=ge,yt=Pe,Yt=Oe,Vt=_e,ur=vt,pe=lt,Ot%16===15)for(var rt=0;rt<16;rt++)M=y[rt],U=m[rt],G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=y[(rt+9)%16],U=m[(rt+9)%16],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,Ge=y[(rt+1)%16],qe=m[(rt+1)%16],M=(Ge>>>1|qe<<31)^(Ge>>>8|qe<<24)^Ge>>>7,U=(qe>>>1|Ge<<31)^(qe>>>8|Ge<<24)^(qe>>>7|Ge<<25),G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,Ge=y[(rt+14)%16],qe=m[(rt+14)%16],M=(Ge>>>19|qe<<13)^(qe>>>29|Ge<<3)^Ge>>>6,U=(qe>>>19|Ge<<13)^(Ge>>>29|qe<<3)^(qe>>>6|Ge<<26),G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,y[rt]=H&65535|V<<16,m[rt]=G&65535|K<<16}M=A,U=pe,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=d[0],U=_[0],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,d[0]=A=H&65535|V<<16,_[0]=pe=G&65535|K<<16,M=Q,U=Y,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=d[1],U=_[1],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,d[1]=Q=H&65535|V<<16,_[1]=Y=G&65535|K<<16,M=te,U=xe,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=d[2],U=_[2],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,d[2]=te=H&65535|V<<16,_[2]=xe=G&65535|K<<16,M=ce,U=Tt,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=d[3],U=_[3],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,d[3]=ce=H&65535|V<<16,_[3]=Tt=G&65535|K<<16,M=oe,U=yt,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=d[4],U=_[4],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,d[4]=oe=H&65535|V<<16,_[4]=yt=G&65535|K<<16,M=ne,U=Yt,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=d[5],U=_[5],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,d[5]=ne=H&65535|V<<16,_[5]=Yt=G&65535|K<<16,M=re,U=Vt,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=d[6],U=_[6],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,d[6]=re=H&65535|V<<16,_[6]=Vt=G&65535|K<<16,M=fe,U=ur,G=U&65535,K=U>>>16,H=M&65535,V=M>>>16,M=d[7],U=_[7],G+=U&65535,K+=U>>>16,H+=M&65535,V+=M>>>16,K+=G>>>16,H+=K>>>16,V+=H>>>16,d[7]=fe=H&65535|V<<16,_[7]=ur=G&65535|K<<16,R+=128,N-=128}return R}function f(y){var m=new s;m.update(y);var d=m.digest();return m.clean(),d}o.hash=f})(af);(function(o){Object.defineProperty(o,"__esModule",{value:!0}),o.convertSecretKeyToX25519=o.convertPublicKeyToX25519=o.verify=o.sign=o.extractPublicKeyFromSecretKey=o.generateKeyPair=o.generateKeyPairFromSeed=o.SEED_LENGTH=o.SECRET_KEY_LENGTH=o.PUBLIC_KEY_LENGTH=o.SIGNATURE_LENGTH=void 0;const t=Fl,r=af,s=Vl;o.SIGNATURE_LENGTH=64,o.PUBLIC_KEY_LENGTH=32,o.SECRET_KEY_LENGTH=64,o.SEED_LENGTH=32;function a($){const T=new Float64Array(16);if($)for(let O=0;O<$.length;O++)T[O]=$[O];return T}const u=new Uint8Array(32);u[0]=9;const f=a(),y=a([1]),m=a([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),d=a([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),_=a([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),S=a([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),R=a([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function N($,T){for(let O=0;O<16;O++)$[O]=T[O]|0}function A($){let T=1;for(let O=0;O<16;O++){let h=$[O]+T+65535;T=Math.floor(h/65536),$[O]=h-T*65536}$[0]+=T-1+37*(T-1)}function Q($,T,O){const h=~(O-1);for(let E=0;E<16;E++){const J=h&($[E]^T[E]);$[E]^=J,T[E]^=J}}function te($,T){const O=a(),h=a();for(let E=0;E<16;E++)h[E]=T[E];A(h),A(h),A(h);for(let E=0;E<2;E++){O[0]=h[0]-65517;for(let ae=1;ae<15;ae++)O[ae]=h[ae]-65535-(O[ae-1]>>16&1),O[ae-1]&=65535;O[15]=h[15]-32767-(O[14]>>16&1);const J=O[15]>>16&1;O[14]&=65535,Q(h,O,1-J)}for(let E=0;E<16;E++)$[2*E]=h[E]&255,$[2*E+1]=h[E]>>8}function ce($,T){let O=0;for(let h=0;h<32;h++)O|=$[h]^T[h];return(1&O-1>>>8)-1}function oe($,T){const O=new Uint8Array(32),h=new Uint8Array(32);return te(O,$),te(h,T),ce(O,h)}function ne($){const T=new Uint8Array(32);return te(T,$),T[0]&1}function re($,T){for(let O=0;O<16;O++)$[O]=T[2*O]+(T[2*O+1]<<8);$[15]&=32767}function fe($,T,O){for(let h=0;h<16;h++)$[h]=T[h]+O[h]}function pe($,T,O){for(let h=0;h<16;h++)$[h]=T[h]-O[h]}function Y($,T,O){let h,E,J=0,ae=0,ge=0,Pe=0,Oe=0,_e=0,vt=0,lt=0,Ze=0,Ae=0,ke=0,Ke=0,Xe=0,Ne=0,Ve=0,Se=0,Le=0,it=0,Te=0,mt=0,Rt=0,Lt=0,jt=0,$t=0,Ft=0,Zt=0,jr=0,Bt=0,Fr=0,ai=0,Pi=0,st=O[0],We=O[1],nt=O[2],at=O[3],et=O[4],Je=O[5],wt=O[6],_t=O[7],ot=O[8],bt=O[9],ct=O[10],ft=O[11],ut=O[12],He=O[13],Et=O[14],It=O[15];h=T[0],J+=h*st,ae+=h*We,ge+=h*nt,Pe+=h*at,Oe+=h*et,_e+=h*Je,vt+=h*wt,lt+=h*_t,Ze+=h*ot,Ae+=h*bt,ke+=h*ct,Ke+=h*ft,Xe+=h*ut,Ne+=h*He,Ve+=h*Et,Se+=h*It,h=T[1],ae+=h*st,ge+=h*We,Pe+=h*nt,Oe+=h*at,_e+=h*et,vt+=h*Je,lt+=h*wt,Ze+=h*_t,Ae+=h*ot,ke+=h*bt,Ke+=h*ct,Xe+=h*ft,Ne+=h*ut,Ve+=h*He,Se+=h*Et,Le+=h*It,h=T[2],ge+=h*st,Pe+=h*We,Oe+=h*nt,_e+=h*at,vt+=h*et,lt+=h*Je,Ze+=h*wt,Ae+=h*_t,ke+=h*ot,Ke+=h*bt,Xe+=h*ct,Ne+=h*ft,Ve+=h*ut,Se+=h*He,Le+=h*Et,it+=h*It,h=T[3],Pe+=h*st,Oe+=h*We,_e+=h*nt,vt+=h*at,lt+=h*et,Ze+=h*Je,Ae+=h*wt,ke+=h*_t,Ke+=h*ot,Xe+=h*bt,Ne+=h*ct,Ve+=h*ft,Se+=h*ut,Le+=h*He,it+=h*Et,Te+=h*It,h=T[4],Oe+=h*st,_e+=h*We,vt+=h*nt,lt+=h*at,Ze+=h*et,Ae+=h*Je,ke+=h*wt,Ke+=h*_t,Xe+=h*ot,Ne+=h*bt,Ve+=h*ct,Se+=h*ft,Le+=h*ut,it+=h*He,Te+=h*Et,mt+=h*It,h=T[5],_e+=h*st,vt+=h*We,lt+=h*nt,Ze+=h*at,Ae+=h*et,ke+=h*Je,Ke+=h*wt,Xe+=h*_t,Ne+=h*ot,Ve+=h*bt,Se+=h*ct,Le+=h*ft,it+=h*ut,Te+=h*He,mt+=h*Et,Rt+=h*It,h=T[6],vt+=h*st,lt+=h*We,Ze+=h*nt,Ae+=h*at,ke+=h*et,Ke+=h*Je,Xe+=h*wt,Ne+=h*_t,Ve+=h*ot,Se+=h*bt,Le+=h*ct,it+=h*ft,Te+=h*ut,mt+=h*He,Rt+=h*Et,Lt+=h*It,h=T[7],lt+=h*st,Ze+=h*We,Ae+=h*nt,ke+=h*at,Ke+=h*et,Xe+=h*Je,Ne+=h*wt,Ve+=h*_t,Se+=h*ot,Le+=h*bt,it+=h*ct,Te+=h*ft,mt+=h*ut,Rt+=h*He,Lt+=h*Et,jt+=h*It,h=T[8],Ze+=h*st,Ae+=h*We,ke+=h*nt,Ke+=h*at,Xe+=h*et,Ne+=h*Je,Ve+=h*wt,Se+=h*_t,Le+=h*ot,it+=h*bt,Te+=h*ct,mt+=h*ft,Rt+=h*ut,Lt+=h*He,jt+=h*Et,$t+=h*It,h=T[9],Ae+=h*st,ke+=h*We,Ke+=h*nt,Xe+=h*at,Ne+=h*et,Ve+=h*Je,Se+=h*wt,Le+=h*_t,it+=h*ot,Te+=h*bt,mt+=h*ct,Rt+=h*ft,Lt+=h*ut,jt+=h*He,$t+=h*Et,Ft+=h*It,h=T[10],ke+=h*st,Ke+=h*We,Xe+=h*nt,Ne+=h*at,Ve+=h*et,Se+=h*Je,Le+=h*wt,it+=h*_t,Te+=h*ot,mt+=h*bt,Rt+=h*ct,Lt+=h*ft,jt+=h*ut,$t+=h*He,Ft+=h*Et,Zt+=h*It,h=T[11],Ke+=h*st,Xe+=h*We,Ne+=h*nt,Ve+=h*at,Se+=h*et,Le+=h*Je,it+=h*wt,Te+=h*_t,mt+=h*ot,Rt+=h*bt,Lt+=h*ct,jt+=h*ft,$t+=h*ut,Ft+=h*He,Zt+=h*Et,jr+=h*It,h=T[12],Xe+=h*st,Ne+=h*We,Ve+=h*nt,Se+=h*at,Le+=h*et,it+=h*Je,Te+=h*wt,mt+=h*_t,Rt+=h*ot,Lt+=h*bt,jt+=h*ct,$t+=h*ft,Ft+=h*ut,Zt+=h*He,jr+=h*Et,Bt+=h*It,h=T[13],Ne+=h*st,Ve+=h*We,Se+=h*nt,Le+=h*at,it+=h*et,Te+=h*Je,mt+=h*wt,Rt+=h*_t,Lt+=h*ot,jt+=h*bt,$t+=h*ct,Ft+=h*ft,Zt+=h*ut,jr+=h*He,Bt+=h*Et,Fr+=h*It,h=T[14],Ve+=h*st,Se+=h*We,Le+=h*nt,it+=h*at,Te+=h*et,mt+=h*Je,Rt+=h*wt,Lt+=h*_t,jt+=h*ot,$t+=h*bt,Ft+=h*ct,Zt+=h*ft,jr+=h*ut,Bt+=h*He,Fr+=h*Et,ai+=h*It,h=T[15],Se+=h*st,Le+=h*We,it+=h*nt,Te+=h*at,mt+=h*et,Rt+=h*Je,Lt+=h*wt,jt+=h*_t,$t+=h*ot,Ft+=h*bt,Zt+=h*ct,jr+=h*ft,Bt+=h*ut,Fr+=h*He,ai+=h*Et,Pi+=h*It,J+=38*Le,ae+=38*it,ge+=38*Te,Pe+=38*mt,Oe+=38*Rt,_e+=38*Lt,vt+=38*jt,lt+=38*$t,Ze+=38*Ft,Ae+=38*Zt,ke+=38*jr,Ke+=38*Bt,Xe+=38*Fr,Ne+=38*ai,Ve+=38*Pi,E=1,h=J+E+65535,E=Math.floor(h/65536),J=h-E*65536,h=ae+E+65535,E=Math.floor(h/65536),ae=h-E*65536,h=ge+E+65535,E=Math.floor(h/65536),ge=h-E*65536,h=Pe+E+65535,E=Math.floor(h/65536),Pe=h-E*65536,h=Oe+E+65535,E=Math.floor(h/65536),Oe=h-E*65536,h=_e+E+65535,E=Math.floor(h/65536),_e=h-E*65536,h=vt+E+65535,E=Math.floor(h/65536),vt=h-E*65536,h=lt+E+65535,E=Math.floor(h/65536),lt=h-E*65536,h=Ze+E+65535,E=Math.floor(h/65536),Ze=h-E*65536,h=Ae+E+65535,E=Math.floor(h/65536),Ae=h-E*65536,h=ke+E+65535,E=Math.floor(h/65536),ke=h-E*65536,h=Ke+E+65535,E=Math.floor(h/65536),Ke=h-E*65536,h=Xe+E+65535,E=Math.floor(h/65536),Xe=h-E*65536,h=Ne+E+65535,E=Math.floor(h/65536),Ne=h-E*65536,h=Ve+E+65535,E=Math.floor(h/65536),Ve=h-E*65536,h=Se+E+65535,E=Math.floor(h/65536),Se=h-E*65536,J+=E-1+37*(E-1),E=1,h=J+E+65535,E=Math.floor(h/65536),J=h-E*65536,h=ae+E+65535,E=Math.floor(h/65536),ae=h-E*65536,h=ge+E+65535,E=Math.floor(h/65536),ge=h-E*65536,h=Pe+E+65535,E=Math.floor(h/65536),Pe=h-E*65536,h=Oe+E+65535,E=Math.floor(h/65536),Oe=h-E*65536,h=_e+E+65535,E=Math.floor(h/65536),_e=h-E*65536,h=vt+E+65535,E=Math.floor(h/65536),vt=h-E*65536,h=lt+E+65535,E=Math.floor(h/65536),lt=h-E*65536,h=Ze+E+65535,E=Math.floor(h/65536),Ze=h-E*65536,h=Ae+E+65535,E=Math.floor(h/65536),Ae=h-E*65536,h=ke+E+65535,E=Math.floor(h/65536),ke=h-E*65536,h=Ke+E+65535,E=Math.floor(h/65536),Ke=h-E*65536,h=Xe+E+65535,E=Math.floor(h/65536),Xe=h-E*65536,h=Ne+E+65535,E=Math.floor(h/65536),Ne=h-E*65536,h=Ve+E+65535,E=Math.floor(h/65536),Ve=h-E*65536,h=Se+E+65535,E=Math.floor(h/65536),Se=h-E*65536,J+=E-1+37*(E-1),$[0]=J,$[1]=ae,$[2]=ge,$[3]=Pe,$[4]=Oe,$[5]=_e,$[6]=vt,$[7]=lt,$[8]=Ze,$[9]=Ae,$[10]=ke,$[11]=Ke,$[12]=Xe,$[13]=Ne,$[14]=Ve,$[15]=Se}function xe($,T){Y($,T,T)}function Tt($,T){const O=a();let h;for(h=0;h<16;h++)O[h]=T[h];for(h=253;h>=0;h--)xe(O,O),h!==2&&h!==4&&Y(O,O,T);for(h=0;h<16;h++)$[h]=O[h]}function yt($,T){const O=a();let h;for(h=0;h<16;h++)O[h]=T[h];for(h=250;h>=0;h--)xe(O,O),h!==1&&Y(O,O,T);for(h=0;h<16;h++)$[h]=O[h]}function Yt($,T){const O=a(),h=a(),E=a(),J=a(),ae=a(),ge=a(),Pe=a(),Oe=a(),_e=a();pe(O,$[1],$[0]),pe(_e,T[1],T[0]),Y(O,O,_e),fe(h,$[0],$[1]),fe(_e,T[0],T[1]),Y(h,h,_e),Y(E,$[3],T[3]),Y(E,E,d),Y(J,$[2],T[2]),fe(J,J,J),pe(ae,h,O),pe(ge,J,E),fe(Pe,J,E),fe(Oe,h,O),Y($[0],ae,ge),Y($[1],Oe,Pe),Y($[2],Pe,ge),Y($[3],ae,Oe)}function Vt($,T,O){for(let h=0;h<4;h++)Q($[h],T[h],O)}function ur($,T){const O=a(),h=a(),E=a();Tt(E,T[2]),Y(O,T[0],E),Y(h,T[1],E),te($,h),$[31]^=ne(O)<<7}function M($,T,O){N($[0],f),N($[1],y),N($[2],y),N($[3],f);for(let h=255;h>=0;--h){const E=O[h/8|0]>>(h&7)&1;Vt($,T,E),Yt(T,$),Yt($,$),Vt($,T,E)}}function U($,T){const O=[a(),a(),a(),a()];N(O[0],_),N(O[1],S),N(O[2],y),Y(O[3],_,S),M($,O,T)}function Ge($){if($.length!==o.SEED_LENGTH)throw new Error(`ed25519: seed must be ${o.SEED_LENGTH} bytes`);const T=(0,r.hash)($);T[0]&=248,T[31]&=127,T[31]|=64;const O=new Uint8Array(32),h=[a(),a(),a(),a()];U(h,T),ur(O,h);const E=new Uint8Array(64);return E.set($),E.set(O,32),{publicKey:O,secretKey:E}}o.generateKeyPairFromSeed=Ge;function qe($){const T=(0,t.randomBytes)(32,$),O=Ge(T);return(0,s.wipe)(T),O}o.generateKeyPair=qe;function G($){if($.length!==o.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${o.SECRET_KEY_LENGTH} bytes`);return new Uint8Array($.subarray(32))}o.extractPublicKeyFromSecretKey=G;const K=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function H($,T){let O,h,E,J;for(h=63;h>=32;--h){for(O=0,E=h-32,J=h-12;E<J;++E)T[E]+=O-16*T[h]*K[E-(h-32)],O=Math.floor((T[E]+128)/256),T[E]-=O*256;T[E]+=O,T[h]=0}for(O=0,E=0;E<32;E++)T[E]+=O-(T[31]>>4)*K[E],O=T[E]>>8,T[E]&=255;for(E=0;E<32;E++)T[E]-=O*K[E];for(h=0;h<32;h++)T[h+1]+=T[h]>>8,$[h]=T[h]&255}function V($){const T=new Float64Array(64);for(let O=0;O<64;O++)T[O]=$[O];for(let O=0;O<64;O++)$[O]=0;H($,T)}function Ot($,T){const O=new Float64Array(64),h=[a(),a(),a(),a()],E=(0,r.hash)($.subarray(0,32));E[0]&=248,E[31]&=127,E[31]|=64;const J=new Uint8Array(64);J.set(E.subarray(32),32);const ae=new r.SHA512;ae.update(J.subarray(32)),ae.update(T);const ge=ae.digest();ae.clean(),V(ge),U(h,ge),ur(J,h),ae.reset(),ae.update(J.subarray(0,32)),ae.update($.subarray(32)),ae.update(T);const Pe=ae.digest();V(Pe);for(let Oe=0;Oe<32;Oe++)O[Oe]=ge[Oe];for(let Oe=0;Oe<32;Oe++)for(let _e=0;_e<32;_e++)O[Oe+_e]+=Pe[Oe]*E[_e];return H(J.subarray(32),O),J}o.sign=Ot;function rt($,T){const O=a(),h=a(),E=a(),J=a(),ae=a(),ge=a(),Pe=a();return N($[2],y),re($[1],T),xe(E,$[1]),Y(J,E,m),pe(E,E,$[2]),fe(J,$[2],J),xe(ae,J),xe(ge,ae),Y(Pe,ge,ae),Y(O,Pe,E),Y(O,O,J),yt(O,O),Y(O,O,E),Y(O,O,J),Y(O,O,J),Y($[0],O,J),xe(h,$[0]),Y(h,h,J),oe(h,E)&&Y($[0],$[0],R),xe(h,$[0]),Y(h,h,J),oe(h,E)?-1:(ne($[0])===T[31]>>7&&pe($[0],f,$[0]),Y($[3],$[0],$[1]),0)}function xi($,T,O){const h=new Uint8Array(32),E=[a(),a(),a(),a()],J=[a(),a(),a(),a()];if(O.length!==o.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${o.SIGNATURE_LENGTH} bytes`);if(rt(J,$))return!1;const ae=new r.SHA512;ae.update(O.subarray(0,32)),ae.update($),ae.update(T);const ge=ae.digest();return V(ge),M(E,J,ge),U(J,O.subarray(32)),Yt(E,J),ur(h,E),!ce(O,h)}o.verify=xi;function we($){let T=[a(),a(),a(),a()];if(rt(T,$))throw new Error("Ed25519: invalid public key");let O=a(),h=a(),E=T[1];fe(O,y,E),pe(h,y,E),Tt(h,h),Y(O,O,h);let J=new Uint8Array(32);return te(J,O),J}o.convertPublicKeyToX25519=we;function Or($){const T=(0,r.hash)($.subarray(0,32));T[0]&=248,T[31]&=127,T[31]|=64;const O=new Uint8Array(T.subarray(0,32));return(0,s.wipe)(T),O}o.convertSecretKeyToX25519=Or})(zc);const U_="EdDSA",H_="JWT",of=".",cf="base64url",k_="utf8",K_="utf8",V_=":",F_="did",B_="key",cl="base58btc",G_="z",W_="K36",J_=32;function wa(o){return Ea(Tc(Ys(o),k_),cf)}function uf(o){const t=Tc(W_,cl),r=G_+Ea(u0([t,o]),cl);return[F_,B_,r].join(V_)}function Q_(o){return Ea(o,cf)}function Y_(o){return Tc([wa(o.header),wa(o.payload)].join(of),K_)}function Z_(o){return[wa(o.header),wa(o.payload),Q_(o.signature)].join(of)}function ul(o=Fl.randomBytes(J_)){return zc.generateKeyPairFromSeed(o)}async function X_(o,t,r,s,a=X.fromMiliseconds(Date.now())){const u={alg:U_,typ:H_},f=uf(s.publicKey),y=a+r,m={iss:f,sub:o,aud:t,iat:a,exp:y},d=Y_({header:u,payload:m}),_=zc.sign(s.secretKey,d);return Z_({header:u,payload:m,signature:_})}let e1=class extends Zl{constructor(t){super(t),this.events=new Sr.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(Ui(t.method,t.params||[],t.id||Nc().toString()),r)}async requestStrict(t,r){return new Promise(async(s,a)=>{if(!this.connection.connected)try{await this.open()}catch(u){a(u)}this.events.on(`${t.id}`,u=>{Lr(u)?a(u.error):s(u.result)});try{await this.connection.send(t,r)}catch(u){a(u)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),Zs(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const t1=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),r1=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",hl=o=>o.split("?")[0],ll=10,i1=t1();let s1=class{constructor(t){if(this.url=t,this.events=new Sr.EventEmitter,this.registering=!1,!Jh(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),t()},this.socket.close()})}async send(t){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Ys(t))}catch(r){this.onError(t.id,r)}}register(t=this.url){if(!Jh(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,a)=>{this.events.once("register_error",u=>{this.resetMaxListeners(),a(u)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return a(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,s)=>{const a=new URLSearchParams(t).get("origin"),u=Q0.isReactNative()?{headers:{origin:a}}:{rejectUnauthorized:!Y0(t)},f=new i1(t,[],u);r1()?f.onerror=y=>{const m=y;s(this.emitError(m.error))}:f.on("error",y=>{s(this.emitError(y))}),f.onopen=()=>{this.onOpen(f),r(f)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?Ia(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),a=s.message||s.toString(),u=Dc(t,a);this.events.emit("payload",u)}parseError(t,r=this.url){return Z0(t,hl(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>ll&&this.events.setMaxListeners(ll)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${hl(this.url)}`));return this.events.emit("register_error",r),r}};var _a={exports:{}};_a.exports;(function(o,t){var r=200,s="__lodash_hash_undefined__",a=1,u=2,f=9007199254740991,y="[object Arguments]",m="[object Array]",d="[object AsyncFunction]",_="[object Boolean]",S="[object Date]",R="[object Error]",N="[object Function]",A="[object GeneratorFunction]",Q="[object Map]",te="[object Number]",ce="[object Null]",oe="[object Object]",ne="[object Promise]",re="[object Proxy]",fe="[object RegExp]",pe="[object Set]",Y="[object String]",xe="[object Symbol]",Tt="[object Undefined]",yt="[object WeakMap]",Yt="[object ArrayBuffer]",Vt="[object DataView]",ur="[object Float32Array]",M="[object Float64Array]",U="[object Int8Array]",Ge="[object Int16Array]",qe="[object Int32Array]",G="[object Uint8Array]",K="[object Uint8ClampedArray]",H="[object Uint16Array]",V="[object Uint32Array]",Ot=/[\\^$.*+?()[\]{}|]/g,rt=/^\[object .+?Constructor\]$/,xi=/^(?:0|[1-9]\d*)$/,we={};we[ur]=we[M]=we[U]=we[Ge]=we[qe]=we[G]=we[K]=we[H]=we[V]=!0,we[y]=we[m]=we[Yt]=we[_]=we[Vt]=we[S]=we[R]=we[N]=we[Q]=we[te]=we[oe]=we[fe]=we[pe]=we[Y]=we[yt]=!1;var Or=typeof ca=="object"&&ca&&ca.Object===Object&&ca,$=typeof self=="object"&&self&&self.Object===Object&&self,T=Or||$||Function("return this")(),O=t&&!t.nodeType&&t,h=O&&!0&&o&&!o.nodeType&&o,E=h&&h.exports===O,J=E&&Or.process,ae=function(){try{return J&&J.binding&&J.binding("util")}catch{}}(),ge=ae&&ae.isTypedArray;function Pe(v,I){for(var j=-1,F=v==null?0:v.length,ze=0,he=[];++j<F;){var Fe=v[j];I(Fe,j,v)&&(he[ze++]=Fe)}return he}function Oe(v,I){for(var j=-1,F=I.length,ze=v.length;++j<F;)v[ze+j]=I[j];return v}function _e(v,I){for(var j=-1,F=v==null?0:v.length;++j<F;)if(I(v[j],j,v))return!0;return!1}function vt(v,I){for(var j=-1,F=Array(v);++j<v;)F[j]=I(j);return F}function lt(v){return function(I){return v(I)}}function Ze(v,I){return v.has(I)}function Ae(v,I){return v==null?void 0:v[I]}function ke(v){var I=-1,j=Array(v.size);return v.forEach(function(F,ze){j[++I]=[ze,F]}),j}function Ke(v,I){return function(j){return v(I(j))}}function Xe(v){var I=-1,j=Array(v.size);return v.forEach(function(F){j[++I]=F}),j}var Ne=Array.prototype,Ve=Function.prototype,Se=Object.prototype,Le=T["__core-js_shared__"],it=Ve.toString,Te=Se.hasOwnProperty,mt=function(){var v=/[^.]+$/.exec(Le&&Le.keys&&Le.keys.IE_PROTO||"");return v?"Symbol(src)_1."+v:""}(),Rt=Se.toString,Lt=RegExp("^"+it.call(Te).replace(Ot,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),jt=E?T.Buffer:void 0,$t=T.Symbol,Ft=T.Uint8Array,Zt=Se.propertyIsEnumerable,jr=Ne.splice,Bt=$t?$t.toStringTag:void 0,Fr=Object.getOwnPropertySymbols,ai=jt?jt.isBuffer:void 0,Pi=Ke(Object.keys,Object),st=hr(T,"DataView"),We=hr(T,"Map"),nt=hr(T,"Promise"),at=hr(T,"Set"),et=hr(T,"WeakMap"),Je=hr(Object,"create"),wt=Gr(st),_t=Gr(We),ot=Gr(nt),bt=Gr(at),ct=Gr(et),ft=$t?$t.prototype:void 0,ut=ft?ft.valueOf:void 0;function He(v){var I=-1,j=v==null?0:v.length;for(this.clear();++I<j;){var F=v[I];this.set(F[0],F[1])}}function Et(){this.__data__=Je?Je(null):{},this.size=0}function It(v){var I=this.has(v)&&delete this.__data__[v];return this.size-=I?1:0,I}function Ta(v){var I=this.__data__;if(Je){var j=I[v];return j===s?void 0:j}return Te.call(I,v)?I[v]:void 0}function $a(v){var I=this.__data__;return Je?I[v]!==void 0:Te.call(I,v)}function Na(v,I){var j=this.__data__;return this.size+=this.has(v)?0:1,j[v]=Je&&I===void 0?s:I,this}He.prototype.clear=Et,He.prototype.delete=It,He.prototype.get=Ta,He.prototype.has=$a,He.prototype.set=Na;function yr(v){var I=-1,j=v==null?0:v.length;for(this.clear();++I<j;){var F=v[I];this.set(F[0],F[1])}}function Da(){this.__data__=[],this.size=0}function qa(v){var I=this.__data__,j=Si(I,v);if(j<0)return!1;var F=I.length-1;return j==F?I.pop():jr.call(I,j,1),--this.size,!0}function La(v){var I=this.__data__,j=Si(I,v);return j<0?void 0:I[j][1]}function ja(v){return Si(this.__data__,v)>-1}function za(v,I){var j=this.__data__,F=Si(j,v);return F<0?(++this.size,j.push([v,I])):j[F][1]=I,this}yr.prototype.clear=Da,yr.prototype.delete=qa,yr.prototype.get=La,yr.prototype.has=ja,yr.prototype.set=za;function Br(v){var I=-1,j=v==null?0:v.length;for(this.clear();++I<j;){var F=v[I];this.set(F[0],F[1])}}function Vi(){this.size=0,this.__data__={hash:new He,map:new(We||yr),string:new He}}function Ma(v){var I=oi(this,v).delete(v);return this.size-=I?1:0,I}function Fi(v){return oi(this,v).get(v)}function Ua(v){return oi(this,v).has(v)}function Ha(v,I){var j=oi(this,v),F=j.size;return j.set(v,I),this.size+=j.size==F?0:1,this}Br.prototype.clear=Vi,Br.prototype.delete=Ma,Br.prototype.get=Fi,Br.prototype.has=Ua,Br.prototype.set=Ha;function Bi(v){var I=-1,j=v==null?0:v.length;for(this.__data__=new Br;++I<j;)this.add(v[I])}function rn(v){return this.__data__.set(v,s),this}function sn(v){return this.__data__.has(v)}Bi.prototype.add=Bi.prototype.push=rn,Bi.prototype.has=sn;function Rr(v){var I=this.__data__=new yr(v);this.size=I.size}function ka(){this.__data__=new yr,this.size=0}function Ka(v){var I=this.__data__,j=I.delete(v);return this.size=I.size,j}function Va(v){return this.__data__.get(v)}function Fa(v){return this.__data__.has(v)}function nn(v,I){var j=this.__data__;if(j instanceof yr){var F=j.__data__;if(!We||F.length<r-1)return F.push([v,I]),this.size=++j.size,this;j=this.__data__=new Br(F)}return j.set(v,I),this.size=j.size,this}Rr.prototype.clear=ka,Rr.prototype.delete=Ka,Rr.prototype.get=Va,Rr.prototype.has=Fa,Rr.prototype.set=nn;function an(v,I){var j=Ji(v),F=!j&&mn(v),ze=!j&&!F&&_s(v),he=!j&&!F&&!ze&&bn(v),Fe=j||F||ze||he,xt=Fe?vt(v.length,String):[],Ee=xt.length;for(var Me in v)Te.call(v,Me)&&!(Fe&&(Me=="length"||ze&&(Me=="offset"||Me=="parent")||he&&(Me=="buffer"||Me=="byteLength"||Me=="byteOffset")||pn(Me,Ee)))&&xt.push(Me);return xt}function Si(v,I){for(var j=v.length;j--;)if(vn(v[j][0],I))return j;return-1}function ms(v,I,j){var F=I(v);return Ji(v)?F:Oe(F,j(v))}function Oi(v){return v==null?v===void 0?Tt:ce:Bt&&Bt in Object(v)?ln(v):Wa(v)}function ws(v){return Ai(v)&&Oi(v)==y}function Ri(v,I,j,F,ze){return v===I?!0:v==null||I==null||!Ai(v)&&!Ai(I)?v!==v&&I!==I:on(v,I,j,F,Ri,ze)}function on(v,I,j,F,ze,he){var Fe=Ji(v),xt=Ji(I),Ee=Fe?m:zr(v),Me=xt?m:zr(I);Ee=Ee==y?oe:Ee,Me=Me==y?oe:Me;var pt=Ee==oe,Xt=Me==oe,Pt=Ee==Me;if(Pt&&_s(v)){if(!_s(I))return!1;Fe=!0,pt=!1}if(Pt&&!pt)return he||(he=new Rr),Fe||bn(v)?Gi(v,I,j,F,ze,he):Ga(v,I,Ee,j,F,ze,he);if(!(j&a)){var Be=pt&&Te.call(v,"__wrapped__"),Gt=Xt&&Te.call(I,"__wrapped__");if(Be||Gt){var Ar=Be?v.value():v,vr=Gt?I.value():I;return he||(he=new Rr),ze(Ar,vr,j,F,he)}}return Pt?(he||(he=new Rr),hn(v,I,j,F,ze,he)):!1}function Ba(v){if(!_n(v)||gn(v))return!1;var I=Qi(v)?Lt:rt;return I.test(Gr(v))}function cn(v){return Ai(v)&&wn(v.length)&&!!we[Oi(v)]}function un(v){if(!yn(v))return Pi(v);var I=[];for(var j in Object(v))Te.call(v,j)&&j!="constructor"&&I.push(j);return I}function Gi(v,I,j,F,ze,he){var Fe=j&a,xt=v.length,Ee=I.length;if(xt!=Ee&&!(Fe&&Ee>xt))return!1;var Me=he.get(v);if(Me&&he.get(I))return Me==I;var pt=-1,Xt=!0,Pt=j&u?new Bi:void 0;for(he.set(v,I),he.set(I,v);++pt<xt;){var Be=v[pt],Gt=I[pt];if(F)var Ar=Fe?F(Gt,Be,pt,I,v,he):F(Be,Gt,pt,v,I,he);if(Ar!==void 0){if(Ar)continue;Xt=!1;break}if(Pt){if(!_e(I,function(vr,Mr){if(!Ze(Pt,Mr)&&(Be===vr||ze(Be,vr,j,F,he)))return Pt.push(Mr)})){Xt=!1;break}}else if(!(Be===Gt||ze(Be,Gt,j,F,he))){Xt=!1;break}}return he.delete(v),he.delete(I),Xt}function Ga(v,I,j,F,ze,he,Fe){switch(j){case Vt:if(v.byteLength!=I.byteLength||v.byteOffset!=I.byteOffset)return!1;v=v.buffer,I=I.buffer;case Yt:return!(v.byteLength!=I.byteLength||!he(new Ft(v),new Ft(I)));case _:case S:case te:return vn(+v,+I);case R:return v.name==I.name&&v.message==I.message;case fe:case Y:return v==I+"";case Q:var xt=ke;case pe:var Ee=F&a;if(xt||(xt=Xe),v.size!=I.size&&!Ee)return!1;var Me=Fe.get(v);if(Me)return Me==I;F|=u,Fe.set(v,I);var pt=Gi(xt(v),xt(I),F,ze,he,Fe);return Fe.delete(v),pt;case xe:if(ut)return ut.call(v)==ut.call(I)}return!1}function hn(v,I,j,F,ze,he){var Fe=j&a,xt=Wi(v),Ee=xt.length,Me=Wi(I),pt=Me.length;if(Ee!=pt&&!Fe)return!1;for(var Xt=Ee;Xt--;){var Pt=xt[Xt];if(!(Fe?Pt in I:Te.call(I,Pt)))return!1}var Be=he.get(v);if(Be&&he.get(I))return Be==I;var Gt=!0;he.set(v,I),he.set(I,v);for(var Ar=Fe;++Xt<Ee;){Pt=xt[Xt];var vr=v[Pt],Mr=I[Pt];if(F)var bs=Fe?F(Mr,vr,Pt,I,v,he):F(vr,Mr,Pt,v,I,he);if(!(bs===void 0?vr===Mr||ze(vr,Mr,j,F,he):bs)){Gt=!1;break}Ar||(Ar=Pt=="constructor")}if(Gt&&!Ar){var Ci=v.constructor,Nt=I.constructor;Ci!=Nt&&"constructor"in v&&"constructor"in I&&!(typeof Ci=="function"&&Ci instanceof Ci&&typeof Nt=="function"&&Nt instanceof Nt)&&(Gt=!1)}return he.delete(v),he.delete(I),Gt}function Wi(v){return ms(v,Ya,fn)}function oi(v,I){var j=v.__data__;return dn(I)?j[typeof I=="string"?"string":"hash"]:j.map}function hr(v,I){var j=Ae(v,I);return Ba(j)?j:void 0}function ln(v){var I=Te.call(v,Bt),j=v[Bt];try{v[Bt]=void 0;var F=!0}catch{}var ze=Rt.call(v);return F&&(I?v[Bt]=j:delete v[Bt]),ze}var fn=Fr?function(v){return v==null?[]:(v=Object(v),Pe(Fr(v),function(I){return Zt.call(v,I)}))}:je,zr=Oi;(st&&zr(new st(new ArrayBuffer(1)))!=Vt||We&&zr(new We)!=Q||nt&&zr(nt.resolve())!=ne||at&&zr(new at)!=pe||et&&zr(new et)!=yt)&&(zr=function(v){var I=Oi(v),j=I==oe?v.constructor:void 0,F=j?Gr(j):"";if(F)switch(F){case wt:return Vt;case _t:return Q;case ot:return ne;case bt:return pe;case ct:return yt}return I});function pn(v,I){return I=I??f,!!I&&(typeof v=="number"||xi.test(v))&&v>-1&&v%1==0&&v<I}function dn(v){var I=typeof v;return I=="string"||I=="number"||I=="symbol"||I=="boolean"?v!=="__proto__":v===null}function gn(v){return!!mt&&mt in v}function yn(v){var I=v&&v.constructor,j=typeof I=="function"&&I.prototype||Se;return v===j}function Wa(v){return Rt.call(v)}function Gr(v){if(v!=null){try{return it.call(v)}catch{}try{return v+""}catch{}}return""}function vn(v,I){return v===I||v!==v&&I!==I}var mn=ws(function(){return arguments}())?ws:function(v){return Ai(v)&&Te.call(v,"callee")&&!Zt.call(v,"callee")},Ji=Array.isArray;function Ja(v){return v!=null&&wn(v.length)&&!Qi(v)}var _s=ai||De;function Qa(v,I){return Ri(v,I)}function Qi(v){if(!_n(v))return!1;var I=Oi(v);return I==N||I==A||I==d||I==re}function wn(v){return typeof v=="number"&&v>-1&&v%1==0&&v<=f}function _n(v){var I=typeof v;return v!=null&&(I=="object"||I=="function")}function Ai(v){return v!=null&&typeof v=="object"}var bn=ge?lt(ge):cn;function Ya(v){return Ja(v)?an(v):un(v)}function je(){return[]}function De(){return!1}o.exports=Qa})(_a,_a.exports);var n1=_a.exports;const a1=jc(n1);function o1(o,t){return t=t||{},new Promise(function(r,s){var a=new XMLHttpRequest,u=[],f=[],y={},m=function(){return{ok:(a.status/100|0)==2,statusText:a.statusText,status:a.status,url:a.responseURL,text:function(){return Promise.resolve(a.responseText)},json:function(){return Promise.resolve(a.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([a.response]))},clone:m,headers:{keys:function(){return u},entries:function(){return f},get:function(_){return y[_.toLowerCase()]},has:function(_){return _.toLowerCase()in y}}}};for(var d in a.open(t.method||"get",o,!0),a.onload=function(){a.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(_,S,R){u.push(S=S.toLowerCase()),f.push([S,R]),y[S]=y[S]?y[S]+","+R:R}),r(m())},a.onerror=s,a.withCredentials=t.credentials=="include",t.headers)a.setRequestHeader(d,t.headers[d]);a.send(t.body||null)})}const c1=Object.freeze(Object.defineProperty({__proto__:null,default:o1},Symbol.toStringTag,{value:"Module"})),fl=Lc(c1);var u1=self.fetch||(self.fetch=fl.default||fl);const h1=jc(u1);var l1={};function f1(o,t){if(o.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var a=0;a<o.length;a++){var u=o.charAt(a),f=u.charCodeAt(0);if(r[f]!==255)throw new TypeError(u+" is ambiguous");r[f]=a}var y=o.length,m=o.charAt(0),d=Math.log(y)/Math.log(256),_=Math.log(256)/Math.log(y);function S(A){if(A instanceof Uint8Array||(ArrayBuffer.isView(A)?A=new Uint8Array(A.buffer,A.byteOffset,A.byteLength):Array.isArray(A)&&(A=Uint8Array.from(A))),!(A instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(A.length===0)return"";for(var Q=0,te=0,ce=0,oe=A.length;ce!==oe&&A[ce]===0;)ce++,Q++;for(var ne=(oe-ce)*_+1>>>0,re=new Uint8Array(ne);ce!==oe;){for(var fe=A[ce],pe=0,Y=ne-1;(fe!==0||pe<te)&&Y!==-1;Y--,pe++)fe+=256*re[Y]>>>0,re[Y]=fe%y>>>0,fe=fe/y>>>0;if(fe!==0)throw new Error("Non-zero carry");te=pe,ce++}for(var xe=ne-te;xe!==ne&&re[xe]===0;)xe++;for(var Tt=m.repeat(Q);xe<ne;++xe)Tt+=o.charAt(re[xe]);return Tt}function R(A){if(typeof A!="string")throw new TypeError("Expected String");if(A.length===0)return new Uint8Array;var Q=0;if(A[Q]!==" "){for(var te=0,ce=0;A[Q]===m;)te++,Q++;for(var oe=(A.length-Q)*d+1>>>0,ne=new Uint8Array(oe);A[Q];){var re=r[A.charCodeAt(Q)];if(re===255)return;for(var fe=0,pe=oe-1;(re!==0||fe<ce)&&pe!==-1;pe--,fe++)re+=y*ne[pe]>>>0,ne[pe]=re%256>>>0,re=re/256>>>0;if(re!==0)throw new Error("Non-zero carry");ce=fe,Q++}if(A[Q]!==" "){for(var Y=oe-ce;Y!==oe&&ne[Y]===0;)Y++;for(var xe=new Uint8Array(te+(oe-Y)),Tt=te;Y!==oe;)xe[Tt++]=ne[Y++];return xe}}}function N(A){var Q=R(A);if(Q)return Q;throw new Error(`Non-${t} character`)}return{encode:S,decodeUnsafe:R,decode:N}}var p1=f1,d1=p1;const hf=o=>{if(o instanceof Uint8Array&&o.constructor.name==="Uint8Array")return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Unknown type, must be binary type")},g1=o=>new TextEncoder().encode(o),y1=o=>new TextDecoder().decode(o);class v1{constructor(t,r,s){this.name=t,this.prefix=r,this.baseEncode=s}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class m1{constructor(t,r,s){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return lf(this,t)}}class w1{constructor(t){this.decoders=t}or(t){return lf(this,t)}decode(t){const r=t[0],s=this.decoders[r];if(s)return s.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const lf=(o,t)=>new w1({...o.decoders||{[o.prefix]:o},...t.decoders||{[t.prefix]:t}});class _1{constructor(t,r,s,a){this.name=t,this.prefix=r,this.baseEncode=s,this.baseDecode=a,this.encoder=new v1(t,r,s),this.decoder=new m1(t,r,a)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const Aa=({name:o,prefix:t,encode:r,decode:s})=>new _1(o,t,r,s),tn=({prefix:o,name:t,alphabet:r})=>{const{encode:s,decode:a}=d1(r,t);return Aa({prefix:o,name:t,encode:s,decode:u=>hf(a(u))})},b1=(o,t,r,s)=>{const a={};for(let _=0;_<t.length;++_)a[t[_]]=_;let u=o.length;for(;o[u-1]==="=";)--u;const f=new Uint8Array(u*r/8|0);let y=0,m=0,d=0;for(let _=0;_<u;++_){const S=a[o[_]];if(S===void 0)throw new SyntaxError(`Non-${s} character`);m=m<<r|S,y+=r,y>=8&&(y-=8,f[d++]=255&m>>y)}if(y>=r||255&m<<8-y)throw new SyntaxError("Unexpected end of data");return f},E1=(o,t,r)=>{const s=t[t.length-1]==="=",a=(1<<r)-1;let u="",f=0,y=0;for(let m=0;m<o.length;++m)for(y=y<<8|o[m],f+=8;f>r;)f-=r,u+=t[a&y>>f];if(f&&(u+=t[a&y<<r-f]),s)for(;u.length*r&7;)u+="=";return u},Mt=({name:o,prefix:t,bitsPerChar:r,alphabet:s})=>Aa({prefix:t,name:o,encode(a){return E1(a,s,r)},decode(a){return b1(a,s,r,o)}}),I1=Aa({prefix:"\0",name:"identity",encode:o=>y1(o),decode:o=>g1(o)});var x1=Object.freeze({__proto__:null,identity:I1});const P1=Mt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var S1=Object.freeze({__proto__:null,base2:P1});const O1=Mt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var R1=Object.freeze({__proto__:null,base8:O1});const A1=tn({prefix:"9",name:"base10",alphabet:"0123456789"});var C1=Object.freeze({__proto__:null,base10:A1});const T1=Mt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),$1=Mt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var N1=Object.freeze({__proto__:null,base16:T1,base16upper:$1});const D1=Mt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),q1=Mt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),L1=Mt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),j1=Mt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),z1=Mt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),M1=Mt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),U1=Mt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),H1=Mt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),k1=Mt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var K1=Object.freeze({__proto__:null,base32:D1,base32upper:q1,base32pad:L1,base32padupper:j1,base32hex:z1,base32hexupper:M1,base32hexpad:U1,base32hexpadupper:H1,base32z:k1});const V1=tn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),F1=tn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var B1=Object.freeze({__proto__:null,base36:V1,base36upper:F1});const G1=tn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),W1=tn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var J1=Object.freeze({__proto__:null,base58btc:G1,base58flickr:W1});const Q1=Mt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Y1=Mt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Z1=Mt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),X1=Mt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var eb=Object.freeze({__proto__:null,base64:Q1,base64pad:Y1,base64url:Z1,base64urlpad:X1});const ff=Array.from(""),tb=ff.reduce((o,t,r)=>(o[r]=t,o),[]),rb=ff.reduce((o,t,r)=>(o[t.codePointAt(0)]=r,o),[]);function ib(o){return o.reduce((t,r)=>(t+=tb[r],t),"")}function sb(o){const t=[];for(const r of o){const s=rb[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(s)}return new Uint8Array(t)}const nb=Aa({prefix:"",name:"base256emoji",encode:ib,decode:sb});var ab=Object.freeze({__proto__:null,base256emoji:nb}),ob=pf,pl=128,cb=127,ub=~cb,hb=Math.pow(2,31);function pf(o,t,r){t=t||[],r=r||0;for(var s=r;o>=hb;)t[r++]=o&255|pl,o/=128;for(;o&ub;)t[r++]=o&255|pl,o>>>=7;return t[r]=o|0,pf.bytes=r-s+1,t}var lb=Pc,fb=128,dl=127;function Pc(o,s){var r=0,s=s||0,a=0,u=s,f,y=o.length;do{if(u>=y)throw Pc.bytes=0,new RangeError("Could not decode varint");f=o[u++],r+=a<28?(f&dl)<<a:(f&dl)*Math.pow(2,a),a+=7}while(f>=fb);return Pc.bytes=u-s,r}var pb=Math.pow(2,7),db=Math.pow(2,14),gb=Math.pow(2,21),yb=Math.pow(2,28),vb=Math.pow(2,35),mb=Math.pow(2,42),wb=Math.pow(2,49),_b=Math.pow(2,56),bb=Math.pow(2,63),Eb=function(o){return o<pb?1:o<db?2:o<gb?3:o<yb?4:o<vb?5:o<mb?6:o<wb?7:o<_b?8:o<bb?9:10},Ib={encode:ob,decode:lb,encodingLength:Eb},df=Ib;const gl=(o,t,r=0)=>(df.encode(o,t,r),t),yl=o=>df.encodingLength(o),Sc=(o,t)=>{const r=t.byteLength,s=yl(o),a=s+yl(r),u=new Uint8Array(a+r);return gl(o,u,0),gl(r,u,s),u.set(t,a),new xb(o,r,t,u)};class xb{constructor(t,r,s,a){this.code=t,this.size=r,this.digest=s,this.bytes=a}}const gf=({name:o,code:t,encode:r})=>new Pb(o,t,r);class Pb{constructor(t,r,s){this.name=t,this.code=r,this.encode=s}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?Sc(this.code,r):r.then(s=>Sc(this.code,s))}else throw Error("Unknown type, must be binary type")}}const yf=o=>async t=>new Uint8Array(await crypto.subtle.digest(o,t)),Sb=gf({name:"sha2-256",code:18,encode:yf("SHA-256")}),Ob=gf({name:"sha2-512",code:19,encode:yf("SHA-512")});var Rb=Object.freeze({__proto__:null,sha256:Sb,sha512:Ob});const vf=0,Ab="identity",mf=hf,Cb=o=>Sc(vf,mf(o)),Tb={code:vf,name:Ab,encode:mf,digest:Cb};var $b=Object.freeze({__proto__:null,identity:Tb});new TextEncoder,new TextDecoder;const vl={...x1,...S1,...R1,...C1,...N1,...K1,...B1,...J1,...eb,...ab};({...Rb,...$b});function wf(o){return globalThis.Buffer!=null?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):o}function Nb(o=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?wf(globalThis.Buffer.allocUnsafe(o)):new Uint8Array(o)}function _f(o,t,r,s){return{name:o,prefix:t,encoder:{name:o,prefix:t,encode:r},decoder:{decode:s}}}const ml=_f("utf8","u",o=>"u"+new TextDecoder("utf8").decode(o),o=>new TextEncoder().encode(o.substring(1))),uc=_f("ascii","a",o=>{let t="a";for(let r=0;r<o.length;r++)t+=String.fromCharCode(o[r]);return t},o=>{o=o.substring(1);const t=Nb(o.length);for(let r=0;r<o.length;r++)t[r]=o.charCodeAt(r);return t}),Db={utf8:ml,"utf-8":ml,hex:vl.base16,latin1:uc,ascii:uc,binary:uc,...vl};function qb(o,t="utf8"){const r=Db[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?wf(globalThis.Buffer.from(o,"utf-8")):r.decoder.decode(`${r.prefix}${o}`)}const bf="wc",Lb=2,Mc="core",_i=`${bf}@2:${Mc}:`,jb={name:Mc,logger:"error"},zb={database:":memory:"},Mb="crypto",wl="client_ed25519_seed",Ub=X.ONE_DAY,Hb="keychain",kb="0.3",Kb="messages",Vb="0.3",Fb=X.SIX_HOURS,Bb="publisher",Ef="irn",Gb="error",If="wss://relay.walletconnect.com",_l="wss://relay.walletconnect.org",Wb="relayer",Kt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Jb="_subscription",ii={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Qb=X.ONE_SECOND,Yb="2.11.0",Zb=1e4,Xb="0.3",eE="WALLETCONNECT_CLIENT_ID",Dr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},tE="subscription",rE="0.3",iE=X.FIVE_SECONDS*1e3,sE="pairing",nE="0.3",Ms={wc_pairingDelete:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:X.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:X.ONE_DAY,prompt:!1,tag:0},res:{ttl:X.ONE_DAY,prompt:!1,tag:0}}},Fs={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Kr={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},aE="history",oE="0.3",cE="expirer",Pr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},uE="0.3",hc="verify-api",ds="https://verify.walletconnect.com",Oc="https://verify.walletconnect.org",hE=[ds,Oc],lE="echo",fE="https://echo.walletconnect.com";class pE{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=Hb,this.version=kb,this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,a)=>{this.isInitialized(),this.keychain.set(s,a),await this.persist()},this.get=s=>{this.isInitialized();const a=this.keychain.get(s);if(typeof a>"u"){const{message:u}=B("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(u)}return a},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=t,this.logger=cr(r,this.name)}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,Jl(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Ql(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class dE{constructor(t,r,s){this.core=t,this.logger=r,this.name=Mb,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),u=ul(a);return uf(u.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=f0();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const u=await this.getClientSeed(),f=ul(u),y=mc();return await X_(y,a,Ub,f)},this.generateSharedKey=(a,u,f)=>{this.isInitialized();const y=this.getPrivateKey(a),m=p0(y,u);return this.setSymKey(m,f)},this.setSymKey=async(a,u)=>{this.isInitialized();const f=u||d0(a);return await this.keychain.set(f,a),f},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,u,f)=>{this.isInitialized();const y=g0(f),m=Ys(u);if(Kh(y)){const R=y.senderPublicKey,N=y.receiverPublicKey;a=await this.generateSharedKey(R,N)}const d=this.getSymKey(a),{type:_,senderPublicKey:S}=y;return y0({type:_,symKey:d,message:m,senderPublicKey:S})},this.decode=async(a,u,f)=>{this.isInitialized();const y=v0(u,f);if(Kh(y)){const m=y.receiverPublicKey,d=y.senderPublicKey;a=await this.generateSharedKey(m,d)}try{const m=this.getSymKey(a),d=m0({symKey:m,encoded:u});return Ia(d)}catch(m){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(m)}},this.getPayloadType=a=>{const u=Vh(a);return w0(u.type)},this.getPayloadSenderPublicKey=a=>{const u=Vh(a);return u.senderPublicKey?Ea(u.senderPublicKey,_0):void 0},this.core=t,this.logger=cr(r,this.name),this.keychain=s||new pE(this.core,this.logger)}get context(){return or(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get(wl)}catch{t=mc(),await this.keychain.set(wl,t)}return qb(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class gE extends C_{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=Kb,this.version=Vb,this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,a)=>{this.isInitialized();const u=gs(a);let f=this.messages.get(s);return typeof f>"u"&&(f={}),typeof f[u]<"u"||(f[u]=a,this.messages.set(s,f),await this.persist()),u},this.get=s=>{this.isInitialized();let a=this.messages.get(s);return typeof a>"u"&&(a={}),a},this.has=(s,a)=>{this.isInitialized();const u=this.get(s),f=gs(a);return typeof u[f]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=cr(t,this.name),this.core=r}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,Jl(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?Ql(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class yE extends T_{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new Sr.EventEmitter,this.name=Bb,this.queue=new Map,this.publishTimeout=X.toMiliseconds(X.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,a,u)=>{var f;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}});try{const y=(u==null?void 0:u.ttl)||Fb,m=wc(u),d=(u==null?void 0:u.prompt)||!1,_=(u==null?void 0:u.tag)||0,S=(u==null?void 0:u.id)||Nc().toString(),R={topic:s,message:a,opts:{ttl:y,relay:m,prompt:d,tag:_,id:S}},N=setTimeout(()=>this.queue.set(S,R),this.publishTimeout);try{await await Gs(this.rpcPublish(s,a,y,m,d,_,S),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(S),this.relayer.events.emit(Kt.publish,R)}catch(A){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(f=u==null?void 0:u.internal)!=null&&f.throwOnFailedPublish)throw this.removeRequestFromQueue(S),A;return}finally{clearTimeout(N)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:u}})}catch(y){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(y),y}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.relayer=t,this.logger=cr(r,this.name),this.registerEventListeners()}get context(){return or(this.logger)}rpcPublish(t,r,s,a,u,f,y){var m,d,_,S;const R={method:ga(a.protocol).publish,params:{topic:t,message:r,ttl:s,prompt:u,tag:f},id:y};return wi((m=R.params)==null?void 0:m.prompt)&&((d=R.params)==null||delete d.prompt),wi((_=R.params)==null?void 0:_.tag)&&((S=R.params)==null||delete S.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:R}),this.relayer.request(R)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:s,opts:a}=t;await this.publish(r,s,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(vs.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Kt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Kt.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class vE{constructor(){this.map=new Map,this.set=(t,r)=>{const s=this.get(t);this.exists(t,r)||this.map.set(t,[...s,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const s=this.get(t);if(!this.exists(t,r))return;const a=s.filter(u=>u!==r);if(!a.length){this.map.delete(t);return}this.map.set(t,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var mE=Object.defineProperty,wE=Object.defineProperties,_E=Object.getOwnPropertyDescriptors,bl=Object.getOwnPropertySymbols,bE=Object.prototype.hasOwnProperty,EE=Object.prototype.propertyIsEnumerable,El=(o,t,r)=>t in o?mE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Us=(o,t)=>{for(var r in t||(t={}))bE.call(t,r)&&El(o,r,t[r]);if(bl)for(var r of bl(t))EE.call(t,r)&&El(o,r,t[r]);return o},lc=(o,t)=>wE(o,_E(t));class IE extends D_{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new vE,this.events=new Sr.EventEmitter,this.name=tE,this.version=rE,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=_i,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}});try{const u=wc(a),f={topic:s,relay:u};this.pending.set(s,f);const y=await this.rpcSubscribe(s,u);return this.onSubscribe(y,f),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}}),y}catch(u){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(u),u}},this.unsubscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(s,a.id,a):await this.unsubscribeByTopic(s,a)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((a,u)=>{const f=new X.Watch;f.start(this.pendingSubscriptionWatchLabel);const y=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(y),f.stop(this.pendingSubscriptionWatchLabel),a(!0)),f.elapsed(this.pendingSubscriptionWatchLabel)>=iE&&(clearInterval(y),f.stop(this.pendingSubscriptionWatchLabel),u(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=cr(r,this.name),this.clientId=""}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let s=!1;try{s=this.getSubscription(t).topic===r}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const s=this.topicMap.get(t);await Promise.all(s.map(async a=>await this.unsubscribeById(t,a,r)))}async unsubscribeById(t,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}});try{const a=wc(s);await this.rpcUnsubscribe(t,r,a);const u=kt("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,u),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(t,r){const s={method:ga(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await Gs(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Kt.connection_stalled)}return gs(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,s={method:ga(r.protocol).batchSubscribe,params:{topics:t.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await Gs(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Kt.connection_stalled)}}rpcUnsubscribe(t,r,s){const a={method:ga(s.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(t,r){this.setSubscription(t,lc(Us({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,Us({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,s),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,Us({},r)),this.topicMap.set(r.topic,t),this.events.emit(Dr.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:s}=B("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const s=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(s.topic,t),this.events.emit(Dr.deleted,lc(Us({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Dr.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Dr.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);ys(r)&&this.onBatchSubscribe(r.map((s,a)=>lc(Us({},t[a]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(vs.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Kt.connect,async()=>{await this.onConnect()}),this.relayer.on(Kt.disconnect,()=>{this.onDisconnect()}),this.events.on(Dr.created,async t=>{const r=Dr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(Dr.deleted,async t=>{const r=Dr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var xE=Object.defineProperty,Il=Object.getOwnPropertySymbols,PE=Object.prototype.hasOwnProperty,SE=Object.prototype.propertyIsEnumerable,xl=(o,t,r)=>t in o?xE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,OE=(o,t)=>{for(var r in t||(t={}))PE.call(t,r)&&xl(o,r,t[r]);if(Il)for(var r of Il(t))SE.call(t,r)&&xl(o,r,t[r]);return o};class RE extends $_{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new Sr.EventEmitter,this.name=Wb,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Kt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Kt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ii.payload,this.onPayloadHandler),this.provider.on(ii.connect,this.onConnectHandler),this.provider.on(ii.disconnect,this.onDisconnectHandler),this.provider.on(ii.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?cr(t.logger,this.name):Oa(Ra({level:t.logger||Gb})),this.messages=new gE(this.logger,t.core),this.subscriber=new IE(this,this.logger),this.publisher=new yE(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||If,this.projectId=t.projectId,this.bundleId=b0(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${_l}...`),await this.restartTransport(_l)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},Zb)}get context(){return or(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,s){this.isInitialized(),await this.publisher.publish(t,r,s),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var s;this.isInitialized();let a=((s=this.subscriber.topicMap.get(t))==null?void 0:s[0])||"";if(a)return a;let u;const f=y=>{y.topic===t&&(this.subscriber.off(Dr.created,f),u())};return await Promise.all([new Promise(y=>{u=y,this.subscriber.on(Dr.created,f)}),new Promise(async y=>{a=await this.subscriber.subscribe(t,r),y()})]),a}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Gs(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(Dr.resubscribed,()=>{r()})}),new Promise(async(r,s)=>{try{await Gs(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){s(a);return}r()})])}catch(r){this.logger.error(r);const s=r;if(!this.isConnectionStalled(s.message))throw r;this.provider.events.emit(ii.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Fh())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new e1(new s1(E0({sdkVersion:Yb,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:s}=t;await this.messages.set(r,s)}async shouldIgnoreMessageEvent(t){const{topic:r,message:s}=t;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,s);return a&&this.logger.debug(`Ignoring duplicate message: ${s}`),a}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),qc(t)){if(!t.method.endsWith(Jb))return;const r=t.params,{topic:s,message:a,publishedAt:u}=r.data,f={topic:s,message:a,publishedAt:u};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(OE({type:"event",event:r.id},f)),this.events.emit(r.id,f),await this.acknowledgePayload(t),await this.onMessageEvent(f)}else Zs(t)&&this.events.emit(Kt.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Kt.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=xa(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ii.payload,this.onPayloadHandler),this.provider.off(ii.connect,this.onConnectHandler),this.provider.off(ii.disconnect,this.onDisconnectHandler),this.provider.off(ii.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Kt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await Fh();I0(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(Kt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},X.toMiliseconds(Qb)))}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var AE=Object.defineProperty,Pl=Object.getOwnPropertySymbols,CE=Object.prototype.hasOwnProperty,TE=Object.prototype.propertyIsEnumerable,Sl=(o,t,r)=>t in o?AE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Ol=(o,t)=>{for(var r in t||(t={}))CE.call(t,r)&&Sl(o,r,t[r]);if(Pl)for(var r of Pl(t))TE.call(t,r)&&Sl(o,r,t[r]);return o};class Ca extends N_{constructor(t,r,s,a=_i,u=void 0){super(t,r,s,a),this.core=t,this.logger=r,this.name=s,this.map=new Map,this.version=Xb,this.cached=[],this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(f=>{this.getKey&&f!==null&&!wi(f)?this.map.set(this.getKey(f),f):h0(f)?this.map.set(f.id,f):l0(f)&&this.map.set(f.topic,f)}),this.cached=[],this.initialized=!0)},this.set=async(f,y)=>{this.isInitialized(),this.map.has(f)?await this.update(f,y):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:f,value:y}),this.map.set(f,y),await this.persist())},this.get=f=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:f}),this.getData(f)),this.getAll=f=>(this.isInitialized(),f?this.values.filter(y=>Object.keys(f).every(m=>a1(y[m],f[m]))):this.values),this.update=async(f,y)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:f,update:y});const m=Ol(Ol({},this.getData(f)),y);this.map.set(f,m),await this.persist()},this.delete=async(f,y)=>{this.isInitialized(),this.map.has(f)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:f,reason:y}),this.map.delete(f),await this.persist())},this.logger=cr(r,this.name),this.storagePrefix=a,this.getKey=u}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:s}=B("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class $E{constructor(t,r){this.core=t,this.logger=r,this.name=sE,this.version=nE,this.events=new $c,this.initialized=!1,this.storagePrefix=_i,this.ignoredPayloadTypes=[Bl],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=mc(),a=await this.core.crypto.setSymKey(s),u=qr(X.FIVE_MINUTES),f={protocol:Ef},y={topic:a,expiry:u,relay:f,active:!1},m=x0({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:s,relay:f});return await this.pairings.set(a,y),await this.core.relayer.subscribe(a),this.core.expirer.set(a,u),{topic:a,uri:m}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:a,symKey:u,relay:f}=Bh(s.uri);let y;if(this.pairings.keys.includes(a)&&(y=this.pairings.get(a),y.active))throw new Error(`Pairing already exists: ${a}. Please try again with a new connection URI.`);const m=qr(X.FIVE_MINUTES),d={topic:a,relay:f,expiry:m,active:!1};return await this.pairings.set(a,d),this.core.expirer.set(a,m),s.activatePairing&&await this.activate({topic:a}),this.events.emit(Fs.create,d),this.core.crypto.keychain.has(a)||(await this.core.crypto.setSymKey(u,a),await this.core.relayer.subscribe(a,{relay:f})),d},this.activate=async({topic:s})=>{this.isInitialized();const a=qr(X.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:a}),this.core.expirer.set(s,a)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:a}=s;if(this.pairings.keys.includes(a)){const u=await this.sendRequest(a,"wc_pairingPing",{}),{done:f,resolve:y,reject:m}=fs();this.events.once(St("pairing_ping",u),({error:d})=>{d?m(d):y()}),await f()}},this.updateExpiry=async({topic:s,expiry:a})=>{this.isInitialized(),await this.pairings.update(s,{expiry:a})},this.updateMetadata=async({topic:s,metadata:a})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:a}=s;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",kt("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(s,a,u)=>{const f=Ui(a,u),y=await this.core.crypto.encode(s,f),m=Ms[a].req;return this.core.history.set(s,f),this.core.relayer.publish(s,y,m),f.id},this.sendResult=async(s,a,u)=>{const f=xa(s,u),y=await this.core.crypto.encode(a,f),m=await this.core.history.get(a,s),d=Ms[m.request.method].res;await this.core.relayer.publish(a,y,d),await this.core.history.resolve(f)},this.sendError=async(s,a,u)=>{const f=Dc(s,u),y=await this.core.crypto.encode(a,f),m=await this.core.history.get(a,s),d=Ms[m.request.method]?Ms[m.request.method].res:Ms.unregistered_method.res;await this.core.relayer.publish(a,y,d),await this.core.history.resolve(f)},this.deletePairing=async(s,a)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,kt("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),a?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(a=>mi(a.expiry));await Promise.all(s.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=s=>{const{topic:a,payload:u}=s;switch(u.method){case"wc_pairingPing":return this.onPairingPingRequest(a,u);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,u);default:return this.onUnknownRpcMethodRequest(a,u)}},this.onRelayEventResponse=async s=>{const{topic:a,payload:u}=s,f=(await this.core.history.get(a,u.id)).request.method;switch(f){case"wc_pairingPing":return this.onPairingPingResponse(a,u);default:return this.onUnknownRpcMethodResponse(f)}},this.onPairingPingRequest=async(s,a)=>{const{id:u}=a;try{this.isValidPing({topic:s}),await this.sendResult(u,s,!0),this.events.emit(Fs.ping,{id:u,topic:s})}catch(f){await this.sendError(u,s,f),this.logger.error(f)}},this.onPairingPingResponse=(s,a)=>{const{id:u}=a;setTimeout(()=>{vi(a)?this.events.emit(St("pairing_ping",u),{}):Lr(a)&&this.events.emit(St("pairing_ping",u),{error:a.error})},500)},this.onPairingDeleteRequest=async(s,a)=>{const{id:u}=a;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(Fs.delete,{id:u,topic:s})}catch(f){await this.sendError(u,s,f),this.logger.error(f)}},this.onUnknownRpcMethodRequest=async(s,a)=>{const{id:u,method:f}=a;try{if(this.registeredMethods.includes(f))return;const y=kt("WC_METHOD_UNSUPPORTED",f);await this.sendError(u,s,y),this.logger.error(y)}catch(y){await this.sendError(u,s,y),this.logger.error(y)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(kt("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{var a;if(!ar(s)){const{message:f}=B("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(f)}if(!P0(s.uri)){const{message:f}=B("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(f)}const u=Bh(s.uri);if(!((a=u==null?void 0:u.relay)!=null&&a.protocol)){const{message:f}=B("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(f)}if(!(u!=null&&u.symKey)){const{message:f}=B("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(f)}},this.isValidPing=async s=>{if(!ar(s)){const{message:u}=B("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidDisconnect=async s=>{if(!ar(s)){const{message:u}=B("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(u)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async s=>{if(!ps(s,!1)){const{message:a}=B("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(a)}if(!this.pairings.keys.includes(s)){const{message:a}=B("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(a)}if(mi(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:a}=B("EXPIRED",`pairing topic: ${s}`);throw new Error(a)}},this.core=t,this.logger=cr(r,this.name),this.pairings=new Ca(this.core,this.logger,this.name,this.storagePrefix)}get context(){return or(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Kt.message,async t=>{const{topic:r,message:s}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const a=await this.core.crypto.decode(r,s);try{qc(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):Zs(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(u){this.logger.error(u)}})}registerExpirerEvents(){this.core.expirer.on(Pr.expired,async t=>{const{topic:r}=Gl(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Fs.expire,{topic:r}))})}}class NE extends A_{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new Sr.EventEmitter,this.name=aE,this.version=oE,this.cached=[],this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,a,u)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:a,chainId:u}),this.records.has(a.id))return;const f={id:a.id,topic:s,request:{method:a.method,params:a.params||null},chainId:u,expiry:qr(X.THIRTY_DAYS)};this.records.set(f.id,f),this.events.emit(Kr.created,f)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const a=await this.getRecord(s.id);typeof a.response>"u"&&(a.response=Lr(s)?{error:s.error}:{result:s.result},this.records.set(a.id,a),this.events.emit(Kr.updated,a))},this.get=async(s,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:a}),await this.getRecord(a)),this.delete=(s,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(u=>{if(u.topic===s){if(typeof a<"u"&&u.id!==a)return;this.records.delete(u.id),this.events.emit(Kr.deleted,u)}})},this.exists=async(s,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===s:!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=cr(r,this.name)}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:Ui(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(s)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:s}=B("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Kr.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(Kr.created,t=>{const r=Kr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Kr.updated,t=>{const r=Kr.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(Kr.deleted,t=>{const r=Kr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(vs.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{X.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class DE extends q_{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new Sr.EventEmitter,this.name=cE,this.version=uE,this.cached=[],this.initialized=!1,this.storagePrefix=_i,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const a=this.formatTarget(s);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(s,a)=>{this.isInitialized();const u=this.formatTarget(s),f={target:u,expiry:a};this.expirations.set(u,f),this.checkExpiry(u,f),this.events.emit(Pr.created,{target:u,expiration:f})},this.get=s=>{this.isInitialized();const a=this.formatTarget(s);return this.getExpiration(a)},this.del=s=>{if(this.isInitialized(),this.has(s)){const a=this.formatTarget(s),u=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Pr.deleted,{target:a,expiration:u})}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=cr(r,this.name)}get context(){return or(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return S0(t);if(typeof t=="number")return O0(t);const{message:r}=B("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Pr.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:s}=B("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}checkExpiry(t,r){const{expiry:s}=r;X.toMiliseconds(s)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(Pr.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(vs.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Pr.created,t=>{const r=Pr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Pr.expired,t=>{const r=Pr.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Pr.deleted,t=>{const r=Pr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}}}class qE extends L_{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=hc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||R0()||!Wl())return;const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Oc;try{await this.createIframe()}catch(u){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(u),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const a=this.getVerifyUrl(s==null?void 0:s.verifyUrl);let u;try{u=await this.fetchAttestation(s.attestationId,a)}catch(f){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${a}`),this.logger.info(f),u=await this.fetchAttestation(s.attestationId,Oc)}return u},this.fetchAttestation=async(s,a)=>{this.logger.info(`resolving attestation: ${s} from url: ${a}`);const u=this.startAbortTimer(X.ONE_SECOND*2),f=await fetch(`${a}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(u),f.status===200?await f.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const a=u=>{u.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),s())};await Promise.race([new Promise(u=>{if(document.getElementById(hc))return u();window.addEventListener("message",a);const f=document.createElement("iframe");f.id=hc,f.src=`${this.verifyUrl}/${this.projectId}`,f.style.display="none",document.body.append(f),this.iframe=f,s=u}),new Promise((u,f)=>setTimeout(()=>{window.removeEventListener("message",a),f("verify iframe load timeout")},X.toMiliseconds(X.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=s=>{let a=s||ds;return hE.includes(a)||(this.logger.info(`verify url: ${a}, not included in trusted list, assigning default: ${ds}`),a=ds),a},this.logger=cr(r,this.name),this.verifyUrl=ds,this.abortController=new AbortController,this.isDevEnv=A0()&&l1.IS_VITEST}get context(){return or(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),X.toMiliseconds(t))}}class LE extends j_{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.context=lE,this.registerDeviceToken=async s=>{const{clientId:a,token:u,notificationType:f,enableEncrypted:y=!1}=s,m=`${fE}/${this.projectId}/clients`;await h1(m,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:a,type:f,token:u,always_raw:y})})},this.logger=cr(r,this.context)}}var jE=Object.defineProperty,Rl=Object.getOwnPropertySymbols,zE=Object.prototype.hasOwnProperty,ME=Object.prototype.propertyIsEnumerable,Al=(o,t,r)=>t in o?jE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Cl=(o,t)=>{for(var r in t||(t={}))zE.call(t,r)&&Al(o,r,t[r]);if(Rl)for(var r of Rl(t))ME.call(t,r)&&Al(o,r,t[r]);return o};class Uc extends R_{constructor(t){super(t),this.protocol=bf,this.version=Lb,this.name=Mc,this.events=new Sr.EventEmitter,this.initialized=!1,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||If,this.customStoragePrefix=t!=null&&t.customStoragePrefix?`:${t.customStoragePrefix}`:"";const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Oa(Ra({level:(t==null?void 0:t.logger)||jb.logger}));this.logger=cr(r,this.name),this.heartbeat=new vs.HeartBeat,this.crypto=new dE(this,this.logger,t==null?void 0:t.keychain),this.history=new NE(this,this.logger),this.expirer=new DE(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new Tw(Cl(Cl({},zb),t==null?void 0:t.storageOptions)),this.relayer=new RE({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new $E(this,this.logger),this.verify=new qE(this.projectId||"",this.logger),this.echoClient=new LE(this.projectId||"",this.logger)}static async init(t){const r=new Uc(t);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(eE,s),r}get context(){return or(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const UE=Uc,xf="wc",Pf=2,Sf="client",Hc=`${xf}@${Pf}:${Sf}:`,fc={name:Sf,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Tl="WALLETCONNECT_DEEPLINK_CHOICE",HE="proposal",Of="Proposal expired",kE="session",fa=X.SEVEN_DAYS,KE="engine",Hs={wc_sessionPropose:{req:{ttl:X.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1104},res:{ttl:X.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1106},res:{ttl:X.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:X.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:X.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:X.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:X.ONE_DAY,prompt:!1,tag:1112},res:{ttl:X.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:X.THIRTY_SECONDS,prompt:!1,tag:1115}}},pc={min:X.FIVE_MINUTES,max:X.SEVEN_DAYS},si={idle:"IDLE",active:"ACTIVE"},VE="request",FE=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var BE=Object.defineProperty,GE=Object.defineProperties,WE=Object.getOwnPropertyDescriptors,$l=Object.getOwnPropertySymbols,JE=Object.prototype.hasOwnProperty,QE=Object.prototype.propertyIsEnumerable,Nl=(o,t,r)=>t in o?BE(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,sr=(o,t)=>{for(var r in t||(t={}))JE.call(t,r)&&Nl(o,r,t[r]);if($l)for(var r of $l(t))QE.call(t,r)&&Nl(o,r,t[r]);return o},ks=(o,t)=>GE(o,WE(t));class YE extends M_{constructor(t){super(t),this.name=KE,this.events=new $c,this.initialized=!1,this.ignoredPayloadTypes=[Bl],this.requestQueue={state:si.idle,queue:[]},this.sessionRequestQueue={state:si.idle,queue:[]},this.requestQueueDelay=X.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Hs)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},X.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const s=ks(sr({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:a,requiredNamespaces:u,optionalNamespaces:f,sessionProperties:y,relays:m}=s;let d=a,_,S=!1;if(d&&(S=this.client.core.pairing.pairings.get(d).active),!d||!S){const{topic:ne,uri:re}=await this.client.core.pairing.create();d=ne,_=re}const R=await this.client.core.crypto.generateKeyPair(),N=sr({requiredNamespaces:u,optionalNamespaces:f,relays:m??[{protocol:Ef}],proposer:{publicKey:R,metadata:this.client.metadata}},y&&{sessionProperties:y}),{reject:A,resolve:Q,done:te}=fs(X.FIVE_MINUTES,Of);if(this.events.once(St("session_connect"),async({error:ne,session:re})=>{if(ne)A(ne);else if(re){re.self.publicKey=R;const fe=ks(sr({},re),{requiredNamespaces:re.requiredNamespaces,optionalNamespaces:re.optionalNamespaces});await this.client.session.set(re.topic,fe),await this.setExpiry(re.topic,re.expiry),d&&await this.client.core.pairing.updateMetadata({topic:d,metadata:re.peer.metadata}),Q(fe)}}),!d){const{message:ne}=B("NO_MATCHING_KEY",`connect() pairing topic: ${d}`);throw new Error(ne)}const ce=await this.sendRequest({topic:d,method:"wc_sessionPropose",params:N}),oe=qr(X.FIVE_MINUTES);return await this.setProposal(ce,sr({id:ce,expiry:oe},N)),{uri:_,approval:te}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:s,relayProtocol:a,namespaces:u,sessionProperties:f}=r,y=this.client.proposal.get(s);let{pairingTopic:m,proposer:d,requiredNamespaces:_,optionalNamespaces:S}=y;m=m||"",ya(_)||(_=T0(u,"approve()"));const R=await this.client.core.crypto.generateKeyPair(),N=d.publicKey,A=await this.client.core.crypto.generateSharedKey(R,N);m&&s&&(await this.client.core.pairing.updateMetadata({topic:m,metadata:d.metadata}),await this.sendResult({id:s,topic:m,result:{relay:{protocol:a??"irn"},responderPublicKey:R}}),await this.client.proposal.delete(s,kt("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:m}));const Q=sr({relay:{protocol:a??"irn"},namespaces:u,requiredNamespaces:_,optionalNamespaces:S,pairingTopic:m,controller:{publicKey:R,metadata:this.client.metadata},expiry:qr(fa)},f&&{sessionProperties:f});await this.client.core.relayer.subscribe(A),await this.sendRequest({topic:A,method:"wc_sessionSettle",params:Q,throwOnFailedPublish:!0});const te=ks(sr({},Q),{topic:A,pairingTopic:m,acknowledged:!1,self:Q.controller,peer:{publicKey:d.publicKey,metadata:d.metadata},controller:R});return await this.client.session.set(A,te),await this.setExpiry(A,qr(fa)),{topic:A,acknowledged:()=>new Promise(ce=>setTimeout(()=>ce(this.client.session.get(A)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:s,reason:a}=r,{pairingTopic:u}=this.client.proposal.get(s);u&&(await this.sendError(s,u,a),await this.client.proposal.delete(s,kt("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:s,namespaces:a}=r,u=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:f,resolve:y,reject:m}=fs();return this.events.once(St("session_update",u),({error:d})=>{d?m(d):y()}),await this.client.session.update(s,{namespaces:a}),{acknowledged:f}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:s}=r,a=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:u,resolve:f,reject:y}=fs();return this.events.once(St("session_extend",a),({error:m})=>{m?y(m):f()}),await this.setExpiry(s,qr(fa)),{acknowledged:u}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:s,request:a,topic:u,expiry:f}=r,y=X0(),{done:m,resolve:d,reject:_}=fs(f,"Request expired. Please try again.");return this.events.once(St("session_request",y),({error:S,result:R})=>{S?_(S):d(R)}),await Promise.all([new Promise(async S=>{await this.sendRequest({clientRpcId:y,topic:u,method:"wc_sessionRequest",params:{request:a,chainId:s},expiry:f,throwOnFailedPublish:!0}).catch(R=>_(R)),this.client.events.emit("session_request_sent",{topic:u,request:a,chainId:s,id:y}),S()}),new Promise(async S=>{const R=await $0(this.client.core.storage,Tl);N0({id:y,topic:u,wcDeepLink:R}),S()}),m()]).then(S=>S[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:a}=r,{id:u}=a;vi(a)?await this.sendResult({id:u,topic:s,result:a.result,throwOnFailedPublish:!0}):Lr(a)&&await this.sendError(u,s,a.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const a=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:u,resolve:f,reject:y}=fs();this.events.once(St("session_ping",a),({error:m})=>{m?y(m):f()}),await u()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:s,event:a,chainId:u}=r;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:a,chainId:u}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:kt("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(s=>D0(s,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(u=>{var f,y;return((f=u.peerMetadata)==null?void 0:f.url)&&((y=u.peerMetadata)==null?void 0:y.url)===r.peer.metadata.url&&u.topic&&u.topic!==s.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(u=>this.client.core.pairing.disconnect({topic:u.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(r,s)=>{const{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,kt("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),s||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Tl).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===r&&this.deletePendingSessionRequest(u.id,kt("USER_DISCONNECTED"))})},this.deleteProposal=async(r,s)=>{await Promise.all([this.client.proposal.delete(r,kt("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,s,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),a?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(u=>u.id!==r),a&&(this.sessionRequestQueue.state=si.idle)},this.setExpiry=async(r,s)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:s}),this.client.core.expirer.set(r,s)},this.setProposal=async(r,s)=>{await this.client.proposal.set(r,s),this.client.core.expirer.set(r,s.expiry)},this.setPendingSessionRequest=async r=>{const s=Hs.wc_sessionRequest.req.ttl,{id:a,topic:u,params:f,verifyContext:y}=r;await this.client.pendingRequest.set(a,{id:a,topic:u,params:f,verifyContext:y}),s&&this.client.core.expirer.set(a,qr(s))},this.sendRequest=async r=>{const{topic:s,method:a,params:u,expiry:f,relayRpcId:y,clientRpcId:m,throwOnFailedPublish:d}=r,_=Ui(a,u,m);if(Wl()&&FE.includes(a)){const N=gs(JSON.stringify(_));this.client.core.verify.register({attestationId:N})}const S=await this.client.core.crypto.encode(s,_),R=Hs[a].req;return f&&(R.ttl=f),y&&(R.id=y),this.client.core.history.set(s,_),d?(R.internal=ks(sr({},R.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,S,R)):this.client.core.relayer.publish(s,S,R).catch(N=>this.client.logger.error(N)),_.id},this.sendResult=async r=>{const{id:s,topic:a,result:u,throwOnFailedPublish:f}=r,y=xa(s,u),m=await this.client.core.crypto.encode(a,y),d=await this.client.core.history.get(a,s),_=Hs[d.request.method].res;f?(_.internal=ks(sr({},_.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,m,_)):this.client.core.relayer.publish(a,m,_).catch(S=>this.client.logger.error(S)),await this.client.core.history.resolve(y)},this.sendError=async(r,s,a)=>{const u=Dc(r,a),f=await this.client.core.crypto.encode(s,u),y=await this.client.core.history.get(s,r),m=Hs[y.request.method].res;this.client.core.relayer.publish(s,f,m),await this.client.core.history.resolve(u)},this.cleanup=async()=>{const r=[],s=[];this.client.session.getAll().forEach(a=>{mi(a.expiry)&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{mi(a.expiry)&&s.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession(a)),...s.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===si.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=si.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=si.idle},this.processRequest=r=>{const{topic:s,payload:a}=r,u=a.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeRequest(s,a);case"wc_sessionSettle":return this.onSessionSettleRequest(s,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,a);case"wc_sessionExtend":return this.onSessionExtendRequest(s,a);case"wc_sessionPing":return this.onSessionPingRequest(s,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,a);case"wc_sessionRequest":return this.onSessionRequest(s,a);case"wc_sessionEvent":return this.onSessionEventRequest(s,a);default:return this.client.logger.info(`Unsupported request method ${u}`)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:a}=r,u=(await this.client.core.history.get(s,a.id)).request.method;switch(u){case"wc_sessionPropose":return this.onSessionProposeResponse(s,a);case"wc_sessionSettle":return this.onSessionSettleResponse(s,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,a);case"wc_sessionExtend":return this.onSessionExtendResponse(s,a);case"wc_sessionPing":return this.onSessionPingResponse(s,a);case"wc_sessionRequest":return this.onSessionRequestResponse(s,a);default:return this.client.logger.info(`Unsupported response method ${u}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:s}=r,{message:a}=B("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,s)=>{const{params:a,id:u}=s;try{this.isValidConnect(sr({},s.params));const f=qr(X.FIVE_MINUTES),y=sr({id:u,pairingTopic:r,expiry:f},a);await this.setProposal(u,y);const m=gs(JSON.stringify(s)),d=await this.getVerifyContext(m,y.proposer.metadata);this.client.events.emit("session_proposal",{id:u,params:y,verifyContext:d})}catch(f){await this.sendError(u,r,f),this.client.logger.error(f)}},this.onSessionProposeResponse=async(r,s)=>{const{id:a}=s;if(vi(s)){const{result:u}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:u});const f=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:f});const y=f.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:y});const m=u.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:m});const d=await this.client.core.crypto.generateSharedKey(y,m);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:d});const _=await this.client.core.relayer.subscribe(d);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:_}),await this.client.core.pairing.activate({topic:r})}else Lr(s)&&(await this.client.proposal.delete(a,kt("USER_DISCONNECTED")),this.events.emit(St("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(r,s)=>{const{id:a,params:u}=s;try{this.isValidSessionSettleRequest(u);const{relay:f,controller:y,expiry:m,namespaces:d,requiredNamespaces:_,optionalNamespaces:S,sessionProperties:R,pairingTopic:N}=s.params,A=sr({topic:r,relay:f,expiry:m,namespaces:d,acknowledged:!0,pairingTopic:N,requiredNamespaces:_,optionalNamespaces:S,controller:y.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:y.publicKey,metadata:y.metadata}},R&&{sessionProperties:R});await this.sendResult({id:s.id,topic:r,result:!0}),this.events.emit(St("session_connect"),{session:A}),this.cleanupDuplicatePairings(A)}catch(f){await this.sendError(a,r,f),this.client.logger.error(f)}},this.onSessionSettleResponse=async(r,s)=>{const{id:a}=s;vi(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(St("session_approve",a),{})):Lr(s)&&(await this.client.session.delete(r,kt("USER_DISCONNECTED")),this.events.emit(St("session_approve",a),{error:s.error}))},this.onSessionUpdateRequest=async(r,s)=>{const{params:a,id:u}=s;try{const f=`${r}_session_update`,y=oa.get(f);if(y&&this.isRequestOutOfSync(y,u)){this.client.logger.info(`Discarding out of sync request - ${u}`);return}this.isValidUpdate(sr({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:u,topic:r,result:!0}),this.client.events.emit("session_update",{id:u,topic:r,params:a}),oa.set(f,u)}catch(f){await this.sendError(u,r,f),this.client.logger.error(f)}},this.isRequestOutOfSync=(r,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,s)=>{const{id:a}=s;vi(s)?this.events.emit(St("session_update",a),{}):Lr(s)&&this.events.emit(St("session_update",a),{error:s.error})},this.onSessionExtendRequest=async(r,s)=>{const{id:a}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,qr(fa)),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionExtendResponse=(r,s)=>{const{id:a}=s;vi(s)?this.events.emit(St("session_extend",a),{}):Lr(s)&&this.events.emit(St("session_extend",a),{error:s.error})},this.onSessionPingRequest=async(r,s)=>{const{id:a}=s;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(u){await this.sendError(a,r,u),this.client.logger.error(u)}},this.onSessionPingResponse=(r,s)=>{const{id:a}=s;setTimeout(()=>{vi(s)?this.events.emit(St("session_ping",a),{}):Lr(s)&&this.events.emit(St("session_ping",a),{error:s.error})},500)},this.onSessionDeleteRequest=async(r,s)=>{const{id:a}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(u=>{this.client.core.relayer.once(Kt.publish,async()=>{u(await this.deleteSession(r))})}),this.sendResult({id:a,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:r})}catch(u){this.client.logger.error(u)}},this.onSessionRequest=async(r,s)=>{const{id:a,params:u}=s;try{this.isValidRequest(sr({topic:r},u));const f=gs(JSON.stringify(Ui("wc_sessionRequest",u,a))),y=this.client.session.get(r),m=await this.getVerifyContext(f,y.peer.metadata),d={id:a,topic:r,params:u,verifyContext:m};await this.setPendingSessionRequest(d),this.addSessionRequestToSessionRequestQueue(d),this.processSessionRequestQueue()}catch(f){await this.sendError(a,r,f),this.client.logger.error(f)}},this.onSessionRequestResponse=(r,s)=>{const{id:a}=s;vi(s)?this.events.emit(St("session_request",a),{result:s.result}):Lr(s)&&this.events.emit(St("session_request",a),{error:s.error})},this.onSessionEventRequest=async(r,s)=>{const{id:a,params:u}=s;try{const f=`${r}_session_event_${u.event.name}`,y=oa.get(f);if(y&&this.isRequestOutOfSync(y,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(sr({topic:r},u)),this.client.events.emit("session_event",{id:a,topic:r,params:u}),oa.set(f,a)}catch(f){await this.sendError(a,r,f),this.client.logger.error(f)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=si.idle,this.processSessionRequestQueue()},X.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===si.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=si.active,this.client.events.emit("session_request",r)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=r=>{if(r.active)return;const s=this.client.proposal.getAll().find(a=>a.pairingTopic===r.topic);s&&this.onSessionProposeRequest(r.topic,Ui("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer,sessionProperties:s.sessionProperties},s.id))},this.isValidConnect=async r=>{if(!ar(r)){const{message:m}=B("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(m)}const{pairingTopic:s,requiredNamespaces:a,optionalNamespaces:u,sessionProperties:f,relays:y}=r;if(wi(s)||await this.isValidPairingTopic(s),!q0(y)){const{message:m}=B("MISSING_OR_INVALID",`connect() relays: ${y}`);throw new Error(m)}!wi(a)&&ya(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!wi(u)&&ya(u)!==0&&this.validateNamespaces(u,"optionalNamespaces"),wi(f)||this.validateSessionProps(f,"sessionProperties")},this.validateNamespaces=(r,s)=>{const a=L0(r,"connect()",s);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!ar(r))throw new Error(B("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:a,relayProtocol:u,sessionProperties:f}=r;await this.isValidProposalId(s);const y=this.client.proposal.get(s),m=rc(a,"approve()");if(m)throw new Error(m.message);const d=Gh(y.requiredNamespaces,a,"approve()");if(d)throw new Error(d.message);if(!ps(u,!0)){const{message:_}=B("MISSING_OR_INVALID",`approve() relayProtocol: ${u}`);throw new Error(_)}wi(f)||this.validateSessionProps(f,"sessionProperties")},this.isValidReject=async r=>{if(!ar(r)){const{message:u}=B("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(u)}const{id:s,reason:a}=r;if(await this.isValidProposalId(s),!j0(a)){const{message:u}=B("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(u)}},this.isValidSessionSettleRequest=r=>{if(!ar(r)){const{message:d}=B("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(d)}const{relay:s,controller:a,namespaces:u,expiry:f}=r;if(!z0(s)){const{message:d}=B("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(d)}const y=M0(a,"onSessionSettleRequest()");if(y)throw new Error(y.message);const m=rc(u,"onSessionSettleRequest()");if(m)throw new Error(m.message);if(mi(f)){const{message:d}=B("EXPIRED","onSessionSettleRequest()");throw new Error(d)}},this.isValidUpdate=async r=>{if(!ar(r)){const{message:m}=B("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(m)}const{topic:s,namespaces:a}=r;await this.isValidSessionTopic(s);const u=this.client.session.get(s),f=rc(a,"update()");if(f)throw new Error(f.message);const y=Gh(u.requiredNamespaces,a,"update()");if(y)throw new Error(y.message)},this.isValidExtend=async r=>{if(!ar(r)){const{message:a}=B("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionTopic(s)},this.isValidRequest=async r=>{if(!ar(r)){const{message:m}=B("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(m)}const{topic:s,request:a,chainId:u,expiry:f}=r;await this.isValidSessionTopic(s);const{namespaces:y}=this.client.session.get(s);if(!Wh(y,u)){const{message:m}=B("MISSING_OR_INVALID",`request() chainId: ${u}`);throw new Error(m)}if(!U0(a)){const{message:m}=B("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(m)}if(!H0(y,u,a.method)){const{message:m}=B("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(m)}if(f&&!k0(f,pc)){const{message:m}=B("MISSING_OR_INVALID",`request() expiry: ${f}. Expiry must be a number (in seconds) between ${pc.min} and ${pc.max}`);throw new Error(m)}},this.isValidRespond=async r=>{var s;if(!ar(r)){const{message:f}=B("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(f)}const{topic:a,response:u}=r;try{await this.isValidSessionTopic(a)}catch(f){throw(s=r==null?void 0:r.response)!=null&&s.id&&this.cleanupAfterResponse(r),f}if(!K0(u)){const{message:f}=B("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(u)}`);throw new Error(f)}},this.isValidPing=async r=>{if(!ar(r)){const{message:a}=B("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async r=>{if(!ar(r)){const{message:y}=B("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(y)}const{topic:s,event:a,chainId:u}=r;await this.isValidSessionTopic(s);const{namespaces:f}=this.client.session.get(s);if(!Wh(f,u)){const{message:y}=B("MISSING_OR_INVALID",`emit() chainId: ${u}`);throw new Error(y)}if(!V0(a)){const{message:y}=B("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(y)}if(!F0(f,u,a.name)){const{message:y}=B("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(y)}},this.isValidDisconnect=async r=>{if(!ar(r)){const{message:a}=B("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(r,s)=>{const a={verified:{verifyUrl:s.verifyUrl||ds,validation:"UNKNOWN",origin:s.url||""}};try{const u=await this.client.core.verify.resolve({attestationId:r,verifyUrl:s.verifyUrl});u&&(a.verified.origin=u.origin,a.verified.isScam=u.isScam,a.verified.validation=u.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.info(u)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,s)=>{Object.values(r).forEach(a=>{if(!ps(a,!1)){const{message:u}=B("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(u)}})}}async isInitialized(){if(!this.initialized){const{message:t}=B("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Kt.message,async t=>{const{topic:r,message:s}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const a=await this.client.core.crypto.decode(r,s);try{qc(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):Zs(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})}catch(u){this.client.logger.error(u)}})}registerExpirerEvents(){this.client.core.expirer.on(Pr.expired,async t=>{const{topic:r,id:s}=Gl(t.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,B("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(Fs.create,t=>this.onPairingCreated(t))}isValidPairingTopic(t){if(!ps(t,!1)){const{message:r}=B("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=B("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(mi(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=B("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!ps(t,!1)){const{message:r}=B("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=B("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(mi(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=B("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(ps(t,!1)){const{message:r}=B("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=B("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!B0(t)){const{message:r}=B("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=B("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(mi(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=B("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class ZE extends Ca{constructor(t,r){super(t,r,HE,Hc),this.core=t,this.logger=r}}class XE extends Ca{constructor(t,r){super(t,r,kE,Hc),this.core=t,this.logger=r}}class eI extends Ca{constructor(t,r){super(t,r,VE,Hc,s=>s.id),this.core=t,this.logger=r}}let tI=class Rf extends z_{constructor(t){super(t),this.protocol=xf,this.version=Pf,this.name=fc.name,this.events=new Sr.EventEmitter,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(a){throw this.logger.error(a.message),a}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(a){throw this.logger.error(a.message),a}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(a){throw this.logger.error(a.message),a}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(a){throw this.logger.error(a.message),a}},this.update=async s=>{try{return await this.engine.update(s)}catch(a){throw this.logger.error(a.message),a}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(a){throw this.logger.error(a.message),a}},this.request=async s=>{try{return await this.engine.request(s)}catch(a){throw this.logger.error(a.message),a}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(a){throw this.logger.error(a.message),a}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(a){throw this.logger.error(a.message),a}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(a){throw this.logger.error(a.message),a}},this.find=s=>{try{return this.engine.find(s)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(t==null?void 0:t.name)||fc.name,this.metadata=(t==null?void 0:t.metadata)||C0();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Oa(Ra({level:(t==null?void 0:t.logger)||fc.logger}));this.core=(t==null?void 0:t.core)||new UE(t),this.logger=cr(r,this.name),this.session=new XE(this.core,this.logger),this.proposal=new ZE(this.core,this.logger),this.pendingRequest=new eI(this.core,this.logger),this.engine=new YE(this)}static async init(t){const r=new Rf(t);return await r.initialize(),r}get context(){return or(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};class Ii extends Zl{constructor(t){super(t),this.events=new Sr.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(Ui(t.method,t.params||[],t.id||Nc().toString()),r)}async requestStrict(t,r){return new Promise(async(s,a)=>{if(!this.connection.connected)try{await this.open()}catch(u){a(u)}this.events.on(`${t.id}`,u=>{Lr(u)?a(u.error):s(u.result)});try{await this.connection.send(t,r)}catch(u){a(u)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),Zs(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const Dl="error",rI="wss://relay.walletconnect.com",iI="wc",sI="universal_provider",ql=`${iI}@2:${sI}:`,nI="https://rpc.walletconnect.com/v1/",ni={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Ks=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Rc={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(o,t){(function(){var r,s="4.17.21",a=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",f="Expected a function",y="Invalid `variable` option passed into `_.template`",m="__lodash_hash_undefined__",d=500,_="__lodash_placeholder__",S=1,R=2,N=4,A=1,Q=2,te=1,ce=2,oe=4,ne=8,re=16,fe=32,pe=64,Y=128,xe=256,Tt=512,yt=30,Yt="...",Vt=800,ur=16,M=1,U=2,Ge=3,qe=1/0,G=9007199254740991,K=17976931348623157e292,H=NaN,V=4294967295,Ot=V-1,rt=V>>>1,xi=[["ary",Y],["bind",te],["bindKey",ce],["curry",ne],["curryRight",re],["flip",Tt],["partial",fe],["partialRight",pe],["rearg",xe]],we="[object Arguments]",Or="[object Array]",$="[object AsyncFunction]",T="[object Boolean]",O="[object Date]",h="[object DOMException]",E="[object Error]",J="[object Function]",ae="[object GeneratorFunction]",ge="[object Map]",Pe="[object Number]",Oe="[object Null]",_e="[object Object]",vt="[object Promise]",lt="[object Proxy]",Ze="[object RegExp]",Ae="[object Set]",ke="[object String]",Ke="[object Symbol]",Xe="[object Undefined]",Ne="[object WeakMap]",Ve="[object WeakSet]",Se="[object ArrayBuffer]",Le="[object DataView]",it="[object Float32Array]",Te="[object Float64Array]",mt="[object Int8Array]",Rt="[object Int16Array]",Lt="[object Int32Array]",jt="[object Uint8Array]",$t="[object Uint8ClampedArray]",Ft="[object Uint16Array]",Zt="[object Uint32Array]",jr=/\b__p \+= '';/g,Bt=/\b(__p \+=) '' \+/g,Fr=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ai=/&(?:amp|lt|gt|quot|#39);/g,Pi=/[&<>"']/g,st=RegExp(ai.source),We=RegExp(Pi.source),nt=/<%-([\s\S]+?)%>/g,at=/<%([\s\S]+?)%>/g,et=/<%=([\s\S]+?)%>/g,Je=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,wt=/^\w*$/,_t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ot=/[\\^$.*+?()[\]{}|]/g,bt=RegExp(ot.source),ct=/^\s+/,ft=/\s/,ut=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,He=/\{\n\/\* \[wrapped with (.+)\] \*/,Et=/,? & /,It=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ta=/[()=,{}\[\]\/\s]/,$a=/\\(\\)?/g,Na=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,yr=/\w*$/,Da=/^[-+]0x[0-9a-f]+$/i,qa=/^0b[01]+$/i,La=/^\[object .+?Constructor\]$/,ja=/^0o[0-7]+$/i,za=/^(?:0|[1-9]\d*)$/,Br=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Vi=/($^)/,Ma=/['\n\r\u2028\u2029\\]/g,Fi="\\ud800-\\udfff",Ua="\\u0300-\\u036f",Ha="\\ufe20-\\ufe2f",Bi="\\u20d0-\\u20ff",rn=Ua+Ha+Bi,sn="\\u2700-\\u27bf",Rr="a-z\\xdf-\\xf6\\xf8-\\xff",ka="\\xac\\xb1\\xd7\\xf7",Ka="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Va="\\u2000-\\u206f",Fa=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",nn="A-Z\\xc0-\\xd6\\xd8-\\xde",an="\\ufe0e\\ufe0f",Si=ka+Ka+Va+Fa,ms="[']",Oi="["+Fi+"]",ws="["+Si+"]",Ri="["+rn+"]",on="\\d+",Ba="["+sn+"]",cn="["+Rr+"]",un="[^"+Fi+Si+on+sn+Rr+nn+"]",Gi="\\ud83c[\\udffb-\\udfff]",Ga="(?:"+Ri+"|"+Gi+")",hn="[^"+Fi+"]",Wi="(?:\\ud83c[\\udde6-\\uddff]){2}",oi="[\\ud800-\\udbff][\\udc00-\\udfff]",hr="["+nn+"]",ln="\\u200d",fn="(?:"+cn+"|"+un+")",zr="(?:"+hr+"|"+un+")",pn="(?:"+ms+"(?:d|ll|m|re|s|t|ve))?",dn="(?:"+ms+"(?:D|LL|M|RE|S|T|VE))?",gn=Ga+"?",yn="["+an+"]?",Wa="(?:"+ln+"(?:"+[hn,Wi,oi].join("|")+")"+yn+gn+")*",Gr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",vn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",mn=yn+gn+Wa,Ji="(?:"+[Ba,Wi,oi].join("|")+")"+mn,Ja="(?:"+[hn+Ri+"?",Ri,Wi,oi,Oi].join("|")+")",_s=RegExp(ms,"g"),Qa=RegExp(Ri,"g"),Qi=RegExp(Gi+"(?="+Gi+")|"+Ja+mn,"g"),wn=RegExp([hr+"?"+cn+"+"+pn+"(?="+[ws,hr,"$"].join("|")+")",zr+"+"+dn+"(?="+[ws,hr+fn,"$"].join("|")+")",hr+"?"+fn+"+"+pn,hr+"+"+dn,vn,Gr,on,Ji].join("|"),"g"),_n=RegExp("["+ln+Fi+rn+an+"]"),Ai=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,bn=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Ya=-1,je={};je[it]=je[Te]=je[mt]=je[Rt]=je[Lt]=je[jt]=je[$t]=je[Ft]=je[Zt]=!0,je[we]=je[Or]=je[Se]=je[T]=je[Le]=je[O]=je[E]=je[J]=je[ge]=je[Pe]=je[_e]=je[Ze]=je[Ae]=je[ke]=je[Ne]=!1;var De={};De[we]=De[Or]=De[Se]=De[Le]=De[T]=De[O]=De[it]=De[Te]=De[mt]=De[Rt]=De[Lt]=De[ge]=De[Pe]=De[_e]=De[Ze]=De[Ae]=De[ke]=De[Ke]=De[jt]=De[$t]=De[Ft]=De[Zt]=!0,De[E]=De[J]=De[Ne]=!1;var v={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},I={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},j={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},F={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ze=parseFloat,he=parseInt,Fe=typeof Ks=="object"&&Ks&&Ks.Object===Object&&Ks,xt=typeof self=="object"&&self&&self.Object===Object&&self,Ee=Fe||xt||Function("return this")(),Me=t&&!t.nodeType&&t,pt=Me&&!0&&o&&!o.nodeType&&o,Xt=pt&&pt.exports===Me,Pt=Xt&&Fe.process,Be=function(){try{var x=pt&&pt.require&&pt.require("util").types;return x||Pt&&Pt.binding&&Pt.binding("util")}catch{}}(),Gt=Be&&Be.isArrayBuffer,Ar=Be&&Be.isDate,vr=Be&&Be.isMap,Mr=Be&&Be.isRegExp,bs=Be&&Be.isSet,Ci=Be&&Be.isTypedArray;function Nt(x,D,C){switch(C.length){case 0:return x.call(D);case 1:return x.call(D,C[0]);case 2:return x.call(D,C[0],C[1]);case 3:return x.call(D,C[0],C[1],C[2])}return x.apply(D,C)}function Tf(x,D,C,W){for(var ue=-1,Re=x==null?0:x.length;++ue<Re;){var At=x[ue];D(W,At,C(At),x)}return W}function mr(x,D){for(var C=-1,W=x==null?0:x.length;++C<W&&D(x[C],C,x)!==!1;);return x}function $f(x,D){for(var C=x==null?0:x.length;C--&&D(x[C],C,x)!==!1;);return x}function Vc(x,D){for(var C=-1,W=x==null?0:x.length;++C<W;)if(!D(x[C],C,x))return!1;return!0}function ci(x,D){for(var C=-1,W=x==null?0:x.length,ue=0,Re=[];++C<W;){var At=x[C];D(At,C,x)&&(Re[ue++]=At)}return Re}function En(x,D){var C=x==null?0:x.length;return!!C&&Yi(x,D,0)>-1}function Za(x,D,C){for(var W=-1,ue=x==null?0:x.length;++W<ue;)if(C(D,x[W]))return!0;return!1}function Qe(x,D){for(var C=-1,W=x==null?0:x.length,ue=Array(W);++C<W;)ue[C]=D(x[C],C,x);return ue}function ui(x,D){for(var C=-1,W=D.length,ue=x.length;++C<W;)x[ue+C]=D[C];return x}function Xa(x,D,C,W){var ue=-1,Re=x==null?0:x.length;for(W&&Re&&(C=x[++ue]);++ue<Re;)C=D(C,x[ue],ue,x);return C}function Nf(x,D,C,W){var ue=x==null?0:x.length;for(W&&ue&&(C=x[--ue]);ue--;)C=D(C,x[ue],ue,x);return C}function eo(x,D){for(var C=-1,W=x==null?0:x.length;++C<W;)if(D(x[C],C,x))return!0;return!1}var Df=to("length");function qf(x){return x.split("")}function Lf(x){return x.match(It)||[]}function Fc(x,D,C){var W;return C(x,function(ue,Re,At){if(D(ue,Re,At))return W=Re,!1}),W}function In(x,D,C,W){for(var ue=x.length,Re=C+(W?1:-1);W?Re--:++Re<ue;)if(D(x[Re],Re,x))return Re;return-1}function Yi(x,D,C){return D===D?Wf(x,D,C):In(x,Bc,C)}function jf(x,D,C,W){for(var ue=C-1,Re=x.length;++ue<Re;)if(W(x[ue],D))return ue;return-1}function Bc(x){return x!==x}function Gc(x,D){var C=x==null?0:x.length;return C?io(x,D)/C:H}function to(x){return function(D){return D==null?r:D[x]}}function ro(x){return function(D){return x==null?r:x[D]}}function Wc(x,D,C,W,ue){return ue(x,function(Re,At,Ue){C=W?(W=!1,Re):D(C,Re,At,Ue)}),C}function zf(x,D){var C=x.length;for(x.sort(D);C--;)x[C]=x[C].value;return x}function io(x,D){for(var C,W=-1,ue=x.length;++W<ue;){var Re=D(x[W]);Re!==r&&(C=C===r?Re:C+Re)}return C}function so(x,D){for(var C=-1,W=Array(x);++C<x;)W[C]=D(C);return W}function Mf(x,D){return Qe(D,function(C){return[C,x[C]]})}function Jc(x){return x&&x.slice(0,Xc(x)+1).replace(ct,"")}function lr(x){return function(D){return x(D)}}function no(x,D){return Qe(D,function(C){return x[C]})}function Es(x,D){return x.has(D)}function Qc(x,D){for(var C=-1,W=x.length;++C<W&&Yi(D,x[C],0)>-1;);return C}function Yc(x,D){for(var C=x.length;C--&&Yi(D,x[C],0)>-1;);return C}function Uf(x,D){for(var C=x.length,W=0;C--;)x[C]===D&&++W;return W}var Hf=ro(v),kf=ro(I);function Kf(x){return"\\"+F[x]}function Vf(x,D){return x==null?r:x[D]}function Zi(x){return _n.test(x)}function Ff(x){return Ai.test(x)}function Bf(x){for(var D,C=[];!(D=x.next()).done;)C.push(D.value);return C}function ao(x){var D=-1,C=Array(x.size);return x.forEach(function(W,ue){C[++D]=[ue,W]}),C}function Zc(x,D){return function(C){return x(D(C))}}function hi(x,D){for(var C=-1,W=x.length,ue=0,Re=[];++C<W;){var At=x[C];(At===D||At===_)&&(x[C]=_,Re[ue++]=C)}return Re}function xn(x){var D=-1,C=Array(x.size);return x.forEach(function(W){C[++D]=W}),C}function Gf(x){var D=-1,C=Array(x.size);return x.forEach(function(W){C[++D]=[W,W]}),C}function Wf(x,D,C){for(var W=C-1,ue=x.length;++W<ue;)if(x[W]===D)return W;return-1}function Jf(x,D,C){for(var W=C+1;W--;)if(x[W]===D)return W;return W}function Xi(x){return Zi(x)?Yf(x):Df(x)}function Cr(x){return Zi(x)?Zf(x):qf(x)}function Xc(x){for(var D=x.length;D--&&ft.test(x.charAt(D)););return D}var Qf=ro(j);function Yf(x){for(var D=Qi.lastIndex=0;Qi.test(x);)++D;return D}function Zf(x){return x.match(Qi)||[]}function Xf(x){return x.match(wn)||[]}var ep=function x(D){D=D==null?Ee:es.defaults(Ee.Object(),D,es.pick(Ee,bn));var C=D.Array,W=D.Date,ue=D.Error,Re=D.Function,At=D.Math,Ue=D.Object,oo=D.RegExp,tp=D.String,wr=D.TypeError,Pn=C.prototype,rp=Re.prototype,ts=Ue.prototype,Sn=D["__core-js_shared__"],On=rp.toString,$e=ts.hasOwnProperty,ip=0,eu=function(){var e=/[^.]+$/.exec(Sn&&Sn.keys&&Sn.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Rn=ts.toString,sp=On.call(Ue),np=Ee._,ap=oo("^"+On.call($e).replace(ot,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),An=Xt?D.Buffer:r,li=D.Symbol,Cn=D.Uint8Array,tu=An?An.allocUnsafe:r,Tn=Zc(Ue.getPrototypeOf,Ue),ru=Ue.create,iu=ts.propertyIsEnumerable,$n=Pn.splice,su=li?li.isConcatSpreadable:r,Is=li?li.iterator:r,Ti=li?li.toStringTag:r,Nn=function(){try{var e=Li(Ue,"defineProperty");return e({},"",{}),e}catch{}}(),op=D.clearTimeout!==Ee.clearTimeout&&D.clearTimeout,cp=W&&W.now!==Ee.Date.now&&W.now,up=D.setTimeout!==Ee.setTimeout&&D.setTimeout,Dn=At.ceil,qn=At.floor,co=Ue.getOwnPropertySymbols,hp=An?An.isBuffer:r,nu=D.isFinite,lp=Pn.join,fp=Zc(Ue.keys,Ue),Ct=At.max,Ut=At.min,pp=W.now,dp=D.parseInt,au=At.random,gp=Pn.reverse,uo=Li(D,"DataView"),xs=Li(D,"Map"),ho=Li(D,"Promise"),rs=Li(D,"Set"),Ps=Li(D,"WeakMap"),Ss=Li(Ue,"create"),Ln=Ps&&new Ps,is={},yp=ji(uo),vp=ji(xs),mp=ji(ho),wp=ji(rs),_p=ji(Ps),jn=li?li.prototype:r,Os=jn?jn.valueOf:r,ou=jn?jn.toString:r;function p(e){if(ht(e)&&!le(e)&&!(e instanceof be)){if(e instanceof _r)return e;if($e.call(e,"__wrapped__"))return ch(e)}return new _r(e)}var ss=function(){function e(){}return function(i){if(!tt(i))return{};if(ru)return ru(i);e.prototype=i;var n=new e;return e.prototype=r,n}}();function zn(){}function _r(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}p.templateSettings={escape:nt,evaluate:at,interpolate:et,variable:"",imports:{_:p}},p.prototype=zn.prototype,p.prototype.constructor=p,_r.prototype=ss(zn.prototype),_r.prototype.constructor=_r;function be(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=V,this.__views__=[]}function bp(){var e=new be(this.__wrapped__);return e.__actions__=er(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=er(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=er(this.__views__),e}function Ep(){if(this.__filtered__){var e=new be(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Ip(){var e=this.__wrapped__.value(),i=this.__dir__,n=le(e),c=i<0,l=n?e.length:0,g=qd(0,l,this.__views__),w=g.start,b=g.end,P=b-w,q=c?b:w-1,L=this.__iteratees__,z=L.length,k=0,Z=Ut(P,this.__takeCount__);if(!n||!c&&l==P&&Z==P)return Tu(e,this.__actions__);var ie=[];e:for(;P--&&k<Z;){q+=i;for(var ye=-1,se=e[q];++ye<z;){var me=L[ye],Ie=me.iteratee,dr=me.type,Qt=Ie(se);if(dr==U)se=Qt;else if(!Qt){if(dr==M)continue e;break e}}ie[k++]=se}return ie}be.prototype=ss(zn.prototype),be.prototype.constructor=be;function $i(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function xp(){this.__data__=Ss?Ss(null):{},this.size=0}function Pp(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function Sp(e){var i=this.__data__;if(Ss){var n=i[e];return n===m?r:n}return $e.call(i,e)?i[e]:r}function Op(e){var i=this.__data__;return Ss?i[e]!==r:$e.call(i,e)}function Rp(e,i){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Ss&&i===r?m:i,this}$i.prototype.clear=xp,$i.prototype.delete=Pp,$i.prototype.get=Sp,$i.prototype.has=Op,$i.prototype.set=Rp;function Wr(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function Ap(){this.__data__=[],this.size=0}function Cp(e){var i=this.__data__,n=Mn(i,e);if(n<0)return!1;var c=i.length-1;return n==c?i.pop():$n.call(i,n,1),--this.size,!0}function Tp(e){var i=this.__data__,n=Mn(i,e);return n<0?r:i[n][1]}function $p(e){return Mn(this.__data__,e)>-1}function Np(e,i){var n=this.__data__,c=Mn(n,e);return c<0?(++this.size,n.push([e,i])):n[c][1]=i,this}Wr.prototype.clear=Ap,Wr.prototype.delete=Cp,Wr.prototype.get=Tp,Wr.prototype.has=$p,Wr.prototype.set=Np;function Jr(e){var i=-1,n=e==null?0:e.length;for(this.clear();++i<n;){var c=e[i];this.set(c[0],c[1])}}function Dp(){this.size=0,this.__data__={hash:new $i,map:new(xs||Wr),string:new $i}}function qp(e){var i=Yn(this,e).delete(e);return this.size-=i?1:0,i}function Lp(e){return Yn(this,e).get(e)}function jp(e){return Yn(this,e).has(e)}function zp(e,i){var n=Yn(this,e),c=n.size;return n.set(e,i),this.size+=n.size==c?0:1,this}Jr.prototype.clear=Dp,Jr.prototype.delete=qp,Jr.prototype.get=Lp,Jr.prototype.has=jp,Jr.prototype.set=zp;function Ni(e){var i=-1,n=e==null?0:e.length;for(this.__data__=new Jr;++i<n;)this.add(e[i])}function Mp(e){return this.__data__.set(e,m),this}function Up(e){return this.__data__.has(e)}Ni.prototype.add=Ni.prototype.push=Mp,Ni.prototype.has=Up;function Tr(e){var i=this.__data__=new Wr(e);this.size=i.size}function Hp(){this.__data__=new Wr,this.size=0}function kp(e){var i=this.__data__,n=i.delete(e);return this.size=i.size,n}function Kp(e){return this.__data__.get(e)}function Vp(e){return this.__data__.has(e)}function Fp(e,i){var n=this.__data__;if(n instanceof Wr){var c=n.__data__;if(!xs||c.length<a-1)return c.push([e,i]),this.size=++n.size,this;n=this.__data__=new Jr(c)}return n.set(e,i),this.size=n.size,this}Tr.prototype.clear=Hp,Tr.prototype.delete=kp,Tr.prototype.get=Kp,Tr.prototype.has=Vp,Tr.prototype.set=Fp;function cu(e,i){var n=le(e),c=!n&&zi(e),l=!n&&!c&&yi(e),g=!n&&!c&&!l&&cs(e),w=n||c||l||g,b=w?so(e.length,tp):[],P=b.length;for(var q in e)(i||$e.call(e,q))&&!(w&&(q=="length"||l&&(q=="offset"||q=="parent")||g&&(q=="buffer"||q=="byteLength"||q=="byteOffset")||Xr(q,P)))&&b.push(q);return b}function uu(e){var i=e.length;return i?e[Eo(0,i-1)]:r}function Bp(e,i){return Zn(er(e),Di(i,0,e.length))}function Gp(e){return Zn(er(e))}function lo(e,i,n){(n!==r&&!$r(e[i],n)||n===r&&!(i in e))&&Qr(e,i,n)}function Rs(e,i,n){var c=e[i];(!($e.call(e,i)&&$r(c,n))||n===r&&!(i in e))&&Qr(e,i,n)}function Mn(e,i){for(var n=e.length;n--;)if($r(e[n][0],i))return n;return-1}function Wp(e,i,n,c){return fi(e,function(l,g,w){i(c,l,n(l),w)}),c}function hu(e,i){return e&&Hr(i,Dt(i),e)}function Jp(e,i){return e&&Hr(i,rr(i),e)}function Qr(e,i,n){i=="__proto__"&&Nn?Nn(e,i,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[i]=n}function fo(e,i){for(var n=-1,c=i.length,l=C(c),g=e==null;++n<c;)l[n]=g?r:Go(e,i[n]);return l}function Di(e,i,n){return e===e&&(n!==r&&(e=e<=n?e:n),i!==r&&(e=e>=i?e:i)),e}function br(e,i,n,c,l,g){var w,b=i&S,P=i&R,q=i&N;if(n&&(w=l?n(e,c,l,g):n(e)),w!==r)return w;if(!tt(e))return e;var L=le(e);if(L){if(w=jd(e),!b)return er(e,w)}else{var z=Ht(e),k=z==J||z==ae;if(yi(e))return Du(e,b);if(z==_e||z==we||k&&!l){if(w=P||k?{}:Xu(e),!b)return P?Sd(e,Jp(w,e)):Pd(e,hu(w,e))}else{if(!De[z])return l?e:{};w=zd(e,z,b)}}g||(g=new Tr);var Z=g.get(e);if(Z)return Z;g.set(e,w),Rh(e)?e.forEach(function(se){w.add(br(se,i,n,se,e,g))}):Sh(e)&&e.forEach(function(se,me){w.set(me,br(se,i,n,me,e,g))});var ie=q?P?No:$o:P?rr:Dt,ye=L?r:ie(e);return mr(ye||e,function(se,me){ye&&(me=se,se=e[me]),Rs(w,me,br(se,i,n,me,e,g))}),w}function Qp(e){var i=Dt(e);return function(n){return lu(n,e,i)}}function lu(e,i,n){var c=n.length;if(e==null)return!c;for(e=Ue(e);c--;){var l=n[c],g=i[l],w=e[l];if(w===r&&!(l in e)||!g(w))return!1}return!0}function fu(e,i,n){if(typeof e!="function")throw new wr(f);return qs(function(){e.apply(r,n)},i)}function As(e,i,n,c){var l=-1,g=En,w=!0,b=e.length,P=[],q=i.length;if(!b)return P;n&&(i=Qe(i,lr(n))),c?(g=Za,w=!1):i.length>=a&&(g=Es,w=!1,i=new Ni(i));e:for(;++l<b;){var L=e[l],z=n==null?L:n(L);if(L=c||L!==0?L:0,w&&z===z){for(var k=q;k--;)if(i[k]===z)continue e;P.push(L)}else g(i,z,c)||P.push(L)}return P}var fi=Mu(Ur),pu=Mu(go,!0);function Yp(e,i){var n=!0;return fi(e,function(c,l,g){return n=!!i(c,l,g),n}),n}function Un(e,i,n){for(var c=-1,l=e.length;++c<l;){var g=e[c],w=i(g);if(w!=null&&(b===r?w===w&&!pr(w):n(w,b)))var b=w,P=g}return P}function Zp(e,i,n,c){var l=e.length;for(n=de(n),n<0&&(n=-n>l?0:l+n),c=c===r||c>l?l:de(c),c<0&&(c+=l),c=n>c?0:Ch(c);n<c;)e[n++]=i;return e}function du(e,i){var n=[];return fi(e,function(c,l,g){i(c,l,g)&&n.push(c)}),n}function zt(e,i,n,c,l){var g=-1,w=e.length;for(n||(n=Ud),l||(l=[]);++g<w;){var b=e[g];i>0&&n(b)?i>1?zt(b,i-1,n,c,l):ui(l,b):c||(l[l.length]=b)}return l}var po=Uu(),gu=Uu(!0);function Ur(e,i){return e&&po(e,i,Dt)}function go(e,i){return e&&gu(e,i,Dt)}function Hn(e,i){return ci(i,function(n){return ei(e[n])})}function qi(e,i){i=di(i,e);for(var n=0,c=i.length;e!=null&&n<c;)e=e[kr(i[n++])];return n&&n==c?e:r}function yu(e,i,n){var c=i(e);return le(e)?c:ui(c,n(e))}function Wt(e){return e==null?e===r?Xe:Oe:Ti&&Ti in Ue(e)?Dd(e):Gd(e)}function yo(e,i){return e>i}function Xp(e,i){return e!=null&&$e.call(e,i)}function ed(e,i){return e!=null&&i in Ue(e)}function td(e,i,n){return e>=Ut(i,n)&&e<Ct(i,n)}function vo(e,i,n){for(var c=n?Za:En,l=e[0].length,g=e.length,w=g,b=C(g),P=1/0,q=[];w--;){var L=e[w];w&&i&&(L=Qe(L,lr(i))),P=Ut(L.length,P),b[w]=!n&&(i||l>=120&&L.length>=120)?new Ni(w&&L):r}L=e[0];var z=-1,k=b[0];e:for(;++z<l&&q.length<P;){var Z=L[z],ie=i?i(Z):Z;if(Z=n||Z!==0?Z:0,!(k?Es(k,ie):c(q,ie,n))){for(w=g;--w;){var ye=b[w];if(!(ye?Es(ye,ie):c(e[w],ie,n)))continue e}k&&k.push(ie),q.push(Z)}}return q}function rd(e,i,n,c){return Ur(e,function(l,g,w){i(c,n(l),g,w)}),c}function Cs(e,i,n){i=di(i,e),e=ih(e,i);var c=e==null?e:e[kr(Ir(i))];return c==null?r:Nt(c,e,n)}function vu(e){return ht(e)&&Wt(e)==we}function id(e){return ht(e)&&Wt(e)==Se}function sd(e){return ht(e)&&Wt(e)==O}function Ts(e,i,n,c,l){return e===i?!0:e==null||i==null||!ht(e)&&!ht(i)?e!==e&&i!==i:nd(e,i,n,c,Ts,l)}function nd(e,i,n,c,l,g){var w=le(e),b=le(i),P=w?Or:Ht(e),q=b?Or:Ht(i);P=P==we?_e:P,q=q==we?_e:q;var L=P==_e,z=q==_e,k=P==q;if(k&&yi(e)){if(!yi(i))return!1;w=!0,L=!1}if(k&&!L)return g||(g=new Tr),w||cs(e)?Qu(e,i,n,c,l,g):$d(e,i,P,n,c,l,g);if(!(n&A)){var Z=L&&$e.call(e,"__wrapped__"),ie=z&&$e.call(i,"__wrapped__");if(Z||ie){var ye=Z?e.value():e,se=ie?i.value():i;return g||(g=new Tr),l(ye,se,n,c,g)}}return k?(g||(g=new Tr),Nd(e,i,n,c,l,g)):!1}function ad(e){return ht(e)&&Ht(e)==ge}function mo(e,i,n,c){var l=n.length,g=l,w=!c;if(e==null)return!g;for(e=Ue(e);l--;){var b=n[l];if(w&&b[2]?b[1]!==e[b[0]]:!(b[0]in e))return!1}for(;++l<g;){b=n[l];var P=b[0],q=e[P],L=b[1];if(w&&b[2]){if(q===r&&!(P in e))return!1}else{var z=new Tr;if(c)var k=c(q,L,P,e,i,z);if(!(k===r?Ts(L,q,A|Q,c,z):k))return!1}}return!0}function mu(e){if(!tt(e)||kd(e))return!1;var i=ei(e)?ap:La;return i.test(ji(e))}function od(e){return ht(e)&&Wt(e)==Ze}function cd(e){return ht(e)&&Ht(e)==Ae}function ud(e){return ht(e)&&sa(e.length)&&!!je[Wt(e)]}function wu(e){return typeof e=="function"?e:e==null?ir:typeof e=="object"?le(e)?Eu(e[0],e[1]):bu(e):Hh(e)}function wo(e){if(!Ds(e))return fp(e);var i=[];for(var n in Ue(e))$e.call(e,n)&&n!="constructor"&&i.push(n);return i}function hd(e){if(!tt(e))return Bd(e);var i=Ds(e),n=[];for(var c in e)c=="constructor"&&(i||!$e.call(e,c))||n.push(c);return n}function _o(e,i){return e<i}function _u(e,i){var n=-1,c=tr(e)?C(e.length):[];return fi(e,function(l,g,w){c[++n]=i(l,g,w)}),c}function bu(e){var i=qo(e);return i.length==1&&i[0][2]?th(i[0][0],i[0][1]):function(n){return n===e||mo(n,e,i)}}function Eu(e,i){return jo(e)&&eh(i)?th(kr(e),i):function(n){var c=Go(n,e);return c===r&&c===i?Wo(n,e):Ts(i,c,A|Q)}}function kn(e,i,n,c,l){e!==i&&po(i,function(g,w){if(l||(l=new Tr),tt(g))ld(e,i,w,n,kn,c,l);else{var b=c?c(Mo(e,w),g,w+"",e,i,l):r;b===r&&(b=g),lo(e,w,b)}},rr)}function ld(e,i,n,c,l,g,w){var b=Mo(e,n),P=Mo(i,n),q=w.get(P);if(q){lo(e,n,q);return}var L=g?g(b,P,n+"",e,i,w):r,z=L===r;if(z){var k=le(P),Z=!k&&yi(P),ie=!k&&!Z&&cs(P);L=P,k||Z||ie?le(b)?L=b:dt(b)?L=er(b):Z?(z=!1,L=Du(P,!0)):ie?(z=!1,L=qu(P,!0)):L=[]:Ls(P)||zi(P)?(L=b,zi(b)?L=Th(b):(!tt(b)||ei(b))&&(L=Xu(P))):z=!1}z&&(w.set(P,L),l(L,P,c,g,w),w.delete(P)),lo(e,n,L)}function Iu(e,i){var n=e.length;if(n)return i+=i<0?n:0,Xr(i,n)?e[i]:r}function xu(e,i,n){i.length?i=Qe(i,function(g){return le(g)?function(w){return qi(w,g.length===1?g[0]:g)}:g}):i=[ir];var c=-1;i=Qe(i,lr(ee()));var l=_u(e,function(g,w,b){var P=Qe(i,function(q){return q(g)});return{criteria:P,index:++c,value:g}});return zf(l,function(g,w){return xd(g,w,n)})}function fd(e,i){return Pu(e,i,function(n,c){return Wo(e,c)})}function Pu(e,i,n){for(var c=-1,l=i.length,g={};++c<l;){var w=i[c],b=qi(e,w);n(b,w)&&$s(g,di(w,e),b)}return g}function pd(e){return function(i){return qi(i,e)}}function bo(e,i,n,c){var l=c?jf:Yi,g=-1,w=i.length,b=e;for(e===i&&(i=er(i)),n&&(b=Qe(e,lr(n)));++g<w;)for(var P=0,q=i[g],L=n?n(q):q;(P=l(b,L,P,c))>-1;)b!==e&&$n.call(b,P,1),$n.call(e,P,1);return e}function Su(e,i){for(var n=e?i.length:0,c=n-1;n--;){var l=i[n];if(n==c||l!==g){var g=l;Xr(l)?$n.call(e,l,1):Po(e,l)}}return e}function Eo(e,i){return e+qn(au()*(i-e+1))}function dd(e,i,n,c){for(var l=-1,g=Ct(Dn((i-e)/(n||1)),0),w=C(g);g--;)w[c?g:++l]=e,e+=n;return w}function Io(e,i){var n="";if(!e||i<1||i>G)return n;do i%2&&(n+=e),i=qn(i/2),i&&(e+=e);while(i);return n}function ve(e,i){return Uo(rh(e,i,ir),e+"")}function gd(e){return uu(us(e))}function yd(e,i){var n=us(e);return Zn(n,Di(i,0,n.length))}function $s(e,i,n,c){if(!tt(e))return e;i=di(i,e);for(var l=-1,g=i.length,w=g-1,b=e;b!=null&&++l<g;){var P=kr(i[l]),q=n;if(P==="__proto__"||P==="constructor"||P==="prototype")return e;if(l!=w){var L=b[P];q=c?c(L,P,b):r,q===r&&(q=tt(L)?L:Xr(i[l+1])?[]:{})}Rs(b,P,q),b=b[P]}return e}var Ou=Ln?function(e,i){return Ln.set(e,i),e}:ir,vd=Nn?function(e,i){return Nn(e,"toString",{configurable:!0,enumerable:!1,value:Qo(i),writable:!0})}:ir;function md(e){return Zn(us(e))}function Er(e,i,n){var c=-1,l=e.length;i<0&&(i=-i>l?0:l+i),n=n>l?l:n,n<0&&(n+=l),l=i>n?0:n-i>>>0,i>>>=0;for(var g=C(l);++c<l;)g[c]=e[c+i];return g}function wd(e,i){var n;return fi(e,function(c,l,g){return n=i(c,l,g),!n}),!!n}function Kn(e,i,n){var c=0,l=e==null?c:e.length;if(typeof i=="number"&&i===i&&l<=rt){for(;c<l;){var g=c+l>>>1,w=e[g];w!==null&&!pr(w)&&(n?w<=i:w<i)?c=g+1:l=g}return l}return xo(e,i,ir,n)}function xo(e,i,n,c){var l=0,g=e==null?0:e.length;if(g===0)return 0;i=n(i);for(var w=i!==i,b=i===null,P=pr(i),q=i===r;l<g;){var L=qn((l+g)/2),z=n(e[L]),k=z!==r,Z=z===null,ie=z===z,ye=pr(z);if(w)var se=c||ie;else q?se=ie&&(c||k):b?se=ie&&k&&(c||!Z):P?se=ie&&k&&!Z&&(c||!ye):Z||ye?se=!1:se=c?z<=i:z<i;se?l=L+1:g=L}return Ut(g,Ot)}function Ru(e,i){for(var n=-1,c=e.length,l=0,g=[];++n<c;){var w=e[n],b=i?i(w):w;if(!n||!$r(b,P)){var P=b;g[l++]=w===0?0:w}}return g}function Au(e){return typeof e=="number"?e:pr(e)?H:+e}function fr(e){if(typeof e=="string")return e;if(le(e))return Qe(e,fr)+"";if(pr(e))return ou?ou.call(e):"";var i=e+"";return i=="0"&&1/e==-qe?"-0":i}function pi(e,i,n){var c=-1,l=En,g=e.length,w=!0,b=[],P=b;if(n)w=!1,l=Za;else if(g>=a){var q=i?null:Cd(e);if(q)return xn(q);w=!1,l=Es,P=new Ni}else P=i?[]:b;e:for(;++c<g;){var L=e[c],z=i?i(L):L;if(L=n||L!==0?L:0,w&&z===z){for(var k=P.length;k--;)if(P[k]===z)continue e;i&&P.push(z),b.push(L)}else l(P,z,n)||(P!==b&&P.push(z),b.push(L))}return b}function Po(e,i){return i=di(i,e),e=ih(e,i),e==null||delete e[kr(Ir(i))]}function Cu(e,i,n,c){return $s(e,i,n(qi(e,i)),c)}function Vn(e,i,n,c){for(var l=e.length,g=c?l:-1;(c?g--:++g<l)&&i(e[g],g,e););return n?Er(e,c?0:g,c?g+1:l):Er(e,c?g+1:0,c?l:g)}function Tu(e,i){var n=e;return n instanceof be&&(n=n.value()),Xa(i,function(c,l){return l.func.apply(l.thisArg,ui([c],l.args))},n)}function So(e,i,n){var c=e.length;if(c<2)return c?pi(e[0]):[];for(var l=-1,g=C(c);++l<c;)for(var w=e[l],b=-1;++b<c;)b!=l&&(g[l]=As(g[l]||w,e[b],i,n));return pi(zt(g,1),i,n)}function $u(e,i,n){for(var c=-1,l=e.length,g=i.length,w={};++c<l;){var b=c<g?i[c]:r;n(w,e[c],b)}return w}function Oo(e){return dt(e)?e:[]}function Ro(e){return typeof e=="function"?e:ir}function di(e,i){return le(e)?e:jo(e,i)?[e]:oh(Ce(e))}var _d=ve;function gi(e,i,n){var c=e.length;return n=n===r?c:n,!i&&n>=c?e:Er(e,i,n)}var Nu=op||function(e){return Ee.clearTimeout(e)};function Du(e,i){if(i)return e.slice();var n=e.length,c=tu?tu(n):new e.constructor(n);return e.copy(c),c}function Ao(e){var i=new e.constructor(e.byteLength);return new Cn(i).set(new Cn(e)),i}function bd(e,i){var n=i?Ao(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function Ed(e){var i=new e.constructor(e.source,yr.exec(e));return i.lastIndex=e.lastIndex,i}function Id(e){return Os?Ue(Os.call(e)):{}}function qu(e,i){var n=i?Ao(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Lu(e,i){if(e!==i){var n=e!==r,c=e===null,l=e===e,g=pr(e),w=i!==r,b=i===null,P=i===i,q=pr(i);if(!b&&!q&&!g&&e>i||g&&w&&P&&!b&&!q||c&&w&&P||!n&&P||!l)return 1;if(!c&&!g&&!q&&e<i||q&&n&&l&&!c&&!g||b&&n&&l||!w&&l||!P)return-1}return 0}function xd(e,i,n){for(var c=-1,l=e.criteria,g=i.criteria,w=l.length,b=n.length;++c<w;){var P=Lu(l[c],g[c]);if(P){if(c>=b)return P;var q=n[c];return P*(q=="desc"?-1:1)}}return e.index-i.index}function ju(e,i,n,c){for(var l=-1,g=e.length,w=n.length,b=-1,P=i.length,q=Ct(g-w,0),L=C(P+q),z=!c;++b<P;)L[b]=i[b];for(;++l<w;)(z||l<g)&&(L[n[l]]=e[l]);for(;q--;)L[b++]=e[l++];return L}function zu(e,i,n,c){for(var l=-1,g=e.length,w=-1,b=n.length,P=-1,q=i.length,L=Ct(g-b,0),z=C(L+q),k=!c;++l<L;)z[l]=e[l];for(var Z=l;++P<q;)z[Z+P]=i[P];for(;++w<b;)(k||l<g)&&(z[Z+n[w]]=e[l++]);return z}function er(e,i){var n=-1,c=e.length;for(i||(i=C(c));++n<c;)i[n]=e[n];return i}function Hr(e,i,n,c){var l=!n;n||(n={});for(var g=-1,w=i.length;++g<w;){var b=i[g],P=c?c(n[b],e[b],b,n,e):r;P===r&&(P=e[b]),l?Qr(n,b,P):Rs(n,b,P)}return n}function Pd(e,i){return Hr(e,Lo(e),i)}function Sd(e,i){return Hr(e,Yu(e),i)}function Fn(e,i){return function(n,c){var l=le(n)?Tf:Wp,g=i?i():{};return l(n,e,ee(c,2),g)}}function ns(e){return ve(function(i,n){var c=-1,l=n.length,g=l>1?n[l-1]:r,w=l>2?n[2]:r;for(g=e.length>3&&typeof g=="function"?(l--,g):r,w&&Jt(n[0],n[1],w)&&(g=l<3?r:g,l=1),i=Ue(i);++c<l;){var b=n[c];b&&e(i,b,c,g)}return i})}function Mu(e,i){return function(n,c){if(n==null)return n;if(!tr(n))return e(n,c);for(var l=n.length,g=i?l:-1,w=Ue(n);(i?g--:++g<l)&&c(w[g],g,w)!==!1;);return n}}function Uu(e){return function(i,n,c){for(var l=-1,g=Ue(i),w=c(i),b=w.length;b--;){var P=w[e?b:++l];if(n(g[P],P,g)===!1)break}return i}}function Od(e,i,n){var c=i&te,l=Ns(e);function g(){var w=this&&this!==Ee&&this instanceof g?l:e;return w.apply(c?n:this,arguments)}return g}function Hu(e){return function(i){i=Ce(i);var n=Zi(i)?Cr(i):r,c=n?n[0]:i.charAt(0),l=n?gi(n,1).join(""):i.slice(1);return c[e]()+l}}function as(e){return function(i){return Xa(Mh(zh(i).replace(_s,"")),e,"")}}function Ns(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var n=ss(e.prototype),c=e.apply(n,i);return tt(c)?c:n}}function Rd(e,i,n){var c=Ns(e);function l(){for(var g=arguments.length,w=C(g),b=g,P=os(l);b--;)w[b]=arguments[b];var q=g<3&&w[0]!==P&&w[g-1]!==P?[]:hi(w,P);if(g-=q.length,g<n)return Bu(e,i,Bn,l.placeholder,r,w,q,r,r,n-g);var L=this&&this!==Ee&&this instanceof l?c:e;return Nt(L,this,w)}return l}function ku(e){return function(i,n,c){var l=Ue(i);if(!tr(i)){var g=ee(n,3);i=Dt(i),n=function(b){return g(l[b],b,l)}}var w=e(i,n,c);return w>-1?l[g?i[w]:w]:r}}function Ku(e){return Zr(function(i){var n=i.length,c=n,l=_r.prototype.thru;for(e&&i.reverse();c--;){var g=i[c];if(typeof g!="function")throw new wr(f);if(l&&!w&&Qn(g)=="wrapper")var w=new _r([],!0)}for(c=w?c:n;++c<n;){g=i[c];var b=Qn(g),P=b=="wrapper"?Do(g):r;P&&zo(P[0])&&P[1]==(Y|ne|fe|xe)&&!P[4].length&&P[9]==1?w=w[Qn(P[0])].apply(w,P[3]):w=g.length==1&&zo(g)?w[b]():w.thru(g)}return function(){var q=arguments,L=q[0];if(w&&q.length==1&&le(L))return w.plant(L).value();for(var z=0,k=n?i[z].apply(this,q):L;++z<n;)k=i[z].call(this,k);return k}})}function Bn(e,i,n,c,l,g,w,b,P,q){var L=i&Y,z=i&te,k=i&ce,Z=i&(ne|re),ie=i&Tt,ye=k?r:Ns(e);function se(){for(var me=arguments.length,Ie=C(me),dr=me;dr--;)Ie[dr]=arguments[dr];if(Z)var Qt=os(se),gr=Uf(Ie,Qt);if(c&&(Ie=ju(Ie,c,l,Z)),g&&(Ie=zu(Ie,g,w,Z)),me-=gr,Z&&me<q){var gt=hi(Ie,Qt);return Bu(e,i,Bn,se.placeholder,n,Ie,gt,b,P,q-me)}var Nr=z?n:this,ri=k?Nr[e]:e;return me=Ie.length,b?Ie=Wd(Ie,b):ie&&me>1&&Ie.reverse(),L&&P<me&&(Ie.length=P),this&&this!==Ee&&this instanceof se&&(ri=ye||Ns(ri)),ri.apply(Nr,Ie)}return se}function Vu(e,i){return function(n,c){return rd(n,e,i(c),{})}}function Gn(e,i){return function(n,c){var l;if(n===r&&c===r)return i;if(n!==r&&(l=n),c!==r){if(l===r)return c;typeof n=="string"||typeof c=="string"?(n=fr(n),c=fr(c)):(n=Au(n),c=Au(c)),l=e(n,c)}return l}}function Co(e){return Zr(function(i){return i=Qe(i,lr(ee())),ve(function(n){var c=this;return e(i,function(l){return Nt(l,c,n)})})})}function Wn(e,i){i=i===r?" ":fr(i);var n=i.length;if(n<2)return n?Io(i,e):i;var c=Io(i,Dn(e/Xi(i)));return Zi(i)?gi(Cr(c),0,e).join(""):c.slice(0,e)}function Ad(e,i,n,c){var l=i&te,g=Ns(e);function w(){for(var b=-1,P=arguments.length,q=-1,L=c.length,z=C(L+P),k=this&&this!==Ee&&this instanceof w?g:e;++q<L;)z[q]=c[q];for(;P--;)z[q++]=arguments[++b];return Nt(k,l?n:this,z)}return w}function Fu(e){return function(i,n,c){return c&&typeof c!="number"&&Jt(i,n,c)&&(n=c=r),i=ti(i),n===r?(n=i,i=0):n=ti(n),c=c===r?i<n?1:-1:ti(c),dd(i,n,c,e)}}function Jn(e){return function(i,n){return typeof i=="string"&&typeof n=="string"||(i=xr(i),n=xr(n)),e(i,n)}}function Bu(e,i,n,c,l,g,w,b,P,q){var L=i&ne,z=L?w:r,k=L?r:w,Z=L?g:r,ie=L?r:g;i|=L?fe:pe,i&=~(L?pe:fe),i&oe||(i&=~(te|ce));var ye=[e,i,l,Z,z,ie,k,b,P,q],se=n.apply(r,ye);return zo(e)&&sh(se,ye),se.placeholder=c,nh(se,e,i)}function To(e){var i=At[e];return function(n,c){if(n=xr(n),c=c==null?0:Ut(de(c),292),c&&nu(n)){var l=(Ce(n)+"e").split("e"),g=i(l[0]+"e"+(+l[1]+c));return l=(Ce(g)+"e").split("e"),+(l[0]+"e"+(+l[1]-c))}return i(n)}}var Cd=rs&&1/xn(new rs([,-0]))[1]==qe?function(e){return new rs(e)}:Xo;function Gu(e){return function(i){var n=Ht(i);return n==ge?ao(i):n==Ae?Gf(i):Mf(i,e(i))}}function Yr(e,i,n,c,l,g,w,b){var P=i&ce;if(!P&&typeof e!="function")throw new wr(f);var q=c?c.length:0;if(q||(i&=~(fe|pe),c=l=r),w=w===r?w:Ct(de(w),0),b=b===r?b:de(b),q-=l?l.length:0,i&pe){var L=c,z=l;c=l=r}var k=P?r:Do(e),Z=[e,i,n,c,l,L,z,g,w,b];if(k&&Fd(Z,k),e=Z[0],i=Z[1],n=Z[2],c=Z[3],l=Z[4],b=Z[9]=Z[9]===r?P?0:e.length:Ct(Z[9]-q,0),!b&&i&(ne|re)&&(i&=~(ne|re)),!i||i==te)var ie=Od(e,i,n);else i==ne||i==re?ie=Rd(e,i,b):(i==fe||i==(te|fe))&&!l.length?ie=Ad(e,i,n,c):ie=Bn.apply(r,Z);var ye=k?Ou:sh;return nh(ye(ie,Z),e,i)}function Wu(e,i,n,c){return e===r||$r(e,ts[n])&&!$e.call(c,n)?i:e}function Ju(e,i,n,c,l,g){return tt(e)&&tt(i)&&(g.set(i,e),kn(e,i,r,Ju,g),g.delete(i)),e}function Td(e){return Ls(e)?r:e}function Qu(e,i,n,c,l,g){var w=n&A,b=e.length,P=i.length;if(b!=P&&!(w&&P>b))return!1;var q=g.get(e),L=g.get(i);if(q&&L)return q==i&&L==e;var z=-1,k=!0,Z=n&Q?new Ni:r;for(g.set(e,i),g.set(i,e);++z<b;){var ie=e[z],ye=i[z];if(c)var se=w?c(ye,ie,z,i,e,g):c(ie,ye,z,e,i,g);if(se!==r){if(se)continue;k=!1;break}if(Z){if(!eo(i,function(me,Ie){if(!Es(Z,Ie)&&(ie===me||l(ie,me,n,c,g)))return Z.push(Ie)})){k=!1;break}}else if(!(ie===ye||l(ie,ye,n,c,g))){k=!1;break}}return g.delete(e),g.delete(i),k}function $d(e,i,n,c,l,g,w){switch(n){case Le:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case Se:return!(e.byteLength!=i.byteLength||!g(new Cn(e),new Cn(i)));case T:case O:case Pe:return $r(+e,+i);case E:return e.name==i.name&&e.message==i.message;case Ze:case ke:return e==i+"";case ge:var b=ao;case Ae:var P=c&A;if(b||(b=xn),e.size!=i.size&&!P)return!1;var q=w.get(e);if(q)return q==i;c|=Q,w.set(e,i);var L=Qu(b(e),b(i),c,l,g,w);return w.delete(e),L;case Ke:if(Os)return Os.call(e)==Os.call(i)}return!1}function Nd(e,i,n,c,l,g){var w=n&A,b=$o(e),P=b.length,q=$o(i),L=q.length;if(P!=L&&!w)return!1;for(var z=P;z--;){var k=b[z];if(!(w?k in i:$e.call(i,k)))return!1}var Z=g.get(e),ie=g.get(i);if(Z&&ie)return Z==i&&ie==e;var ye=!0;g.set(e,i),g.set(i,e);for(var se=w;++z<P;){k=b[z];var me=e[k],Ie=i[k];if(c)var dr=w?c(Ie,me,k,i,e,g):c(me,Ie,k,e,i,g);if(!(dr===r?me===Ie||l(me,Ie,n,c,g):dr)){ye=!1;break}se||(se=k=="constructor")}if(ye&&!se){var Qt=e.constructor,gr=i.constructor;Qt!=gr&&"constructor"in e&&"constructor"in i&&!(typeof Qt=="function"&&Qt instanceof Qt&&typeof gr=="function"&&gr instanceof gr)&&(ye=!1)}return g.delete(e),g.delete(i),ye}function Zr(e){return Uo(rh(e,r,lh),e+"")}function $o(e){return yu(e,Dt,Lo)}function No(e){return yu(e,rr,Yu)}var Do=Ln?function(e){return Ln.get(e)}:Xo;function Qn(e){for(var i=e.name+"",n=is[i],c=$e.call(is,i)?n.length:0;c--;){var l=n[c],g=l.func;if(g==null||g==e)return l.name}return i}function os(e){var i=$e.call(p,"placeholder")?p:e;return i.placeholder}function ee(){var e=p.iteratee||Yo;return e=e===Yo?wu:e,arguments.length?e(arguments[0],arguments[1]):e}function Yn(e,i){var n=e.__data__;return Hd(i)?n[typeof i=="string"?"string":"hash"]:n.map}function qo(e){for(var i=Dt(e),n=i.length;n--;){var c=i[n],l=e[c];i[n]=[c,l,eh(l)]}return i}function Li(e,i){var n=Vf(e,i);return mu(n)?n:r}function Dd(e){var i=$e.call(e,Ti),n=e[Ti];try{e[Ti]=r;var c=!0}catch{}var l=Rn.call(e);return c&&(i?e[Ti]=n:delete e[Ti]),l}var Lo=co?function(e){return e==null?[]:(e=Ue(e),ci(co(e),function(i){return iu.call(e,i)}))}:ec,Yu=co?function(e){for(var i=[];e;)ui(i,Lo(e)),e=Tn(e);return i}:ec,Ht=Wt;(uo&&Ht(new uo(new ArrayBuffer(1)))!=Le||xs&&Ht(new xs)!=ge||ho&&Ht(ho.resolve())!=vt||rs&&Ht(new rs)!=Ae||Ps&&Ht(new Ps)!=Ne)&&(Ht=function(e){var i=Wt(e),n=i==_e?e.constructor:r,c=n?ji(n):"";if(c)switch(c){case yp:return Le;case vp:return ge;case mp:return vt;case wp:return Ae;case _p:return Ne}return i});function qd(e,i,n){for(var c=-1,l=n.length;++c<l;){var g=n[c],w=g.size;switch(g.type){case"drop":e+=w;break;case"dropRight":i-=w;break;case"take":i=Ut(i,e+w);break;case"takeRight":e=Ct(e,i-w);break}}return{start:e,end:i}}function Ld(e){var i=e.match(He);return i?i[1].split(Et):[]}function Zu(e,i,n){i=di(i,e);for(var c=-1,l=i.length,g=!1;++c<l;){var w=kr(i[c]);if(!(g=e!=null&&n(e,w)))break;e=e[w]}return g||++c!=l?g:(l=e==null?0:e.length,!!l&&sa(l)&&Xr(w,l)&&(le(e)||zi(e)))}function jd(e){var i=e.length,n=new e.constructor(i);return i&&typeof e[0]=="string"&&$e.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Xu(e){return typeof e.constructor=="function"&&!Ds(e)?ss(Tn(e)):{}}function zd(e,i,n){var c=e.constructor;switch(i){case Se:return Ao(e);case T:case O:return new c(+e);case Le:return bd(e,n);case it:case Te:case mt:case Rt:case Lt:case jt:case $t:case Ft:case Zt:return qu(e,n);case ge:return new c;case Pe:case ke:return new c(e);case Ze:return Ed(e);case Ae:return new c;case Ke:return Id(e)}}function Md(e,i){var n=i.length;if(!n)return e;var c=n-1;return i[c]=(n>1?"& ":"")+i[c],i=i.join(n>2?", ":" "),e.replace(ut,`{
/* [wrapped with `+i+`] */
`)}function Ud(e){return le(e)||zi(e)||!!(su&&e&&e[su])}function Xr(e,i){var n=typeof e;return i=i??G,!!i&&(n=="number"||n!="symbol"&&za.test(e))&&e>-1&&e%1==0&&e<i}function Jt(e,i,n){if(!tt(n))return!1;var c=typeof i;return(c=="number"?tr(n)&&Xr(i,n.length):c=="string"&&i in n)?$r(n[i],e):!1}function jo(e,i){if(le(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||pr(e)?!0:wt.test(e)||!Je.test(e)||i!=null&&e in Ue(i)}function Hd(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function zo(e){var i=Qn(e),n=p[i];if(typeof n!="function"||!(i in be.prototype))return!1;if(e===n)return!0;var c=Do(n);return!!c&&e===c[0]}function kd(e){return!!eu&&eu in e}var Kd=Sn?ei:tc;function Ds(e){var i=e&&e.constructor,n=typeof i=="function"&&i.prototype||ts;return e===n}function eh(e){return e===e&&!tt(e)}function th(e,i){return function(n){return n==null?!1:n[e]===i&&(i!==r||e in Ue(n))}}function Vd(e){var i=ra(e,function(c){return n.size===d&&n.clear(),c}),n=i.cache;return i}function Fd(e,i){var n=e[1],c=i[1],l=n|c,g=l<(te|ce|Y),w=c==Y&&n==ne||c==Y&&n==xe&&e[7].length<=i[8]||c==(Y|xe)&&i[7].length<=i[8]&&n==ne;if(!(g||w))return e;c&te&&(e[2]=i[2],l|=n&te?0:oe);var b=i[3];if(b){var P=e[3];e[3]=P?ju(P,b,i[4]):b,e[4]=P?hi(e[3],_):i[4]}return b=i[5],b&&(P=e[5],e[5]=P?zu(P,b,i[6]):b,e[6]=P?hi(e[5],_):i[6]),b=i[7],b&&(e[7]=b),c&Y&&(e[8]=e[8]==null?i[8]:Ut(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=l,e}function Bd(e){var i=[];if(e!=null)for(var n in Ue(e))i.push(n);return i}function Gd(e){return Rn.call(e)}function rh(e,i,n){return i=Ct(i===r?e.length-1:i,0),function(){for(var c=arguments,l=-1,g=Ct(c.length-i,0),w=C(g);++l<g;)w[l]=c[i+l];l=-1;for(var b=C(i+1);++l<i;)b[l]=c[l];return b[i]=n(w),Nt(e,this,b)}}function ih(e,i){return i.length<2?e:qi(e,Er(i,0,-1))}function Wd(e,i){for(var n=e.length,c=Ut(i.length,n),l=er(e);c--;){var g=i[c];e[c]=Xr(g,n)?l[g]:r}return e}function Mo(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var sh=ah(Ou),qs=up||function(e,i){return Ee.setTimeout(e,i)},Uo=ah(vd);function nh(e,i,n){var c=i+"";return Uo(e,Md(c,Jd(Ld(c),n)))}function ah(e){var i=0,n=0;return function(){var c=pp(),l=ur-(c-n);if(n=c,l>0){if(++i>=Vt)return arguments[0]}else i=0;return e.apply(r,arguments)}}function Zn(e,i){var n=-1,c=e.length,l=c-1;for(i=i===r?c:i;++n<i;){var g=Eo(n,l),w=e[g];e[g]=e[n],e[n]=w}return e.length=i,e}var oh=Vd(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(_t,function(n,c,l,g){i.push(l?g.replace($a,"$1"):c||n)}),i});function kr(e){if(typeof e=="string"||pr(e))return e;var i=e+"";return i=="0"&&1/e==-qe?"-0":i}function ji(e){if(e!=null){try{return On.call(e)}catch{}try{return e+""}catch{}}return""}function Jd(e,i){return mr(xi,function(n){var c="_."+n[0];i&n[1]&&!En(e,c)&&e.push(c)}),e.sort()}function ch(e){if(e instanceof be)return e.clone();var i=new _r(e.__wrapped__,e.__chain__);return i.__actions__=er(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function Qd(e,i,n){(n?Jt(e,i,n):i===r)?i=1:i=Ct(de(i),0);var c=e==null?0:e.length;if(!c||i<1)return[];for(var l=0,g=0,w=C(Dn(c/i));l<c;)w[g++]=Er(e,l,l+=i);return w}function Yd(e){for(var i=-1,n=e==null?0:e.length,c=0,l=[];++i<n;){var g=e[i];g&&(l[c++]=g)}return l}function Zd(){var e=arguments.length;if(!e)return[];for(var i=C(e-1),n=arguments[0],c=e;c--;)i[c-1]=arguments[c];return ui(le(n)?er(n):[n],zt(i,1))}var Xd=ve(function(e,i){return dt(e)?As(e,zt(i,1,dt,!0)):[]}),eg=ve(function(e,i){var n=Ir(i);return dt(n)&&(n=r),dt(e)?As(e,zt(i,1,dt,!0),ee(n,2)):[]}),tg=ve(function(e,i){var n=Ir(i);return dt(n)&&(n=r),dt(e)?As(e,zt(i,1,dt,!0),r,n):[]});function rg(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:de(i),Er(e,i<0?0:i,c)):[]}function ig(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:de(i),i=c-i,Er(e,0,i<0?0:i)):[]}function sg(e,i){return e&&e.length?Vn(e,ee(i,3),!0,!0):[]}function ng(e,i){return e&&e.length?Vn(e,ee(i,3),!0):[]}function ag(e,i,n,c){var l=e==null?0:e.length;return l?(n&&typeof n!="number"&&Jt(e,i,n)&&(n=0,c=l),Zp(e,i,n,c)):[]}function uh(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=n==null?0:de(n);return l<0&&(l=Ct(c+l,0)),In(e,ee(i,3),l)}function hh(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=c-1;return n!==r&&(l=de(n),l=n<0?Ct(c+l,0):Ut(l,c-1)),In(e,ee(i,3),l,!0)}function lh(e){var i=e==null?0:e.length;return i?zt(e,1):[]}function og(e){var i=e==null?0:e.length;return i?zt(e,qe):[]}function cg(e,i){var n=e==null?0:e.length;return n?(i=i===r?1:de(i),zt(e,i)):[]}function ug(e){for(var i=-1,n=e==null?0:e.length,c={};++i<n;){var l=e[i];c[l[0]]=l[1]}return c}function fh(e){return e&&e.length?e[0]:r}function hg(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=n==null?0:de(n);return l<0&&(l=Ct(c+l,0)),Yi(e,i,l)}function lg(e){var i=e==null?0:e.length;return i?Er(e,0,-1):[]}var fg=ve(function(e){var i=Qe(e,Oo);return i.length&&i[0]===e[0]?vo(i):[]}),pg=ve(function(e){var i=Ir(e),n=Qe(e,Oo);return i===Ir(n)?i=r:n.pop(),n.length&&n[0]===e[0]?vo(n,ee(i,2)):[]}),dg=ve(function(e){var i=Ir(e),n=Qe(e,Oo);return i=typeof i=="function"?i:r,i&&n.pop(),n.length&&n[0]===e[0]?vo(n,r,i):[]});function gg(e,i){return e==null?"":lp.call(e,i)}function Ir(e){var i=e==null?0:e.length;return i?e[i-1]:r}function yg(e,i,n){var c=e==null?0:e.length;if(!c)return-1;var l=c;return n!==r&&(l=de(n),l=l<0?Ct(c+l,0):Ut(l,c-1)),i===i?Jf(e,i,l):In(e,Bc,l,!0)}function vg(e,i){return e&&e.length?Iu(e,de(i)):r}var mg=ve(ph);function ph(e,i){return e&&e.length&&i&&i.length?bo(e,i):e}function wg(e,i,n){return e&&e.length&&i&&i.length?bo(e,i,ee(n,2)):e}function _g(e,i,n){return e&&e.length&&i&&i.length?bo(e,i,r,n):e}var bg=Zr(function(e,i){var n=e==null?0:e.length,c=fo(e,i);return Su(e,Qe(i,function(l){return Xr(l,n)?+l:l}).sort(Lu)),c});function Eg(e,i){var n=[];if(!(e&&e.length))return n;var c=-1,l=[],g=e.length;for(i=ee(i,3);++c<g;){var w=e[c];i(w,c,e)&&(n.push(w),l.push(c))}return Su(e,l),n}function Ho(e){return e==null?e:gp.call(e)}function Ig(e,i,n){var c=e==null?0:e.length;return c?(n&&typeof n!="number"&&Jt(e,i,n)?(i=0,n=c):(i=i==null?0:de(i),n=n===r?c:de(n)),Er(e,i,n)):[]}function xg(e,i){return Kn(e,i)}function Pg(e,i,n){return xo(e,i,ee(n,2))}function Sg(e,i){var n=e==null?0:e.length;if(n){var c=Kn(e,i);if(c<n&&$r(e[c],i))return c}return-1}function Og(e,i){return Kn(e,i,!0)}function Rg(e,i,n){return xo(e,i,ee(n,2),!0)}function Ag(e,i){var n=e==null?0:e.length;if(n){var c=Kn(e,i,!0)-1;if($r(e[c],i))return c}return-1}function Cg(e){return e&&e.length?Ru(e):[]}function Tg(e,i){return e&&e.length?Ru(e,ee(i,2)):[]}function $g(e){var i=e==null?0:e.length;return i?Er(e,1,i):[]}function Ng(e,i,n){return e&&e.length?(i=n||i===r?1:de(i),Er(e,0,i<0?0:i)):[]}function Dg(e,i,n){var c=e==null?0:e.length;return c?(i=n||i===r?1:de(i),i=c-i,Er(e,i<0?0:i,c)):[]}function qg(e,i){return e&&e.length?Vn(e,ee(i,3),!1,!0):[]}function Lg(e,i){return e&&e.length?Vn(e,ee(i,3)):[]}var jg=ve(function(e){return pi(zt(e,1,dt,!0))}),zg=ve(function(e){var i=Ir(e);return dt(i)&&(i=r),pi(zt(e,1,dt,!0),ee(i,2))}),Mg=ve(function(e){var i=Ir(e);return i=typeof i=="function"?i:r,pi(zt(e,1,dt,!0),r,i)});function Ug(e){return e&&e.length?pi(e):[]}function Hg(e,i){return e&&e.length?pi(e,ee(i,2)):[]}function kg(e,i){return i=typeof i=="function"?i:r,e&&e.length?pi(e,r,i):[]}function ko(e){if(!(e&&e.length))return[];var i=0;return e=ci(e,function(n){if(dt(n))return i=Ct(n.length,i),!0}),so(i,function(n){return Qe(e,to(n))})}function dh(e,i){if(!(e&&e.length))return[];var n=ko(e);return i==null?n:Qe(n,function(c){return Nt(i,r,c)})}var Kg=ve(function(e,i){return dt(e)?As(e,i):[]}),Vg=ve(function(e){return So(ci(e,dt))}),Fg=ve(function(e){var i=Ir(e);return dt(i)&&(i=r),So(ci(e,dt),ee(i,2))}),Bg=ve(function(e){var i=Ir(e);return i=typeof i=="function"?i:r,So(ci(e,dt),r,i)}),Gg=ve(ko);function Wg(e,i){return $u(e||[],i||[],Rs)}function Jg(e,i){return $u(e||[],i||[],$s)}var Qg=ve(function(e){var i=e.length,n=i>1?e[i-1]:r;return n=typeof n=="function"?(e.pop(),n):r,dh(e,n)});function gh(e){var i=p(e);return i.__chain__=!0,i}function Yg(e,i){return i(e),e}function Xn(e,i){return i(e)}var Zg=Zr(function(e){var i=e.length,n=i?e[0]:0,c=this.__wrapped__,l=function(g){return fo(g,e)};return i>1||this.__actions__.length||!(c instanceof be)||!Xr(n)?this.thru(l):(c=c.slice(n,+n+(i?1:0)),c.__actions__.push({func:Xn,args:[l],thisArg:r}),new _r(c,this.__chain__).thru(function(g){return i&&!g.length&&g.push(r),g}))});function Xg(){return gh(this)}function ey(){return new _r(this.value(),this.__chain__)}function ty(){this.__values__===r&&(this.__values__=Ah(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function ry(){return this}function iy(e){for(var i,n=this;n instanceof zn;){var c=ch(n);c.__index__=0,c.__values__=r,i?l.__wrapped__=c:i=c;var l=c;n=n.__wrapped__}return l.__wrapped__=e,i}function sy(){var e=this.__wrapped__;if(e instanceof be){var i=e;return this.__actions__.length&&(i=new be(this)),i=i.reverse(),i.__actions__.push({func:Xn,args:[Ho],thisArg:r}),new _r(i,this.__chain__)}return this.thru(Ho)}function ny(){return Tu(this.__wrapped__,this.__actions__)}var ay=Fn(function(e,i,n){$e.call(e,n)?++e[n]:Qr(e,n,1)});function oy(e,i,n){var c=le(e)?Vc:Yp;return n&&Jt(e,i,n)&&(i=r),c(e,ee(i,3))}function cy(e,i){var n=le(e)?ci:du;return n(e,ee(i,3))}var uy=ku(uh),hy=ku(hh);function ly(e,i){return zt(ea(e,i),1)}function fy(e,i){return zt(ea(e,i),qe)}function py(e,i,n){return n=n===r?1:de(n),zt(ea(e,i),n)}function yh(e,i){var n=le(e)?mr:fi;return n(e,ee(i,3))}function vh(e,i){var n=le(e)?$f:pu;return n(e,ee(i,3))}var dy=Fn(function(e,i,n){$e.call(e,n)?e[n].push(i):Qr(e,n,[i])});function gy(e,i,n,c){e=tr(e)?e:us(e),n=n&&!c?de(n):0;var l=e.length;return n<0&&(n=Ct(l+n,0)),na(e)?n<=l&&e.indexOf(i,n)>-1:!!l&&Yi(e,i,n)>-1}var yy=ve(function(e,i,n){var c=-1,l=typeof i=="function",g=tr(e)?C(e.length):[];return fi(e,function(w){g[++c]=l?Nt(i,w,n):Cs(w,i,n)}),g}),vy=Fn(function(e,i,n){Qr(e,n,i)});function ea(e,i){var n=le(e)?Qe:_u;return n(e,ee(i,3))}function my(e,i,n,c){return e==null?[]:(le(i)||(i=i==null?[]:[i]),n=c?r:n,le(n)||(n=n==null?[]:[n]),xu(e,i,n))}var wy=Fn(function(e,i,n){e[n?0:1].push(i)},function(){return[[],[]]});function _y(e,i,n){var c=le(e)?Xa:Wc,l=arguments.length<3;return c(e,ee(i,4),n,l,fi)}function by(e,i,n){var c=le(e)?Nf:Wc,l=arguments.length<3;return c(e,ee(i,4),n,l,pu)}function Ey(e,i){var n=le(e)?ci:du;return n(e,ia(ee(i,3)))}function Iy(e){var i=le(e)?uu:gd;return i(e)}function xy(e,i,n){(n?Jt(e,i,n):i===r)?i=1:i=de(i);var c=le(e)?Bp:yd;return c(e,i)}function Py(e){var i=le(e)?Gp:md;return i(e)}function Sy(e){if(e==null)return 0;if(tr(e))return na(e)?Xi(e):e.length;var i=Ht(e);return i==ge||i==Ae?e.size:wo(e).length}function Oy(e,i,n){var c=le(e)?eo:wd;return n&&Jt(e,i,n)&&(i=r),c(e,ee(i,3))}var Ry=ve(function(e,i){if(e==null)return[];var n=i.length;return n>1&&Jt(e,i[0],i[1])?i=[]:n>2&&Jt(i[0],i[1],i[2])&&(i=[i[0]]),xu(e,zt(i,1),[])}),ta=cp||function(){return Ee.Date.now()};function Ay(e,i){if(typeof i!="function")throw new wr(f);return e=de(e),function(){if(--e<1)return i.apply(this,arguments)}}function mh(e,i,n){return i=n?r:i,i=e&&i==null?e.length:i,Yr(e,Y,r,r,r,r,i)}function wh(e,i){var n;if(typeof i!="function")throw new wr(f);return e=de(e),function(){return--e>0&&(n=i.apply(this,arguments)),e<=1&&(i=r),n}}var Ko=ve(function(e,i,n){var c=te;if(n.length){var l=hi(n,os(Ko));c|=fe}return Yr(e,c,i,n,l)}),_h=ve(function(e,i,n){var c=te|ce;if(n.length){var l=hi(n,os(_h));c|=fe}return Yr(i,c,e,n,l)});function bh(e,i,n){i=n?r:i;var c=Yr(e,ne,r,r,r,r,r,i);return c.placeholder=bh.placeholder,c}function Eh(e,i,n){i=n?r:i;var c=Yr(e,re,r,r,r,r,r,i);return c.placeholder=Eh.placeholder,c}function Ih(e,i,n){var c,l,g,w,b,P,q=0,L=!1,z=!1,k=!0;if(typeof e!="function")throw new wr(f);i=xr(i)||0,tt(n)&&(L=!!n.leading,z="maxWait"in n,g=z?Ct(xr(n.maxWait)||0,i):g,k="trailing"in n?!!n.trailing:k);function Z(gt){var Nr=c,ri=l;return c=l=r,q=gt,w=e.apply(ri,Nr),w}function ie(gt){return q=gt,b=qs(me,i),L?Z(gt):w}function ye(gt){var Nr=gt-P,ri=gt-q,kh=i-Nr;return z?Ut(kh,g-ri):kh}function se(gt){var Nr=gt-P,ri=gt-q;return P===r||Nr>=i||Nr<0||z&&ri>=g}function me(){var gt=ta();if(se(gt))return Ie(gt);b=qs(me,ye(gt))}function Ie(gt){return b=r,k&&c?Z(gt):(c=l=r,w)}function dr(){b!==r&&Nu(b),q=0,c=P=l=b=r}function Qt(){return b===r?w:Ie(ta())}function gr(){var gt=ta(),Nr=se(gt);if(c=arguments,l=this,P=gt,Nr){if(b===r)return ie(P);if(z)return Nu(b),b=qs(me,i),Z(P)}return b===r&&(b=qs(me,i)),w}return gr.cancel=dr,gr.flush=Qt,gr}var Cy=ve(function(e,i){return fu(e,1,i)}),Ty=ve(function(e,i,n){return fu(e,xr(i)||0,n)});function $y(e){return Yr(e,Tt)}function ra(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new wr(f);var n=function(){var c=arguments,l=i?i.apply(this,c):c[0],g=n.cache;if(g.has(l))return g.get(l);var w=e.apply(this,c);return n.cache=g.set(l,w)||g,w};return n.cache=new(ra.Cache||Jr),n}ra.Cache=Jr;function ia(e){if(typeof e!="function")throw new wr(f);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function Ny(e){return wh(2,e)}var Dy=_d(function(e,i){i=i.length==1&&le(i[0])?Qe(i[0],lr(ee())):Qe(zt(i,1),lr(ee()));var n=i.length;return ve(function(c){for(var l=-1,g=Ut(c.length,n);++l<g;)c[l]=i[l].call(this,c[l]);return Nt(e,this,c)})}),Vo=ve(function(e,i){var n=hi(i,os(Vo));return Yr(e,fe,r,i,n)}),xh=ve(function(e,i){var n=hi(i,os(xh));return Yr(e,pe,r,i,n)}),qy=Zr(function(e,i){return Yr(e,xe,r,r,r,i)});function Ly(e,i){if(typeof e!="function")throw new wr(f);return i=i===r?i:de(i),ve(e,i)}function jy(e,i){if(typeof e!="function")throw new wr(f);return i=i==null?0:Ct(de(i),0),ve(function(n){var c=n[i],l=gi(n,0,i);return c&&ui(l,c),Nt(e,this,l)})}function zy(e,i,n){var c=!0,l=!0;if(typeof e!="function")throw new wr(f);return tt(n)&&(c="leading"in n?!!n.leading:c,l="trailing"in n?!!n.trailing:l),Ih(e,i,{leading:c,maxWait:i,trailing:l})}function My(e){return mh(e,1)}function Uy(e,i){return Vo(Ro(i),e)}function Hy(){if(!arguments.length)return[];var e=arguments[0];return le(e)?e:[e]}function ky(e){return br(e,N)}function Ky(e,i){return i=typeof i=="function"?i:r,br(e,N,i)}function Vy(e){return br(e,S|N)}function Fy(e,i){return i=typeof i=="function"?i:r,br(e,S|N,i)}function By(e,i){return i==null||lu(e,i,Dt(i))}function $r(e,i){return e===i||e!==e&&i!==i}var Gy=Jn(yo),Wy=Jn(function(e,i){return e>=i}),zi=vu(function(){return arguments}())?vu:function(e){return ht(e)&&$e.call(e,"callee")&&!iu.call(e,"callee")},le=C.isArray,Jy=Gt?lr(Gt):id;function tr(e){return e!=null&&sa(e.length)&&!ei(e)}function dt(e){return ht(e)&&tr(e)}function Qy(e){return e===!0||e===!1||ht(e)&&Wt(e)==T}var yi=hp||tc,Yy=Ar?lr(Ar):sd;function Zy(e){return ht(e)&&e.nodeType===1&&!Ls(e)}function Xy(e){if(e==null)return!0;if(tr(e)&&(le(e)||typeof e=="string"||typeof e.splice=="function"||yi(e)||cs(e)||zi(e)))return!e.length;var i=Ht(e);if(i==ge||i==Ae)return!e.size;if(Ds(e))return!wo(e).length;for(var n in e)if($e.call(e,n))return!1;return!0}function ev(e,i){return Ts(e,i)}function tv(e,i,n){n=typeof n=="function"?n:r;var c=n?n(e,i):r;return c===r?Ts(e,i,r,n):!!c}function Fo(e){if(!ht(e))return!1;var i=Wt(e);return i==E||i==h||typeof e.message=="string"&&typeof e.name=="string"&&!Ls(e)}function rv(e){return typeof e=="number"&&nu(e)}function ei(e){if(!tt(e))return!1;var i=Wt(e);return i==J||i==ae||i==$||i==lt}function Ph(e){return typeof e=="number"&&e==de(e)}function sa(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=G}function tt(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function ht(e){return e!=null&&typeof e=="object"}var Sh=vr?lr(vr):ad;function iv(e,i){return e===i||mo(e,i,qo(i))}function sv(e,i,n){return n=typeof n=="function"?n:r,mo(e,i,qo(i),n)}function nv(e){return Oh(e)&&e!=+e}function av(e){if(Kd(e))throw new ue(u);return mu(e)}function ov(e){return e===null}function cv(e){return e==null}function Oh(e){return typeof e=="number"||ht(e)&&Wt(e)==Pe}function Ls(e){if(!ht(e)||Wt(e)!=_e)return!1;var i=Tn(e);if(i===null)return!0;var n=$e.call(i,"constructor")&&i.constructor;return typeof n=="function"&&n instanceof n&&On.call(n)==sp}var Bo=Mr?lr(Mr):od;function uv(e){return Ph(e)&&e>=-G&&e<=G}var Rh=bs?lr(bs):cd;function na(e){return typeof e=="string"||!le(e)&&ht(e)&&Wt(e)==ke}function pr(e){return typeof e=="symbol"||ht(e)&&Wt(e)==Ke}var cs=Ci?lr(Ci):ud;function hv(e){return e===r}function lv(e){return ht(e)&&Ht(e)==Ne}function fv(e){return ht(e)&&Wt(e)==Ve}var pv=Jn(_o),dv=Jn(function(e,i){return e<=i});function Ah(e){if(!e)return[];if(tr(e))return na(e)?Cr(e):er(e);if(Is&&e[Is])return Bf(e[Is]());var i=Ht(e),n=i==ge?ao:i==Ae?xn:us;return n(e)}function ti(e){if(!e)return e===0?e:0;if(e=xr(e),e===qe||e===-qe){var i=e<0?-1:1;return i*K}return e===e?e:0}function de(e){var i=ti(e),n=i%1;return i===i?n?i-n:i:0}function Ch(e){return e?Di(de(e),0,V):0}function xr(e){if(typeof e=="number")return e;if(pr(e))return H;if(tt(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=tt(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=Jc(e);var n=qa.test(e);return n||ja.test(e)?he(e.slice(2),n?2:8):Da.test(e)?H:+e}function Th(e){return Hr(e,rr(e))}function gv(e){return e?Di(de(e),-G,G):e===0?e:0}function Ce(e){return e==null?"":fr(e)}var yv=ns(function(e,i){if(Ds(i)||tr(i)){Hr(i,Dt(i),e);return}for(var n in i)$e.call(i,n)&&Rs(e,n,i[n])}),$h=ns(function(e,i){Hr(i,rr(i),e)}),aa=ns(function(e,i,n,c){Hr(i,rr(i),e,c)}),vv=ns(function(e,i,n,c){Hr(i,Dt(i),e,c)}),mv=Zr(fo);function wv(e,i){var n=ss(e);return i==null?n:hu(n,i)}var _v=ve(function(e,i){e=Ue(e);var n=-1,c=i.length,l=c>2?i[2]:r;for(l&&Jt(i[0],i[1],l)&&(c=1);++n<c;)for(var g=i[n],w=rr(g),b=-1,P=w.length;++b<P;){var q=w[b],L=e[q];(L===r||$r(L,ts[q])&&!$e.call(e,q))&&(e[q]=g[q])}return e}),bv=ve(function(e){return e.push(r,Ju),Nt(Nh,r,e)});function Ev(e,i){return Fc(e,ee(i,3),Ur)}function Iv(e,i){return Fc(e,ee(i,3),go)}function xv(e,i){return e==null?e:po(e,ee(i,3),rr)}function Pv(e,i){return e==null?e:gu(e,ee(i,3),rr)}function Sv(e,i){return e&&Ur(e,ee(i,3))}function Ov(e,i){return e&&go(e,ee(i,3))}function Rv(e){return e==null?[]:Hn(e,Dt(e))}function Av(e){return e==null?[]:Hn(e,rr(e))}function Go(e,i,n){var c=e==null?r:qi(e,i);return c===r?n:c}function Cv(e,i){return e!=null&&Zu(e,i,Xp)}function Wo(e,i){return e!=null&&Zu(e,i,ed)}var Tv=Vu(function(e,i,n){i!=null&&typeof i.toString!="function"&&(i=Rn.call(i)),e[i]=n},Qo(ir)),$v=Vu(function(e,i,n){i!=null&&typeof i.toString!="function"&&(i=Rn.call(i)),$e.call(e,i)?e[i].push(n):e[i]=[n]},ee),Nv=ve(Cs);function Dt(e){return tr(e)?cu(e):wo(e)}function rr(e){return tr(e)?cu(e,!0):hd(e)}function Dv(e,i){var n={};return i=ee(i,3),Ur(e,function(c,l,g){Qr(n,i(c,l,g),c)}),n}function qv(e,i){var n={};return i=ee(i,3),Ur(e,function(c,l,g){Qr(n,l,i(c,l,g))}),n}var Lv=ns(function(e,i,n){kn(e,i,n)}),Nh=ns(function(e,i,n,c){kn(e,i,n,c)}),jv=Zr(function(e,i){var n={};if(e==null)return n;var c=!1;i=Qe(i,function(g){return g=di(g,e),c||(c=g.length>1),g}),Hr(e,No(e),n),c&&(n=br(n,S|R|N,Td));for(var l=i.length;l--;)Po(n,i[l]);return n});function zv(e,i){return Dh(e,ia(ee(i)))}var Mv=Zr(function(e,i){return e==null?{}:fd(e,i)});function Dh(e,i){if(e==null)return{};var n=Qe(No(e),function(c){return[c]});return i=ee(i),Pu(e,n,function(c,l){return i(c,l[0])})}function Uv(e,i,n){i=di(i,e);var c=-1,l=i.length;for(l||(l=1,e=r);++c<l;){var g=e==null?r:e[kr(i[c])];g===r&&(c=l,g=n),e=ei(g)?g.call(e):g}return e}function Hv(e,i,n){return e==null?e:$s(e,i,n)}function kv(e,i,n,c){return c=typeof c=="function"?c:r,e==null?e:$s(e,i,n,c)}var qh=Gu(Dt),Lh=Gu(rr);function Kv(e,i,n){var c=le(e),l=c||yi(e)||cs(e);if(i=ee(i,4),n==null){var g=e&&e.constructor;l?n=c?new g:[]:tt(e)?n=ei(g)?ss(Tn(e)):{}:n={}}return(l?mr:Ur)(e,function(w,b,P){return i(n,w,b,P)}),n}function Vv(e,i){return e==null?!0:Po(e,i)}function Fv(e,i,n){return e==null?e:Cu(e,i,Ro(n))}function Bv(e,i,n,c){return c=typeof c=="function"?c:r,e==null?e:Cu(e,i,Ro(n),c)}function us(e){return e==null?[]:no(e,Dt(e))}function Gv(e){return e==null?[]:no(e,rr(e))}function Wv(e,i,n){return n===r&&(n=i,i=r),n!==r&&(n=xr(n),n=n===n?n:0),i!==r&&(i=xr(i),i=i===i?i:0),Di(xr(e),i,n)}function Jv(e,i,n){return i=ti(i),n===r?(n=i,i=0):n=ti(n),e=xr(e),td(e,i,n)}function Qv(e,i,n){if(n&&typeof n!="boolean"&&Jt(e,i,n)&&(i=n=r),n===r&&(typeof i=="boolean"?(n=i,i=r):typeof e=="boolean"&&(n=e,e=r)),e===r&&i===r?(e=0,i=1):(e=ti(e),i===r?(i=e,e=0):i=ti(i)),e>i){var c=e;e=i,i=c}if(n||e%1||i%1){var l=au();return Ut(e+l*(i-e+ze("1e-"+((l+"").length-1))),i)}return Eo(e,i)}var Yv=as(function(e,i,n){return i=i.toLowerCase(),e+(n?jh(i):i)});function jh(e){return Jo(Ce(e).toLowerCase())}function zh(e){return e=Ce(e),e&&e.replace(Br,Hf).replace(Qa,"")}function Zv(e,i,n){e=Ce(e),i=fr(i);var c=e.length;n=n===r?c:Di(de(n),0,c);var l=n;return n-=i.length,n>=0&&e.slice(n,l)==i}function Xv(e){return e=Ce(e),e&&We.test(e)?e.replace(Pi,kf):e}function em(e){return e=Ce(e),e&&bt.test(e)?e.replace(ot,"\\$&"):e}var tm=as(function(e,i,n){return e+(n?"-":"")+i.toLowerCase()}),rm=as(function(e,i,n){return e+(n?" ":"")+i.toLowerCase()}),im=Hu("toLowerCase");function sm(e,i,n){e=Ce(e),i=de(i);var c=i?Xi(e):0;if(!i||c>=i)return e;var l=(i-c)/2;return Wn(qn(l),n)+e+Wn(Dn(l),n)}function nm(e,i,n){e=Ce(e),i=de(i);var c=i?Xi(e):0;return i&&c<i?e+Wn(i-c,n):e}function am(e,i,n){e=Ce(e),i=de(i);var c=i?Xi(e):0;return i&&c<i?Wn(i-c,n)+e:e}function om(e,i,n){return n||i==null?i=0:i&&(i=+i),dp(Ce(e).replace(ct,""),i||0)}function cm(e,i,n){return(n?Jt(e,i,n):i===r)?i=1:i=de(i),Io(Ce(e),i)}function um(){var e=arguments,i=Ce(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var hm=as(function(e,i,n){return e+(n?"_":"")+i.toLowerCase()});function lm(e,i,n){return n&&typeof n!="number"&&Jt(e,i,n)&&(i=n=r),n=n===r?V:n>>>0,n?(e=Ce(e),e&&(typeof i=="string"||i!=null&&!Bo(i))&&(i=fr(i),!i&&Zi(e))?gi(Cr(e),0,n):e.split(i,n)):[]}var fm=as(function(e,i,n){return e+(n?" ":"")+Jo(i)});function pm(e,i,n){return e=Ce(e),n=n==null?0:Di(de(n),0,e.length),i=fr(i),e.slice(n,n+i.length)==i}function dm(e,i,n){var c=p.templateSettings;n&&Jt(e,i,n)&&(i=r),e=Ce(e),i=aa({},i,c,Wu);var l=aa({},i.imports,c.imports,Wu),g=Dt(l),w=no(l,g),b,P,q=0,L=i.interpolate||Vi,z="__p += '",k=oo((i.escape||Vi).source+"|"+L.source+"|"+(L===et?Na:Vi).source+"|"+(i.evaluate||Vi).source+"|$","g"),Z="//# sourceURL="+($e.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Ya+"]")+`
`;e.replace(k,function(se,me,Ie,dr,Qt,gr){return Ie||(Ie=dr),z+=e.slice(q,gr).replace(Ma,Kf),me&&(b=!0,z+=`' +
__e(`+me+`) +
'`),Qt&&(P=!0,z+=`';
`+Qt+`;
__p += '`),Ie&&(z+=`' +
((__t = (`+Ie+`)) == null ? '' : __t) +
'`),q=gr+se.length,se}),z+=`';
`;var ie=$e.call(i,"variable")&&i.variable;if(!ie)z=`with (obj) {
`+z+`
}
`;else if(Ta.test(ie))throw new ue(y);z=(P?z.replace(jr,""):z).replace(Bt,"$1").replace(Fr,"$1;"),z="function("+(ie||"obj")+`) {
`+(ie?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(b?", __e = _.escape":"")+(P?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+z+`return __p
}`;var ye=Uh(function(){return Re(g,Z+"return "+z).apply(r,w)});if(ye.source=z,Fo(ye))throw ye;return ye}function gm(e){return Ce(e).toLowerCase()}function ym(e){return Ce(e).toUpperCase()}function vm(e,i,n){if(e=Ce(e),e&&(n||i===r))return Jc(e);if(!e||!(i=fr(i)))return e;var c=Cr(e),l=Cr(i),g=Qc(c,l),w=Yc(c,l)+1;return gi(c,g,w).join("")}function mm(e,i,n){if(e=Ce(e),e&&(n||i===r))return e.slice(0,Xc(e)+1);if(!e||!(i=fr(i)))return e;var c=Cr(e),l=Yc(c,Cr(i))+1;return gi(c,0,l).join("")}function wm(e,i,n){if(e=Ce(e),e&&(n||i===r))return e.replace(ct,"");if(!e||!(i=fr(i)))return e;var c=Cr(e),l=Qc(c,Cr(i));return gi(c,l).join("")}function _m(e,i){var n=yt,c=Yt;if(tt(i)){var l="separator"in i?i.separator:l;n="length"in i?de(i.length):n,c="omission"in i?fr(i.omission):c}e=Ce(e);var g=e.length;if(Zi(e)){var w=Cr(e);g=w.length}if(n>=g)return e;var b=n-Xi(c);if(b<1)return c;var P=w?gi(w,0,b).join(""):e.slice(0,b);if(l===r)return P+c;if(w&&(b+=P.length-b),Bo(l)){if(e.slice(b).search(l)){var q,L=P;for(l.global||(l=oo(l.source,Ce(yr.exec(l))+"g")),l.lastIndex=0;q=l.exec(L);)var z=q.index;P=P.slice(0,z===r?b:z)}}else if(e.indexOf(fr(l),b)!=b){var k=P.lastIndexOf(l);k>-1&&(P=P.slice(0,k))}return P+c}function bm(e){return e=Ce(e),e&&st.test(e)?e.replace(ai,Qf):e}var Em=as(function(e,i,n){return e+(n?" ":"")+i.toUpperCase()}),Jo=Hu("toUpperCase");function Mh(e,i,n){return e=Ce(e),i=n?r:i,i===r?Ff(e)?Xf(e):Lf(e):e.match(i)||[]}var Uh=ve(function(e,i){try{return Nt(e,r,i)}catch(n){return Fo(n)?n:new ue(n)}}),Im=Zr(function(e,i){return mr(i,function(n){n=kr(n),Qr(e,n,Ko(e[n],e))}),e});function xm(e){var i=e==null?0:e.length,n=ee();return e=i?Qe(e,function(c){if(typeof c[1]!="function")throw new wr(f);return[n(c[0]),c[1]]}):[],ve(function(c){for(var l=-1;++l<i;){var g=e[l];if(Nt(g[0],this,c))return Nt(g[1],this,c)}})}function Pm(e){return Qp(br(e,S))}function Qo(e){return function(){return e}}function Sm(e,i){return e==null||e!==e?i:e}var Om=Ku(),Rm=Ku(!0);function ir(e){return e}function Yo(e){return wu(typeof e=="function"?e:br(e,S))}function Am(e){return bu(br(e,S))}function Cm(e,i){return Eu(e,br(i,S))}var Tm=ve(function(e,i){return function(n){return Cs(n,e,i)}}),$m=ve(function(e,i){return function(n){return Cs(e,n,i)}});function Zo(e,i,n){var c=Dt(i),l=Hn(i,c);n==null&&!(tt(i)&&(l.length||!c.length))&&(n=i,i=e,e=this,l=Hn(i,Dt(i)));var g=!(tt(n)&&"chain"in n)||!!n.chain,w=ei(e);return mr(l,function(b){var P=i[b];e[b]=P,w&&(e.prototype[b]=function(){var q=this.__chain__;if(g||q){var L=e(this.__wrapped__),z=L.__actions__=er(this.__actions__);return z.push({func:P,args:arguments,thisArg:e}),L.__chain__=q,L}return P.apply(e,ui([this.value()],arguments))})}),e}function Nm(){return Ee._===this&&(Ee._=np),this}function Xo(){}function Dm(e){return e=de(e),ve(function(i){return Iu(i,e)})}var qm=Co(Qe),Lm=Co(Vc),jm=Co(eo);function Hh(e){return jo(e)?to(kr(e)):pd(e)}function zm(e){return function(i){return e==null?r:qi(e,i)}}var Mm=Fu(),Um=Fu(!0);function ec(){return[]}function tc(){return!1}function Hm(){return{}}function km(){return""}function Km(){return!0}function Vm(e,i){if(e=de(e),e<1||e>G)return[];var n=V,c=Ut(e,V);i=ee(i),e-=V;for(var l=so(c,i);++n<e;)i(n);return l}function Fm(e){return le(e)?Qe(e,kr):pr(e)?[e]:er(oh(Ce(e)))}function Bm(e){var i=++ip;return Ce(e)+i}var Gm=Gn(function(e,i){return e+i},0),Wm=To("ceil"),Jm=Gn(function(e,i){return e/i},1),Qm=To("floor");function Ym(e){return e&&e.length?Un(e,ir,yo):r}function Zm(e,i){return e&&e.length?Un(e,ee(i,2),yo):r}function Xm(e){return Gc(e,ir)}function e0(e,i){return Gc(e,ee(i,2))}function t0(e){return e&&e.length?Un(e,ir,_o):r}function r0(e,i){return e&&e.length?Un(e,ee(i,2),_o):r}var i0=Gn(function(e,i){return e*i},1),s0=To("round"),n0=Gn(function(e,i){return e-i},0);function a0(e){return e&&e.length?io(e,ir):0}function o0(e,i){return e&&e.length?io(e,ee(i,2)):0}return p.after=Ay,p.ary=mh,p.assign=yv,p.assignIn=$h,p.assignInWith=aa,p.assignWith=vv,p.at=mv,p.before=wh,p.bind=Ko,p.bindAll=Im,p.bindKey=_h,p.castArray=Hy,p.chain=gh,p.chunk=Qd,p.compact=Yd,p.concat=Zd,p.cond=xm,p.conforms=Pm,p.constant=Qo,p.countBy=ay,p.create=wv,p.curry=bh,p.curryRight=Eh,p.debounce=Ih,p.defaults=_v,p.defaultsDeep=bv,p.defer=Cy,p.delay=Ty,p.difference=Xd,p.differenceBy=eg,p.differenceWith=tg,p.drop=rg,p.dropRight=ig,p.dropRightWhile=sg,p.dropWhile=ng,p.fill=ag,p.filter=cy,p.flatMap=ly,p.flatMapDeep=fy,p.flatMapDepth=py,p.flatten=lh,p.flattenDeep=og,p.flattenDepth=cg,p.flip=$y,p.flow=Om,p.flowRight=Rm,p.fromPairs=ug,p.functions=Rv,p.functionsIn=Av,p.groupBy=dy,p.initial=lg,p.intersection=fg,p.intersectionBy=pg,p.intersectionWith=dg,p.invert=Tv,p.invertBy=$v,p.invokeMap=yy,p.iteratee=Yo,p.keyBy=vy,p.keys=Dt,p.keysIn=rr,p.map=ea,p.mapKeys=Dv,p.mapValues=qv,p.matches=Am,p.matchesProperty=Cm,p.memoize=ra,p.merge=Lv,p.mergeWith=Nh,p.method=Tm,p.methodOf=$m,p.mixin=Zo,p.negate=ia,p.nthArg=Dm,p.omit=jv,p.omitBy=zv,p.once=Ny,p.orderBy=my,p.over=qm,p.overArgs=Dy,p.overEvery=Lm,p.overSome=jm,p.partial=Vo,p.partialRight=xh,p.partition=wy,p.pick=Mv,p.pickBy=Dh,p.property=Hh,p.propertyOf=zm,p.pull=mg,p.pullAll=ph,p.pullAllBy=wg,p.pullAllWith=_g,p.pullAt=bg,p.range=Mm,p.rangeRight=Um,p.rearg=qy,p.reject=Ey,p.remove=Eg,p.rest=Ly,p.reverse=Ho,p.sampleSize=xy,p.set=Hv,p.setWith=kv,p.shuffle=Py,p.slice=Ig,p.sortBy=Ry,p.sortedUniq=Cg,p.sortedUniqBy=Tg,p.split=lm,p.spread=jy,p.tail=$g,p.take=Ng,p.takeRight=Dg,p.takeRightWhile=qg,p.takeWhile=Lg,p.tap=Yg,p.throttle=zy,p.thru=Xn,p.toArray=Ah,p.toPairs=qh,p.toPairsIn=Lh,p.toPath=Fm,p.toPlainObject=Th,p.transform=Kv,p.unary=My,p.union=jg,p.unionBy=zg,p.unionWith=Mg,p.uniq=Ug,p.uniqBy=Hg,p.uniqWith=kg,p.unset=Vv,p.unzip=ko,p.unzipWith=dh,p.update=Fv,p.updateWith=Bv,p.values=us,p.valuesIn=Gv,p.without=Kg,p.words=Mh,p.wrap=Uy,p.xor=Vg,p.xorBy=Fg,p.xorWith=Bg,p.zip=Gg,p.zipObject=Wg,p.zipObjectDeep=Jg,p.zipWith=Qg,p.entries=qh,p.entriesIn=Lh,p.extend=$h,p.extendWith=aa,Zo(p,p),p.add=Gm,p.attempt=Uh,p.camelCase=Yv,p.capitalize=jh,p.ceil=Wm,p.clamp=Wv,p.clone=ky,p.cloneDeep=Vy,p.cloneDeepWith=Fy,p.cloneWith=Ky,p.conformsTo=By,p.deburr=zh,p.defaultTo=Sm,p.divide=Jm,p.endsWith=Zv,p.eq=$r,p.escape=Xv,p.escapeRegExp=em,p.every=oy,p.find=uy,p.findIndex=uh,p.findKey=Ev,p.findLast=hy,p.findLastIndex=hh,p.findLastKey=Iv,p.floor=Qm,p.forEach=yh,p.forEachRight=vh,p.forIn=xv,p.forInRight=Pv,p.forOwn=Sv,p.forOwnRight=Ov,p.get=Go,p.gt=Gy,p.gte=Wy,p.has=Cv,p.hasIn=Wo,p.head=fh,p.identity=ir,p.includes=gy,p.indexOf=hg,p.inRange=Jv,p.invoke=Nv,p.isArguments=zi,p.isArray=le,p.isArrayBuffer=Jy,p.isArrayLike=tr,p.isArrayLikeObject=dt,p.isBoolean=Qy,p.isBuffer=yi,p.isDate=Yy,p.isElement=Zy,p.isEmpty=Xy,p.isEqual=ev,p.isEqualWith=tv,p.isError=Fo,p.isFinite=rv,p.isFunction=ei,p.isInteger=Ph,p.isLength=sa,p.isMap=Sh,p.isMatch=iv,p.isMatchWith=sv,p.isNaN=nv,p.isNative=av,p.isNil=cv,p.isNull=ov,p.isNumber=Oh,p.isObject=tt,p.isObjectLike=ht,p.isPlainObject=Ls,p.isRegExp=Bo,p.isSafeInteger=uv,p.isSet=Rh,p.isString=na,p.isSymbol=pr,p.isTypedArray=cs,p.isUndefined=hv,p.isWeakMap=lv,p.isWeakSet=fv,p.join=gg,p.kebabCase=tm,p.last=Ir,p.lastIndexOf=yg,p.lowerCase=rm,p.lowerFirst=im,p.lt=pv,p.lte=dv,p.max=Ym,p.maxBy=Zm,p.mean=Xm,p.meanBy=e0,p.min=t0,p.minBy=r0,p.stubArray=ec,p.stubFalse=tc,p.stubObject=Hm,p.stubString=km,p.stubTrue=Km,p.multiply=i0,p.nth=vg,p.noConflict=Nm,p.noop=Xo,p.now=ta,p.pad=sm,p.padEnd=nm,p.padStart=am,p.parseInt=om,p.random=Qv,p.reduce=_y,p.reduceRight=by,p.repeat=cm,p.replace=um,p.result=Uv,p.round=s0,p.runInContext=x,p.sample=Iy,p.size=Sy,p.snakeCase=hm,p.some=Oy,p.sortedIndex=xg,p.sortedIndexBy=Pg,p.sortedIndexOf=Sg,p.sortedLastIndex=Og,p.sortedLastIndexBy=Rg,p.sortedLastIndexOf=Ag,p.startCase=fm,p.startsWith=pm,p.subtract=n0,p.sum=a0,p.sumBy=o0,p.template=dm,p.times=Vm,p.toFinite=ti,p.toInteger=de,p.toLength=Ch,p.toLower=gm,p.toNumber=xr,p.toSafeInteger=gv,p.toString=Ce,p.toUpper=ym,p.trim=vm,p.trimEnd=mm,p.trimStart=wm,p.truncate=_m,p.unescape=bm,p.uniqueId=Bm,p.upperCase=Em,p.upperFirst=Jo,p.each=yh,p.eachRight=vh,p.first=fh,Zo(p,function(){var e={};return Ur(p,function(i,n){$e.call(p.prototype,n)||(e[n]=i)}),e}(),{chain:!1}),p.VERSION=s,mr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){p[e].placeholder=p}),mr(["drop","take"],function(e,i){be.prototype[e]=function(n){n=n===r?1:Ct(de(n),0);var c=this.__filtered__&&!i?new be(this):this.clone();return c.__filtered__?c.__takeCount__=Ut(n,c.__takeCount__):c.__views__.push({size:Ut(n,V),type:e+(c.__dir__<0?"Right":"")}),c},be.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),mr(["filter","map","takeWhile"],function(e,i){var n=i+1,c=n==M||n==Ge;be.prototype[e]=function(l){var g=this.clone();return g.__iteratees__.push({iteratee:ee(l,3),type:n}),g.__filtered__=g.__filtered__||c,g}}),mr(["head","last"],function(e,i){var n="take"+(i?"Right":"");be.prototype[e]=function(){return this[n](1).value()[0]}}),mr(["initial","tail"],function(e,i){var n="drop"+(i?"":"Right");be.prototype[e]=function(){return this.__filtered__?new be(this):this[n](1)}}),be.prototype.compact=function(){return this.filter(ir)},be.prototype.find=function(e){return this.filter(e).head()},be.prototype.findLast=function(e){return this.reverse().find(e)},be.prototype.invokeMap=ve(function(e,i){return typeof e=="function"?new be(this):this.map(function(n){return Cs(n,e,i)})}),be.prototype.reject=function(e){return this.filter(ia(ee(e)))},be.prototype.slice=function(e,i){e=de(e);var n=this;return n.__filtered__&&(e>0||i<0)?new be(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),i!==r&&(i=de(i),n=i<0?n.dropRight(-i):n.take(i-e)),n)},be.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},be.prototype.toArray=function(){return this.take(V)},Ur(be.prototype,function(e,i){var n=/^(?:filter|find|map|reject)|While$/.test(i),c=/^(?:head|last)$/.test(i),l=p[c?"take"+(i=="last"?"Right":""):i],g=c||/^find/.test(i);l&&(p.prototype[i]=function(){var w=this.__wrapped__,b=c?[1]:arguments,P=w instanceof be,q=b[0],L=P||le(w),z=function(me){var Ie=l.apply(p,ui([me],b));return c&&k?Ie[0]:Ie};L&&n&&typeof q=="function"&&q.length!=1&&(P=L=!1);var k=this.__chain__,Z=!!this.__actions__.length,ie=g&&!k,ye=P&&!Z;if(!g&&L){w=ye?w:new be(this);var se=e.apply(w,b);return se.__actions__.push({func:Xn,args:[z],thisArg:r}),new _r(se,k)}return ie&&ye?e.apply(this,b):(se=this.thru(z),ie?c?se.value()[0]:se.value():se)})}),mr(["pop","push","shift","sort","splice","unshift"],function(e){var i=Pn[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);p.prototype[e]=function(){var l=arguments;if(c&&!this.__chain__){var g=this.value();return i.apply(le(g)?g:[],l)}return this[n](function(w){return i.apply(le(w)?w:[],l)})}}),Ur(be.prototype,function(e,i){var n=p[i];if(n){var c=n.name+"";$e.call(is,c)||(is[c]=[]),is[c].push({name:i,func:n})}}),is[Bn(r,ce).name]=[{name:"wrapper",func:r}],be.prototype.clone=bp,be.prototype.reverse=Ep,be.prototype.value=Ip,p.prototype.at=Zg,p.prototype.chain=Xg,p.prototype.commit=ey,p.prototype.next=ty,p.prototype.plant=iy,p.prototype.reverse=sy,p.prototype.toJSON=p.prototype.valueOf=p.prototype.value=ny,p.prototype.first=p.prototype.head,Is&&(p.prototype[Is]=ry),p},es=ep();pt?((pt.exports=es)._=es,Me._=es):Ee._=es}).call(Ks)})(Rc,Rc.exports);var aI=Object.defineProperty,oI=Object.defineProperties,cI=Object.getOwnPropertyDescriptors,Ll=Object.getOwnPropertySymbols,uI=Object.prototype.hasOwnProperty,hI=Object.prototype.propertyIsEnumerable,jl=(o,t,r)=>t in o?aI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,pa=(o,t)=>{for(var r in t||(t={}))uI.call(t,r)&&jl(o,r,t[r]);if(Ll)for(var r of Ll(t))hI.call(t,r)&&jl(o,r,t[r]);return o},lI=(o,t)=>oI(o,cI(t));function bi(o,t,r){var s;const a=G0(o);return((s=t.rpcMap)==null?void 0:s[a.reference])||`${nI}?chainId=${a.namespace}:${a.reference}&projectId=${r}`}function Ki(o){return o.includes(":")?o.split(":")[1]:o}function Af(o){return o.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function fI(o,t){const r=Object.keys(t.namespaces).filter(a=>a.includes(o));if(!r.length)return[];const s=[];return r.forEach(a=>{const u=t.namespaces[a].accounts;s.push(...u)}),s}function pI(o={},t={}){const r=zl(o),s=zl(t);return Rc.exports.merge(r,s)}function zl(o){var t,r,s,a;const u={};if(!ya(o))return u;for(const[f,y]of Object.entries(o)){const m=Yl(f)?[f]:y.chains,d=y.methods||[],_=y.events||[],S=y.rpcMap||{},R=Vs(f);u[R]=lI(pa(pa({},u[R]),y),{chains:ic(m,(t=u[R])==null?void 0:t.chains),methods:ic(d,(r=u[R])==null?void 0:r.methods),events:ic(_,(s=u[R])==null?void 0:s.events),rpcMap:pa(pa({},S),(a=u[R])==null?void 0:a.rpcMap)})}return u}function dI(o){return o.includes(":")?o.split(":")[2]:o}function gI(o){const t={};for(const[r,s]of Object.entries(o)){const a=s.methods||[],u=s.events||[],f=s.accounts||[],y=Yl(r)?[r]:s.chains?s.chains:Af(s.accounts);t[r]={chains:y,methods:a,events:u,accounts:f}}return t}function dc(o){return typeof o=="number"?o:o.includes("0x")?parseInt(o,16):o.includes(":")?Number(o.split(":")[1]):Number(o)}const Cf={},Ye=o=>Cf[o],gc=(o,t)=>{Cf[o]=t};class yI{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Ki(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||bi(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ii(new Ei(s,Ye("disableProviderPing")))}}class vI{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(parseInt(t),r),this.chainId=parseInt(t),this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const s=r||bi(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ii(new Ei(s,Ye("disableProviderPing")))}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=parseInt(Ki(r));t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,s;let a=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const u=parseInt(a,16);if(this.isChainApproved(u))this.setDefaultChain(`${u}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:a}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${u}`);else throw new Error(`Failed to switch to chain 'eip155:${u}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class mI{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Ki(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||bi(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ii(new Ei(s,Ye("disableProviderPing")))}}class wI{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Ki(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||bi(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ii(new Ei(s,Ye("disableProviderPing")))}}class _I{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r),a=Ki(r);t[a]=this.createHttpProvider(a,s)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||this.getCardanoRPCUrl(t);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ii(new Ei(s,Ye("disableProviderPing")))}}class bI{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Ki(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||bi(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ii(new Ei(s,Ye("disableProviderPing")))}}class EI{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){this.httpProviders[t]||this.setHttpProvider(t,r),this.chainId=t,this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${t}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=Ki(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||bi(t,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);return new Ii(new Ei(s,Ye("disableProviderPing")))}}class II{constructor(t){this.name="near",this.namespace=t.namespace,this.events=Ye("events"),this.client=Ye("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const s=r||bi(`${this.name}:${t}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(ni.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||bi(t,this.namespace);return typeof s>"u"?void 0:new Ii(new Ei(s,Ye("disableProviderPing")))}}var xI=Object.defineProperty,PI=Object.defineProperties,SI=Object.getOwnPropertyDescriptors,Ml=Object.getOwnPropertySymbols,OI=Object.prototype.hasOwnProperty,RI=Object.prototype.propertyIsEnumerable,Ul=(o,t,r)=>t in o?xI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,da=(o,t)=>{for(var r in t||(t={}))OI.call(t,r)&&Ul(o,r,t[r]);if(Ml)for(var r of Ml(t))RI.call(t,r)&&Ul(o,r,t[r]);return o},yc=(o,t)=>PI(o,SI(t));class kc{constructor(t){this.events=new $c,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Oa(Ra({level:(t==null?void 0:t.logger)||Dl})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new kc(t);return await r.initialize(),r}async request(t,r){const[s,a]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:da({},t),chainId:`${s}:${a}`,topic:this.session.topic})}sendAsync(t,r,s){const a=new Date().getTime();this.request(t,s).then(u=>r(null,xa(a,u))).catch(u=>r(u,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:kt("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:a}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await a().then(u=>{this.session=u,this.namespaces||(this.namespaces=gI(u.namespaces),this.persist("namespaces",this.namespaces))}).catch(u=>{if(u.message!==Of)throw u;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[s,a]=this.validateChain(t);this.getProvider(s).setDefaultChain(a,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(ys(r)){for(const s of r)t.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await tI.init({logger:this.providerOpts.logger||Dl,relayUrl:this.providerOpts.relayUrl||rI,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>Vs(r)))];gc("client",this.client),gc("events",this.events),gc("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const s=fI(r,this.session),a=Af(s),u=pI(this.namespaces,this.optionalNamespaces),f=yc(da({},u[r]),{accounts:s,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new vI({namespace:f});break;case"solana":this.rpcProviders[r]=new mI({namespace:f});break;case"cosmos":this.rpcProviders[r]=new wI({namespace:f});break;case"polkadot":this.rpcProviders[r]=new yI({namespace:f});break;case"cip34":this.rpcProviders[r]=new _I({namespace:f});break;case"elrond":this.rpcProviders[r]=new bI({namespace:f});break;case"multiversx":this.rpcProviders[r]=new EI({namespace:f});break;case"near":this.rpcProviders[r]=new II({namespace:f});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:s}=r;if(s.name==="accountsChanged"){const a=s.data;a&&ys(a)&&this.events.emit("accountsChanged",a.map(dI))}else if(s.name==="chainChanged"){const a=r.chainId,u=r.event.data,f=Vs(a),y=dc(a)!==dc(u)?`${f}:${dc(u)}`:a;this.onChainChanged(y)}else this.events.emit(s.name,s.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var s;const{namespaces:a}=r,u=(s=this.client)==null?void 0:s.session.get(t);this.session=yc(da({},u),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",yc(da({},kt("USER_DISCONNECTED")),{data:t.topic}))}),this.on(ni.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:s,sessionProperties:a}=t;r&&Object.keys(r).length&&(this.namespaces=r),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",s)}validateChain(t){const[r,s]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(f=>Vs(f)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const a=Vs(Object.keys(this.namespaces)[0]),u=this.rpcProviders[a].getDefaultChain();return[a,u]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var s;if(!this.namespaces)return;const[a,u]=this.validateChain(t);r||this.getProvider(a).setDefaultChain(u),((s=this.namespaces[a])!=null?s:this.namespaces[`${a}:${u}`]).defaultChain=u,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",u)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${ql}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${ql}/${t}`)}}const AI=kc,CI="wc",TI="ethereum_provider",$I=`${CI}@2:${TI}:`,NI="https://rpc.walletconnect.com/v1/",Ac=["eth_sendTransaction","personal_sign"],DI=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],Cc=["chainChanged","accountsChanged"],qI=["chainChanged","accountsChanged","message","disconnect","connect"];var LI=Object.defineProperty,jI=Object.defineProperties,zI=Object.getOwnPropertyDescriptors,Hl=Object.getOwnPropertySymbols,MI=Object.prototype.hasOwnProperty,UI=Object.prototype.propertyIsEnumerable,kl=(o,t,r)=>t in o?LI(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,Bs=(o,t)=>{for(var r in t||(t={}))MI.call(t,r)&&kl(o,r,t[r]);if(Hl)for(var r of Hl(t))UI.call(t,r)&&kl(o,r,t[r]);return o},Kl=(o,t)=>jI(o,zI(t));function ba(o){return Number(o[0].split(":")[1])}function vc(o){return`0x${o.toString(16)}`}function HI(o){const{chains:t,optionalChains:r,methods:s,optionalMethods:a,events:u,optionalEvents:f,rpcMap:y}=o;if(!ys(t))throw new Error("Invalid chains");const m={chains:t,methods:s||Ac,events:u||Cc,rpcMap:Bs({},t.length?{[ba(t)]:y[ba(t)]}:{})},d=u==null?void 0:u.filter(N=>!Cc.includes(N)),_=s==null?void 0:s.filter(N=>!Ac.includes(N));if(!r&&!f&&!a&&!(d!=null&&d.length)&&!(_!=null&&_.length))return{required:t.length?m:void 0};const S=(d==null?void 0:d.length)&&(_==null?void 0:_.length)||!r,R={chains:[...new Set(S?m.chains.concat(r||[]):r)],methods:[...new Set(m.methods.concat(a!=null&&a.length?a:DI))],events:[...new Set(m.events.concat(f!=null&&f.length?f:qI))],rpcMap:y};return{required:t.length?m:void 0,optional:r.length?R:void 0}}class Kc{constructor(){this.events=new Sr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=$I,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new Kc;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:s}=HI(this.rpc);try{const a=await new Promise(async(f,y)=>{var m;this.rpc.showQrModal&&((m=this.modal)==null||m.subscribeModal(d=>{!d.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),y(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(Kl(Bs({namespaces:Bs({},r&&{[this.namespace]:r})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(d=>{f(d)}).catch(d=>{y(new Error(d.message))})});if(!a)return;const u=W0(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:u),this.setAccounts(u),this.events.emit("connect",{chainId:vc(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:s}=r;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",vc(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",Kl(Bs({},kt("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,s;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(s=this.modal)==null||s.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",vc(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,s,a]=t.split(":");return{chainId:`${r}:${s}`,address:a}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,s;const a=(r=t==null?void 0:t.chains)!=null?r:[],u=(s=t==null?void 0:t.optionalChains)!=null?s:[],f=a.concat(u);if(!f.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const y=a.length?(t==null?void 0:t.methods)||Ac:[],m=a.length?(t==null?void 0:t.events)||Cc:[],d=(t==null?void 0:t.optionalMethods)||[],_=(t==null?void 0:t.optionalEvents)||[],S=(t==null?void 0:t.rpcMap)||this.buildRpcMap(f,t.projectId),R=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(N=>this.formatChainId(N)),optionalChains:u.map(N=>this.formatChainId(N)),methods:y,events:m,optionalMethods:d,optionalEvents:_,rpcMap:S,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:R,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const s={};return t.forEach(a=>{s[a]=this.getRpcUrl(a,r)}),s}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?ba(this.rpc.chains):ba(this.rpc.optionalChains),this.signer=await AI.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:s}=await J0(()=>import("./index-BJEdcoLu.js").then(a=>a.i),__vite__mapDeps([0,1,2,3]));r=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(Bs({projectId:this.rpc.projectId},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:s,rpcMap:a}=t;r&&ys(r)&&(this.rpc.chains=r.map(u=>this.formatChainId(u)),r.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)})),s&&ys(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(u=>this.formatChainId(u)),s.forEach(u=>{this.rpc.rpcMap[u]=(a==null?void 0:a[u])||this.getRpcUrl(u)}))}getRpcUrl(t,r){var s;return((s=this.rpc.rpcMap)==null?void 0:s[t])||`${NI}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const ax=Kc;export{ax as EthereumProvider,qI as OPTIONAL_EVENTS,DI as OPTIONAL_METHODS,Cc as REQUIRED_EVENTS,Ac as REQUIRED_METHODS,Kc as default};
