import{r as t,j as D,x as v}from"./react-OEhP2pWc.js";import{a3 as j,E as f,H as A,a4 as N,F as P,a5 as E,a6 as U,a7 as O,a8 as B,q as R,f as q,w as G,h as V}from"./vendor-D4KQtBUH.js";import{d as g,a as w,g as J,b as k,c as z,s as F}from"./components--ZW17nkP.js";import{a as I,u as H,b as K,c as Q}from"./web3-DE1AGvEk.js";const b=t.createContext();function oe({children:r}){const[s,c]=t.useState(()=>{const d=localStorage.getItem("darkMode");return d!==null?JSON.parse(d):window.matchMedia("(prefers-color-scheme: dark)").matches});t.useEffect(()=>{s?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("darkMode",JSON.stringify(s))},[s]);const u={isDarkMode:s,toggleTheme:()=>{c(!s)}};return D.jsx(b.Provider,{value:u,children:r})}function re(){const r=t.useContext(b);if(r===void 0)throw new Error("useTheme must be used within a ThemeProvider");return r}const M=t.createContext();function ne({children:r}){const[s,c]=t.useState(null),[l,u]=t.useState(!0),[d,y]=t.useState(!1);t.useState(!0);const[C,m]=t.useState(0);t.useEffect(()=>{const e=j(w,async o=>{if(o){const i=f(g,"users",o.uid),p=await A(i),h=p.exists()?p.data():{},W={uid:o.uid,email:o.email,name:h.name||null,isSeller:h.isSeller||!1,sellerId:h.sellerId||null,walletAddress:h.walletAddress||null,createdAt:h.createdAt||new Date,updatedAt:new Date};c(W),y(h.isAdmin||!1),u(!1)}else c(null),y(!1),u(!1)});return()=>e()},[]);const n=async e=>{try{const o=R(q(g,"cart"),G("userId","==",e)),i=await V(o);m(i.size)}catch(o){console.error("Error fetching cart count:",o),m(0)}},L={user:s,loading:l,signup:async(e,o,i)=>{try{const{user:p}=await N(w,e,o);return await P(f(g,"users",p.uid),{...i,email:e,createdAt:new Date().toISOString(),isSeller:!1,isBuyer:!0}),await E(w),p}catch(p){throw console.error("Signup error:",p),new Error(p.message)}},login:async(e,o)=>{try{const{user:i}=await U(w,e,o);return i}catch(i){throw console.error("Login error:",i),new Error(i.message)}},loginWithGoogle:async()=>{try{const{user:e}=await O(w,J);return(await A(f(g,"users",e.uid))).exists()||await P(f(g,"users",e.uid),{email:e.email,name:e.displayName,photoURL:e.photoURL,createdAt:new Date().toISOString(),isSeller:!1,isBuyer:!0,shippingAddress:{street:"",city:"",state:"",country:"",postalCode:""}}),e}catch(e){throw console.error("Google login error:",e),e.code==="auth/popup-closed-by-user"?new Error("Sign in cancelled"):new Error(e.message)}},logout:async()=>{try{await E(w),v.success("Logged out successfully")}catch(e){throw console.error("Logout error:",e),new Error(e.message)}},resetPassword:async e=>{try{await B(w,e),v.success("Password reset email sent! Please check your inbox.")}catch(o){throw console.error("Password reset error:",o),new Error(o.message)}},isAdmin:d,cartCount:C,updateCartCount:async e=>{await n(e)}};return D.jsx(M.Provider,{value:L,children:!l&&r})}function ae(){return t.useContext(M)}function ce(){const{address:r,isConnected:s}=I(),{chain:c}=H(),l=K(),{data:u}=Q();return{account:r,isConnected:s,chain:c,provider:l,signer:u}}const T=t.createContext();function ie({children:r}){const{address:s}=I(),[c,l]=t.useState([]),[u,d]=t.useState([]);t.useEffect(()=>{(async()=>{try{const n=await k();if(l(n),s){const x=(await z(s)).map(a=>({...a,type:"nft",logo:a.previewUrl,logoIpfs:a.imageIpfsUrl,totalSupply:a.maxSupply,timestamp:a.createdAt,chainName:a.network==="polygon"?"Polygon":a.network==="monad-testnet"?"Monad Testnet":a.network==="unichain-mainnet"||a.chainId===130?"Unichain Mainnet":a.network==="sepolia"?"Sepolia":a.network}));d(x)}else d([])}catch(n){console.error("Error loading deployments:",n),l([]),d([])}})()},[s]);const y=async m=>{if(s)try{await F(m,s);const n=await k();l(n)}catch(n){throw n}},C=[...c,...u].sort((m,n)=>{const S=m.timestamp||m.createdAt;return(n.timestamp||n.createdAt)-S}).slice(0,10);return D.jsx(T.Provider,{value:{deployments:C,addDeployment:y},children:r})}const le=()=>{const r=t.useContext(T);if(!r)throw new Error("useDeployments must be used within a DeploymentsProvider");return r},X=t.createContext();function ue({children:r}){const[s,c]=t.useState("v2");return D.jsx(X.Provider,{value:{version:s,setVersion:c},children:r})}export{ie as D,ne as M,oe as T,ue as U,ce as a,le as b,ae as c,re as u};
